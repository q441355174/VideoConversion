# VideoConversion 错误修复指南

## 🚨 常见错误及解决方案

### 1. jQuery未定义错误

**错误信息**: `Uncaught ReferenceError: jQuery is not defined`

**原因**: jQuery库未正确加载或加载顺序有问题

**解决方案**:
1. 确保在`_Layout.cshtml`中正确引用了jQuery
2. 检查jQuery文件路径是否正确
3. 确保JavaScript代码在jQuery加载后执行

**已实施的修复**:
- 添加了jQuery检查机制
- 提供CDN备用加载
- 改进了脚本加载顺序

### 2. VideoConversionApp初始化错误

**错误信息**: `Cannot access 'VideoConversionApp' before initialization`

**原因**: 在应用初始化之前就尝试调用了应用函数

**解决方案**:
1. 确保所有onclick事件使用完整的命名空间
2. 添加存在性检查
3. 使用$(document).ready()确保DOM加载完成

**已实施的修复**:
- 更新了HTML中的onclick事件调用
- 添加了应用存在性检查
- 改进了全局函数的错误处理

### 3. SignalR连接失败

**错误信息**: `WebSocket connection failed`

**原因**: SignalR服务未启动或配置不正确

**解决方案**:
1. 确保ASP.NET Core项目中配置了SignalR
2. 检查Hub类是否正确实现
3. 确保SignalR客户端库正确加载

**配置检查清单**:
- [ ] Startup.cs中添加了`services.AddSignalR()`
- [ ] 配置了Hub路由
- [ ] SignalR客户端库已引用

### 4. 脚本加载顺序问题

**解决方案**:
正确的脚本加载顺序应该是：
1. jQuery (在_Layout.cshtml中)
2. Bootstrap (在_Layout.cshtml中)
3. SignalR (在页面Scripts部分)
4. 应用代码 (在页面中，带jQuery检查)

## 🔧 修复后的代码结构

### HTML onclick事件
```html
<!-- 修复前 -->
<button onclick="loadGpuInfo()">

<!-- 修复后 -->
<button onclick="VideoConversionApp.gpu.loadInfo()">
```

### JavaScript初始化检查
```javascript
// 检查jQuery是否已加载
if (typeof jQuery === 'undefined') {
    console.error('jQuery未加载！');
    // 从CDN加载备用jQuery
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js';
    script.onload = function() {
        initializeVideoConversionApp();
    };
    document.head.appendChild(script);
} else {
    initializeVideoConversionApp();
}
```

### 全局函数安全调用
```javascript
function loadGpuInfo() {
    if (typeof VideoConversionApp !== 'undefined' && VideoConversionApp.gpu) {
        VideoConversionApp.gpu.loadInfo();
    } else {
        console.error('VideoConversionApp未初始化或GPU模块不可用');
    }
}
```

## 📋 故障排除步骤

### 1. 检查浏览器控制台
- 打开开发者工具 (F12)
- 查看Console标签页
- 检查是否有红色错误信息

### 2. 验证库文件加载
- 在Network标签页检查资源加载状态
- 确保jQuery、Bootstrap、SignalR都成功加载
- 检查HTTP状态码是否为200

### 3. 测试应用功能
- 检查VideoConversionApp是否在全局作用域中可用
- 在控制台输入`VideoConversionApp`查看对象结构
- 测试各个模块是否正常工作

### 4. 检查SignalR连接
- 查看连接状态指示器
- 检查Network标签页的WebSocket连接
- 确认服务器端Hub配置正确

## 🚀 性能优化建议

### 1. 脚本加载优化
- 使用本地库文件而非CDN（已实施）
- 合并和压缩JavaScript文件
- 使用async/defer属性优化加载

### 2. 错误处理优化
- 实施全局错误处理（已实施）
- 添加用户友好的错误提示（已实施）
- 记录错误日志用于调试（已实施）

### 3. 用户体验优化
- 添加加载状态指示器
- 实施优雅降级机制
- 提供离线功能支持

## 📞 技术支持

如果遇到其他问题，请：

1. **检查文档** - 查看项目文档和API说明
2. **查看日志** - 检查浏览器控制台和服务器日志
3. **测试环境** - 在不同浏览器中测试
4. **版本兼容** - 确认库版本兼容性

## 🔄 更新记录

**2025-01-20**:
- 修复jQuery未定义错误
- 改进VideoConversionApp初始化
- 优化脚本加载顺序
- 添加错误检查机制
- 更新HTML onclick事件调用

---

**注意**: 这些修复确保了应用的稳定性和兼容性。如果仍有问题，请检查服务器端配置和网络连接。
