# Indexé¡µé¢åŠŸèƒ½å®ç°å¼€å‘æ­¥éª¤æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [å¼€å‘ç¯å¢ƒå‡†å¤‡](#å¼€å‘ç¯å¢ƒå‡†å¤‡)
- [ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º](#ç¬¬ä¸€é˜¶æ®µåŸºç¡€æ¶æ„æ­å»º)
- [ç¬¬äºŒé˜¶æ®µï¼šæ–‡ä»¶ä¸Šä¼ æ¨¡å—](#ç¬¬äºŒé˜¶æ®µæ–‡ä»¶ä¸Šä¼ æ¨¡å—)
- [ç¬¬ä¸‰é˜¶æ®µï¼šSignalRé€šä¿¡æ¨¡å—](#ç¬¬ä¸‰é˜¶æ®µsignalré€šä¿¡æ¨¡å—)
- [ç¬¬å››é˜¶æ®µï¼šè½¬æ¢è®¾ç½®æ¨¡å—](#ç¬¬å››é˜¶æ®µè½¬æ¢è®¾ç½®æ¨¡å—)
- [ç¬¬äº”é˜¶æ®µï¼šä»»åŠ¡ç®¡ç†æ¨¡å—](#ç¬¬äº”é˜¶æ®µä»»åŠ¡ç®¡ç†æ¨¡å—)
- [ç¬¬å…­é˜¶æ®µï¼šGPUç¡¬ä»¶åŠ é€Ÿæ¨¡å—](#ç¬¬å…­é˜¶æ®µgpuç¡¬ä»¶åŠ é€Ÿæ¨¡å—)
- [ç¬¬ä¸ƒé˜¶æ®µï¼šé”™è¯¯å¤„ç†å’Œä¼˜åŒ–](#ç¬¬ä¸ƒé˜¶æ®µé”™è¯¯å¤„ç†å’Œä¼˜åŒ–)
- [ç¬¬å…«é˜¶æ®µï¼šæµ‹è¯•å’Œéƒ¨ç½²](#ç¬¬å…«é˜¶æ®µæµ‹è¯•å’Œéƒ¨ç½²)

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒå‡†å¤‡

### å‰ç½®æ¡ä»¶æ£€æŸ¥
- [ ] .NET 8.0 SDK å·²å®‰è£…
- [ ] Node.js å’Œ npm å·²å®‰è£…
- [ ] Visual Studio æˆ– VS Code å·²é…ç½®
- [ ] Git ç‰ˆæœ¬æ§åˆ¶å·²è®¾ç½®

### ä¾èµ–åŒ…ç¡®è®¤
```xml
<!-- ç¡®è®¤ PackageReference åŒ…å«ä»¥ä¸‹ä¾èµ– -->
<PackageReference Include="Microsoft.AspNetCore.SignalR" Version="8.0.0" />
<PackageReference Include="Microsoft.AspNetCore.Mvc" Version="8.0.0" />
<PackageReference Include="System.Text.Json" Version="8.0.0" />
```

### å‰ç«¯èµ„æºç¡®è®¤
```html
<!-- ç¡®è®¤ä»¥ä¸‹JavaScriptåº“å·²å¼•ç”¨ -->
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
```

## ğŸ—ï¸ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º

### æ­¥éª¤1.1ï¼šåˆ›å»ºé¡µé¢åŸºç¡€ç»“æ„

#### ä»»åŠ¡æ¸…å•
- [ ] åˆ›å»ºå“åº”å¼å¸ƒå±€å®¹å™¨
- [ ] è®¾ç½®é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
- [ ] æ·»åŠ åŸºç¡€CSSæ ·å¼
- [ ] åˆ›å»ºä¸»è¦åŒºåŸŸåˆ’åˆ†

#### å®ç°ä»£ç 
```html
<!-- é¡µé¢å¤´éƒ¨ -->
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">
                <i class="fas fa-video text-primary"></i>
                è§†é¢‘è½¬æ¢å·¥å…·
            </h1>
        </div>
    </div>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="row">
        <!-- å·¦ä¾§ï¼šæ–‡ä»¶ä¸Šä¼ å’Œè®¾ç½® -->
        <div class="col-lg-8">
            <div id="fileUploadSection">
                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ - å¾…å®ç° -->
            </div>
            <div id="conversionSettings">
                <!-- è½¬æ¢è®¾ç½®åŒºåŸŸ - å¾…å®ç° -->
            </div>
        </div>
        
        <!-- å³ä¾§ï¼šçŠ¶æ€å’Œä¿¡æ¯ -->
        <div class="col-lg-4">
            <div id="currentTaskSection">
                <!-- å½“å‰ä»»åŠ¡æ˜¾ç¤º - å¾…å®ç° -->
            </div>
            <div id="gpuInfoSection">
                <!-- GPUä¿¡æ¯æ˜¾ç¤º - å¾…å®ç° -->
            </div>
            <div id="recentTasksSection">
                <!-- æœ€è¿‘ä»»åŠ¡åˆ—è¡¨ - å¾…å®ç° -->
            </div>
        </div>
    </div>
</div>
```

### æ­¥éª¤1.2ï¼šåˆå§‹åŒ–JavaScriptæ¶æ„

#### ä»»åŠ¡æ¸…å•
- [ ] åˆ›å»ºå…¨å±€å˜é‡å’Œé…ç½®
- [ ] è®¾ç½®é¡µé¢åˆå§‹åŒ–å‡½æ•°
- [ ] æ·»åŠ åŸºç¡€å·¥å…·å‡½æ•°
- [ ] å»ºç«‹é”™è¯¯å¤„ç†æ¡†æ¶

#### å®ç°ä»£ç 
```javascript
<script>
// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“„ Indexé¡µé¢åˆå§‹åŒ–å¼€å§‹...');
    
    // å…¨å±€å˜é‡åˆå§‹åŒ–
    initializeGlobalVariables();
    
    // åŸºç¡€å·¥å…·å‡½æ•°è®¾ç½®
    setupUtilityFunctions();
    
    // é¡µé¢ç»„ä»¶åˆå§‹åŒ–
    initializePageComponents();
    
    console.log('âœ… Indexé¡µé¢åˆå§‹åŒ–å®Œæˆ');
});

// å…¨å±€å˜é‡
let currentTaskId = null;
let connectionState = 'Disconnected';
let currentTaskStartTime = null;
let lastProgressUpdate = null;
let connection = null;

// å…¨å±€å˜é‡åˆå§‹åŒ–
function initializeGlobalVariables() {
    console.log('ğŸ”§ åˆå§‹åŒ–å…¨å±€å˜é‡...');
    
    // SignalRè¿æ¥é…ç½®
    connection = new signalR.HubConnectionBuilder()
        .withUrl("/conversionHub")
        .withAutomaticReconnect([0, 2000, 10000, 30000])
        .configureLogging(signalR.LogLevel.Information)
        .build();
}

// åŸºç¡€å·¥å…·å‡½æ•°
function setupUtilityFunctions() {
    console.log('ğŸ› ï¸ è®¾ç½®åŸºç¡€å·¥å…·å‡½æ•°...');
    // å·¥å…·å‡½æ•°å°†åœ¨åç»­æ­¥éª¤ä¸­å®ç°
}

// é¡µé¢ç»„ä»¶åˆå§‹åŒ–
function initializePageComponents() {
    console.log('ğŸ¨ åˆå§‹åŒ–é¡µé¢ç»„ä»¶...');
    // å„ä¸ªæ¨¡å—çš„åˆå§‹åŒ–å°†åœ¨åç»­æ­¥éª¤ä¸­å®ç°
}
</script>
```

### æ­¥éª¤1.3ï¼šæ·»åŠ åŸºç¡€å·¥å…·å‡½æ•°

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç°æ¶ˆæ¯æç¤ºå‡½æ•°
- [ ] æ·»åŠ æ–‡ä»¶å¤§å°æ ¼å¼åŒ–å‡½æ•°
- [ ] åˆ›å»ºæ—¶é—´æ ¼å¼åŒ–å‡½æ•°
- [ ] å®ç°è¿æ¥çŠ¶æ€æ›´æ–°å‡½æ•°

#### å®ç°ä»£ç 
```javascript
// åŸºç¡€å·¥å…·å‡½æ•°å®ç°
function setupUtilityFunctions() {
    console.log('ğŸ› ï¸ è®¾ç½®åŸºç¡€å·¥å…·å‡½æ•°...');
    
    // æ¶ˆæ¯æç¤ºå‡½æ•°
    window.showAlert = function(type, message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                type === 'danger' ? 'exclamation-triangle' : 
                                'info-circle'}"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const container = document.querySelector('.container-fluid');
        container.insertBefore(alertDiv, container.firstChild);
        
        // 5ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    };
    
    // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
    window.formatFileSize = function(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return `${(bytes / Math.pow(k, i)).toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;
    };
    
    // æ—¶é—´æ ¼å¼åŒ–
    window.formatTime = function(seconds) {
        if (!seconds || seconds <= 0) return '-';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        if (hours > 0) {
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        } else {
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
    };
    
    // è¿æ¥çŠ¶æ€æ›´æ–°
    window.updateConnectionStatus = function(status) {
        connectionState = status;
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
            statusElement.textContent = status;
            statusElement.className = `badge ${status === 'Connected' ? 'bg-success' : 
                                               status === 'Reconnecting' ? 'bg-warning' : 'bg-danger'}`;
        }
    };
}
```

## ğŸ“ ç¬¬äºŒé˜¶æ®µï¼šæ–‡ä»¶ä¸Šä¼ æ¨¡å—

### æ­¥éª¤2.1ï¼šåˆ›å»ºæ–‡ä»¶ä¸Šä¼ ç•Œé¢

#### ä»»åŠ¡æ¸…å•
- [ ] è®¾è®¡æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ
- [ ] æ·»åŠ æ–‡ä»¶é€‰æ‹©æŒ‰é’®
- [ ] åˆ›å»ºæ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
- [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

#### å®ç°ä»£ç 
```html
<!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
<div id="fileUploadSection" class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-upload text-primary"></i>
            æ–‡ä»¶ä¸Šä¼ 
        </h5>
    </div>
    <div class="card-body">
        <!-- æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ -->
        <div class="file-drop-zone border-dashed p-4 text-center" id="fileDropZone">
            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
            <p class="mb-2">æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            <input type="file" class="form-control" id="videoFile" name="videoFile" 
                   accept=".mp4,.avi,.mov,.mkv,.wmv,.flv,.webm,.m4v" required>
            <small class="text-muted">
                æ”¯æŒæ ¼å¼: MP4, AVI, MOV, MKV, WMV, FLV, WebM, M4V (æœ€å¤§2GB)
            </small>
        </div>
        
        <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
        <div id="selectedFileInfo" style="display: none;" class="mt-3">
            <div class="alert alert-info">
                <h6><i class="fas fa-file-video"></i> å·²é€‰æ‹©æ–‡ä»¶</h6>
                <div class="row">
                    <div class="col-md-6">
                        <strong>æ–‡ä»¶å:</strong> <span id="selectedFileName"></span>
                    </div>
                    <div class="col-md-6">
                        <strong>å¤§å°:</strong> <span id="selectedFileSize"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸Šä¼ è¿›åº¦æ˜¾ç¤º -->
        <div id="uploadProgressContainer" style="display: none;" class="mt-3">
            <div class="card border-primary">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-upload text-primary"></i>
                        æ–‡ä»¶ä¸Šä¼ è¿›åº¦
                    </h6>
                </div>
                <div class="card-body">
                    <div class="progress mb-2" style="height: 20px;">
                        <div id="uploadProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                             role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="row text-muted small">
                        <div class="col-4">
                            <i class="fas fa-percentage"></i>
                            <span id="uploadPercentage">0%</span>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-tachometer-alt"></i>
                            <span id="uploadSpeed">0 MB/s</span>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-clock"></i>
                            <span id="uploadTimeRemaining">è®¡ç®—ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

### æ­¥éª¤2.2ï¼šå®ç°æ–‡ä»¶é€‰æ‹©å’ŒéªŒè¯

#### ä»»åŠ¡æ¸…å•
- [ ] ç»‘å®šæ–‡ä»¶é€‰æ‹©äº‹ä»¶
- [ ] å®ç°æ–‡ä»¶æ ¼å¼éªŒè¯
- [ ] æ·»åŠ æ–‡ä»¶å¤§å°æ£€æŸ¥
- [ ] æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯

#### å®ç°ä»£ç 
```javascript
// æ–‡ä»¶ä¸Šä¼ æ¨¡å—åˆå§‹åŒ–
function initializeFileUpload() {
    console.log('ğŸ“ åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ æ¨¡å—...');
    
    const fileInput = document.getElementById('videoFile');
    const dropZone = document.getElementById('fileDropZone');
    
    // ç»‘å®šæ–‡ä»¶é€‰æ‹©äº‹ä»¶
    if (fileInput) {
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleFileSelection(file);
            }
        });
    }
    
    // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
    if (dropZone) {
        initializeFileDragDrop();
    }
}

// æ–‡ä»¶é€‰æ‹©å¤„ç†
function handleFileSelection(file) {
    console.log('ğŸ“„ å¤„ç†æ–‡ä»¶é€‰æ‹©:', file.name);
    
    // æ–‡ä»¶éªŒè¯
    if (!validateFile(file)) {
        return;
    }
    
    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
    displayFileInfo(file);
    
    // è§¦å‘æ™ºèƒ½é¢„è®¾é€‰æ‹©
    initializeSmartPresetSelection();
}

// æ–‡ä»¶éªŒè¯
function validateFile(file) {
    console.log('ğŸ” éªŒè¯æ–‡ä»¶:', file.name);
    
    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
    const allowedExtensions = ['.mp4', '.avi', '.mov', '.mkv', '.wmv', '.flv', '.webm', '.m4v'];
    const fileName = file.name.toLowerCase();
    const isValidType = allowedExtensions.some(ext => fileName.endsWith(ext));
    
    if (!isValidType) {
        showAlert('danger', `ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ã€‚æ”¯æŒçš„æ ¼å¼: ${allowedExtensions.join(', ')}`);
        return false;
    }
    
    // æ£€æŸ¥æ–‡ä»¶å¤§å° (2GBé™åˆ¶)
    const maxSize = 2 * 1024 * 1024 * 1024; // 2GB
    if (file.size > maxSize) {
        showAlert('danger', `æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶: ${formatFileSize(file.size)} > ${formatFileSize(maxSize)}`);
        return false;
    }
    
    // æ£€æŸ¥æœ€å°æ–‡ä»¶å¤§å°
    if (file.size < 1024) {
        showAlert('danger', 'æ–‡ä»¶å¤ªå°ï¼Œå¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„è§†é¢‘æ–‡ä»¶');
        return false;
    }
    
    console.log('âœ… æ–‡ä»¶éªŒè¯é€šè¿‡');
    return true;
}

// æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
function displayFileInfo(file) {
    console.log('ğŸ“‹ æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯');
    
    const fileInfoDiv = document.getElementById('selectedFileInfo');
    const fileName = document.getElementById('selectedFileName');
    const fileSize = document.getElementById('selectedFileSize');
    
    if (fileName) fileName.textContent = file.name;
    if (fileSize) fileSize.textContent = formatFileSize(file.size);
    if (fileInfoDiv) fileInfoDiv.style.display = 'block';
}
```

### æ­¥éª¤2.3ï¼šå®ç°æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½

#### ä»»åŠ¡æ¸…å•
- [ ] ç»‘å®šæ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
- [ ] å®ç°æ‹–æ‹½è§†è§‰åé¦ˆ
- [ ] å¤„ç†æ–‡ä»¶æ‹–æ‹½é‡Šæ”¾
- [ ] é˜²æ­¢é»˜è®¤æµè§ˆå™¨è¡Œä¸º

#### å®ç°ä»£ç 
```javascript
// æ‹–æ‹½åŠŸèƒ½åˆå§‹åŒ–
function initializeFileDragDrop() {
    console.log('ğŸ¯ åˆå§‹åŒ–æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½...');

    const dropZone = document.getElementById('fileDropZone');

    // é˜²æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // æ‹–æ‹½è¿›å…¥/ç¦»å¼€è§†è§‰åé¦ˆ
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    // æ–‡ä»¶æ‹–æ‹½å¤„ç†
    dropZone.addEventListener('drop', handleDrop, false);
}

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

function highlight(e) {
    e.currentTarget.classList.add('dragover');
}

function unhighlight(e) {
    e.currentTarget.classList.remove('dragover');
}

function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;

    if (files.length > 0) {
        const fileInput = document.getElementById('videoFile');
        fileInput.files = files;
        handleFileSelection(files[0]);
    }
}
```

### æ­¥éª¤2.4ï¼šå®ç°å¤§æ–‡ä»¶ä¸Šä¼ å¤„ç†

#### ä»»åŠ¡æ¸…å•
- [ ] æ£€æµ‹æ–‡ä»¶å¤§å°é˜ˆå€¼
- [ ] å®ç°å¤§æ–‡ä»¶ä¸Šä¼ APIè°ƒç”¨
- [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦è·Ÿè¸ª
- [ ] å¤„ç†ä¸Šä¼ é”™è¯¯

#### å®ç°ä»£ç 
```javascript
// å¤§æ–‡ä»¶ä¸Šä¼ å¤„ç†
async function handleLargeFileUpload(file, formData) {
    console.log('ğŸ“¤ å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ :', file.name);

    const isLargeFile = file.size > 100 * 1024 * 1024; // 100MBé˜ˆå€¼

    if (isLargeFile) {
        console.log('ğŸ”„ ä½¿ç”¨å¤§æ–‡ä»¶ä¸Šä¼ API');

        // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
        showUploadProgress();

        try {
            const response = await fetch('/api/upload/large-file', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                console.log('âœ… å¤§æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');
                hideUploadProgress();
                return result;
            } else {
                throw new Error(result.message || 'ä¸Šä¼ å¤±è´¥');
            }
        } catch (error) {
            console.error('âŒ å¤§æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
            hideUploadProgress();
            throw error;
        }
    } else {
        console.log('ğŸ“¤ ä½¿ç”¨æ ‡å‡†ä¸Šä¼ æ–¹å¼');
        return await handleNormalUpload(formData);
    }
}

// æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
function showUploadProgress() {
    const container = document.getElementById('uploadProgressContainer');
    if (container) {
        container.style.display = 'block';
    }
}

// éšè—ä¸Šä¼ è¿›åº¦
function hideUploadProgress() {
    const container = document.getElementById('uploadProgressContainer');
    if (container) {
        container.style.display = 'none';
    }
}

// æ›´æ–°ä¸Šä¼ è¿›åº¦
function updateUploadProgress(data) {
    const progressBar = document.getElementById('uploadProgressBar');
    const percentage = document.getElementById('uploadPercentage');
    const speed = document.getElementById('uploadSpeed');
    const timeRemaining = document.getElementById('uploadTimeRemaining');

    if (progressBar && data.Progress) {
        progressBar.style.width = `${data.Progress}%`;
        progressBar.setAttribute('aria-valuenow', data.Progress);
    }

    if (percentage && data.Progress) {
        percentage.textContent = `${data.Progress}%`;
    }

    if (speed && data.Speed) {
        speed.textContent = formatFileSize(data.Speed) + '/s';
    }

    if (timeRemaining && data.EstimatedTimeRemaining) {
        timeRemaining.textContent = formatTime(data.EstimatedTimeRemaining);
    }
}
```

## ğŸ“¡ ç¬¬ä¸‰é˜¶æ®µï¼šSignalRé€šä¿¡æ¨¡å—

### æ­¥éª¤3.1ï¼šå»ºç«‹SignalRè¿æ¥

#### ä»»åŠ¡æ¸…å•
- [ ] é…ç½®SignalRè¿æ¥å‚æ•°
- [ ] å®ç°è¿æ¥å¯åŠ¨å‡½æ•°
- [ ] æ·»åŠ è¿æ¥çŠ¶æ€ç›‘æ§
- [ ] å¤„ç†è¿æ¥é”™è¯¯

#### å®ç°ä»£ç 
```javascript
// SignalRè¿æ¥åˆå§‹åŒ–
function initializeSignalR() {
    console.log('ğŸ“¡ åˆå§‹åŒ–SignalRè¿æ¥...');

    // è®¾ç½®è¿æ¥çŠ¶æ€äº‹ä»¶
    setupConnectionEvents();

    // å¯åŠ¨è¿æ¥
    startConnection();

    // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
    registerSignalREvents();
}

// å¯åŠ¨SignalRè¿æ¥
async function startConnection() {
    try {
        console.log('ğŸ”Œ å¯åŠ¨SignalRè¿æ¥...');
        await connection.start();
        console.log("âœ… SignalRè¿æ¥æˆåŠŸ");
        updateConnectionStatus('Connected');
        showAlert('success', 'SignalRè¿æ¥å·²å»ºç«‹ï¼Œå¯ä»¥å®æ—¶æ¥æ”¶è½¬æ¢è¿›åº¦');

        // è¿æ¥æˆåŠŸååŠ è½½æœ€è¿‘ä»»åŠ¡
        loadRecentTasks();
    } catch (err) {
        console.error("âŒ SignalRè¿æ¥å¤±è´¥:", err);
        updateConnectionStatus('Failed');
        showAlert('danger', 'SignalRè¿æ¥å¤±è´¥ï¼Œè¿›åº¦æ›´æ–°å¯èƒ½ä¸å¯ç”¨');

        // 5ç§’åé‡è¯•è¿æ¥
        setTimeout(startConnection, 5000);
    }
}

// è¿æ¥çŠ¶æ€äº‹ä»¶å¤„ç†
function setupConnectionEvents() {
    // é‡è¿ä¸­äº‹ä»¶
    connection.onreconnecting((error) => {
        console.log("ğŸ”„ SignalRé‡è¿ä¸­...", error);
        updateConnectionStatus('Reconnecting');
        showAlert('warning', 'SignalRè¿æ¥ä¸­æ–­ï¼Œæ­£åœ¨é‡è¿...');
    });

    // é‡è¿æˆåŠŸäº‹ä»¶
    connection.onreconnected((connectionId) => {
        console.log("âœ… SignalRé‡è¿æˆåŠŸ:", connectionId);
        updateConnectionStatus('Connected');
        showAlert('success', 'SignalRè¿æ¥å·²æ¢å¤');

        // é‡è¿åé‡æ–°åŠ å…¥ä»»åŠ¡ç»„
        if (currentTaskId) {
            connection.invoke("JoinTaskGroup", currentTaskId).catch(err => {
                console.error("é‡æ–°åŠ å…¥ä»»åŠ¡ç»„å¤±è´¥:", err);
            });
        }

        // åˆ·æ–°ä»»åŠ¡çŠ¶æ€
        loadRecentTasks();
    });

    // è¿æ¥å…³é—­äº‹ä»¶
    connection.onclose((error) => {
        console.warn("âš ï¸ SignalRè¿æ¥å·²å…³é—­:", error);
        updateConnectionStatus('Disconnected');
        showAlert('warning', 'SignalRè¿æ¥å·²æ–­å¼€');
    });
}
```

### æ­¥éª¤3.2ï¼šæ³¨å†ŒSignalRäº‹ä»¶ç›‘å¬å™¨

#### ä»»åŠ¡æ¸…å•
- [ ] æ³¨å†Œè¿›åº¦æ›´æ–°äº‹ä»¶
- [ ] æ³¨å†Œä»»åŠ¡çŠ¶æ€äº‹ä»¶
- [ ] æ³¨å†Œä¸Šä¼ è¿›åº¦äº‹ä»¶
- [ ] æ³¨å†Œé”™è¯¯å¤„ç†äº‹ä»¶

#### å®ç°ä»£ç 
```javascript
// æ³¨å†ŒSignalRäº‹ä»¶ç›‘å¬å™¨
function registerSignalREvents() {
    console.log('ğŸ“‹ æ³¨å†ŒSignalRäº‹ä»¶ç›‘å¬å™¨...');

    // ç›‘å¬è¿›åº¦æ›´æ–°
    connection.on("ProgressUpdate", function (data) {
        console.log("ğŸ“Š æ”¶åˆ°è¿›åº¦æ›´æ–°:", data);
        updateProgress(data);
    });

    // ç›‘å¬ä»»åŠ¡å¼€å§‹
    connection.on("TaskStarted", function (data) {
        console.log("ğŸš€ ä»»åŠ¡å¼€å§‹:", data);
        handleTaskStarted(data);
    });

    // ç›‘å¬ä»»åŠ¡å®Œæˆ
    connection.on("TaskCompleted", function (data) {
        console.log("âœ… ä»»åŠ¡å®Œæˆ:", data);
        handleTaskCompleted(data);
    });

    // ç›‘å¬ä»»åŠ¡å¤±è´¥
    connection.on("TaskFailed", function (data) {
        console.log("âŒ ä»»åŠ¡å¤±è´¥:", data);
        handleTaskFailed(data);
    });

    // ç›‘å¬ä¸Šä¼ è¿›åº¦
    connection.on("UploadProgress", function (data) {
        console.log("ğŸ“¤ ä¸Šä¼ è¿›åº¦:", data);
        updateUploadProgress(data);
    });

    // ç›‘å¬ä¸Šä¼ å®Œæˆ
    connection.on("UploadCompleted", function (data) {
        console.log("âœ… ä¸Šä¼ å®Œæˆ:", data);
        showAlert('success', `æ–‡ä»¶ä¸Šä¼ å®Œæˆ: ${data.FilePath}`);
        hideUploadProgress();
    });

    // ç›‘å¬ä¸Šä¼ å¤±è´¥
    connection.on("UploadFailed", function (data) {
        console.log("âŒ ä¸Šä¼ å¤±è´¥:", data);
        showAlert('danger', `ä¸Šä¼ å¤±è´¥: ${data.ErrorMessage}`);
        hideUploadProgress();
    });

    // ç›‘å¬ç³»ç»Ÿé€šçŸ¥
    connection.on("SystemNotification", function (data) {
        console.log("ğŸ“¢ ç³»ç»Ÿé€šçŸ¥:", data);
        showAlert(data.type || 'info', data.message);
    });

    // ç›‘å¬é”™è¯¯
    connection.on("Error", function (message) {
        console.error("âŒ SignalRé”™è¯¯:", message);
        showAlert('danger', 'SignalRé”™è¯¯: ' + message);
    });
}
```

## âš™ï¸ ç¬¬å››é˜¶æ®µï¼šè½¬æ¢è®¾ç½®æ¨¡å—

### æ­¥éª¤4.1ï¼šåˆ›å»ºæ™ºèƒ½é¢„è®¾é€‰æ‹©åŠŸèƒ½

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç°GPUèƒ½åŠ›æ£€æµ‹
- [ ] åˆ›å»ºé¢„è®¾ä¼˜å…ˆçº§æ˜ å°„
- [ ] å®ç°è‡ªåŠ¨é¢„è®¾é€‰æ‹©
- [ ] æ·»åŠ é¢„è®¾é€‰æ‹©é€šçŸ¥

#### å®ç°ä»£ç 
```javascript
// æ™ºèƒ½é¢„è®¾é€‰æ‹©åˆå§‹åŒ–
async function initializeSmartPresetSelection() {
    try {
        console.log('ğŸ” å¼€å§‹æ™ºèƒ½GPUé¢„è®¾é€‰æ‹©...');

        // 1. æ£€æŸ¥GPUèƒ½åŠ›
        const gpuResponse = await fetch('/api/gpu/capabilities');
        const gpuData = await gpuResponse.json();

        if (gpuData.success && gpuData.data) {
            const capabilities = gpuData.data;
            console.log('GPUèƒ½åŠ›æ£€æµ‹ç»“æœ:', capabilities);

            // 2. æ ¹æ®GPUç±»å‹é€‰æ‹©é¢„è®¾
            if (capabilities.nvidia && capabilities.nvidia.supported) {
                selectBestGpuPreset('nvenc');
                console.log('âœ… è‡ªåŠ¨é€‰æ‹©NVIDIA GPUé¢„è®¾');
            } else if (capabilities.intel && capabilities.intel.supported) {
                selectBestGpuPreset('qsv');
                console.log('âœ… è‡ªåŠ¨é€‰æ‹©Intel GPUé¢„è®¾');
            } else if (capabilities.amd && capabilities.amd.supported) {
                selectBestGpuPreset('amf');
                console.log('âœ… è‡ªåŠ¨é€‰æ‹©AMD GPUé¢„è®¾');
            } else {
                console.log('â„¹ï¸ æœªæ£€æµ‹åˆ°GPUæ”¯æŒï¼Œä½¿ç”¨é»˜è®¤CPUé¢„è®¾');
                selectDefaultCpuPreset();
            }
        } else {
            console.log('âš ï¸ GPUæ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é¢„è®¾');
            selectDefaultCpuPreset();
        }
    } catch (error) {
        console.error('âŒ æ™ºèƒ½é¢„è®¾é€‰æ‹©å¤±è´¥:', error);
        selectDefaultCpuPreset();
    }
}

// é€‰æ‹©æœ€ä½³GPUé¢„è®¾
function selectBestGpuPreset(gpuType) {
    const presetSelect = document.getElementById('preset');
    if (!presetSelect) return;

    // é¢„è®¾ä¼˜å…ˆçº§æ˜ å°„
    const presetPriority = {
        'nvenc': [
            'GPU Fast 1080p (NVENC)',
            'GPU High Quality 1080p (NVENC)',
            'GPU 4K Ultra (NVENC)'
        ],
        'qsv': [
            'GPU Fast 1080p (QSV)',
            'GPU High Quality 1080p (QSV)'
        ],
        'amf': [
            'GPU Fast 1080p (AMF)',
            'GPU High Quality 1080p (AMF)'
        ]
    };

    const preferredPresets = presetPriority[gpuType] || [];

    // æŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾å¹¶é€‰æ‹©é¢„è®¾
    for (const presetName of preferredPresets) {
        for (let i = 0; i < presetSelect.options.length; i++) {
            if (presetSelect.options[i].text.includes(presetName) ||
                presetSelect.options[i].value === presetName) {
                presetSelect.selectedIndex = i;
                updateAdvancedSettings(presetName);

                // æ˜¾ç¤ºGPUåŠ é€Ÿæç¤º
                showGpuAccelNotification(presetName, gpuType);
                return;
            }
        }
    }
}

// é€‰æ‹©é»˜è®¤CPUé¢„è®¾
function selectDefaultCpuPreset() {
    const presetSelect = document.getElementById('preset');
    if (!presetSelect) return;

    // æŸ¥æ‰¾CPUé¢„è®¾
    for (let i = 0; i < presetSelect.options.length; i++) {
        const optionText = presetSelect.options[i].text.toLowerCase();
        if (optionText.includes('cpu') || optionText.includes('standard')) {
            presetSelect.selectedIndex = i;
            updateAdvancedSettings(presetSelect.options[i].value);
            break;
        }
    }
}

// æ˜¾ç¤ºGPUåŠ é€Ÿé€šçŸ¥
function showGpuAccelNotification(presetName, gpuType) {
    const gpuTypeMap = {
        'nvenc': 'NVIDIA',
        'qsv': 'Intel',
        'amf': 'AMD'
    };

    const gpuName = gpuTypeMap[gpuType] || gpuType;
    showAlert('info', `ğŸš€ å·²å¯ç”¨${gpuName} GPUç¡¬ä»¶åŠ é€Ÿï¼Œè½¬æ¢é€Ÿåº¦å°†æ˜¾è‘—æå‡ï¼`);
}

// æ›´æ–°é«˜çº§è®¾ç½®
function updateAdvancedSettings(presetName) {
    console.log('âš™ï¸ æ›´æ–°é«˜çº§è®¾ç½®:', presetName);

    // æ ¹æ®é¢„è®¾åç§°æ›´æ–°å„ç§è®¾ç½®
    const presetConfig = getPresetConfiguration(presetName);

    if (presetConfig) {
        // æ›´æ–°è¾“å‡ºæ ¼å¼
        if (presetConfig.outputFormat) {
            const outputFormat = document.getElementById('outputFormat');
            if (outputFormat) outputFormat.value = presetConfig.outputFormat;
        }

        // æ›´æ–°è§†é¢‘ç¼–è§£ç å™¨
        if (presetConfig.videoCodec) {
            const videoCodec = document.getElementById('videoCodec');
            if (videoCodec) videoCodec.value = presetConfig.videoCodec;
        }

        // æ›´æ–°è´¨é‡è®¾ç½®
        if (presetConfig.quality) {
            const videoQuality = document.getElementById('videoQuality');
            const qualityValue = document.getElementById('qualityValue');
            if (videoQuality) videoQuality.value = presetConfig.quality;
            if (qualityValue) qualityValue.textContent = presetConfig.quality;
        }

        // æ›´æ–°åˆ†è¾¨ç‡
        if (presetConfig.resolution) {
            const resolution = document.getElementById('resolution');
            if (resolution) resolution.value = presetConfig.resolution;
        }
    }
}

// è·å–é¢„è®¾é…ç½®
function getPresetConfiguration(presetName) {
    const presetConfigs = {
        'GPU Fast 1080p (NVENC)': {
            outputFormat: 'mp4',
            videoCodec: 'h264_nvenc',
            resolution: '1920x1080',
            quality: 23
        },
        'GPU High Quality 1080p (NVENC)': {
            outputFormat: 'mp4',
            videoCodec: 'h264_nvenc',
            resolution: '1920x1080',
            quality: 18
        },
        'GPU Fast 1080p (QSV)': {
            outputFormat: 'mp4',
            videoCodec: 'h264_qsv',
            resolution: '1920x1080',
            quality: 23
        },
        'GPU Fast 1080p (AMF)': {
            outputFormat: 'mp4',
            videoCodec: 'h264_amf',
            resolution: '1920x1080',
            quality: 23
        }
        // å¯ä»¥æ·»åŠ æ›´å¤šé¢„è®¾é…ç½®...
    };

    return presetConfigs[presetName] || null;
}
```

### æ­¥éª¤4.2ï¼šå®ç°è¡¨å•æäº¤å¤„ç†

#### ä»»åŠ¡æ¸…å•
- [ ] ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
- [ ] å®ç°è¡¨å•æ•°æ®éªŒè¯
- [ ] å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ é€»è¾‘
- [ ] æ·»åŠ æäº¤çŠ¶æ€ç®¡ç†

#### å®ç°ä»£ç 
```javascript
// è¡¨å•æäº¤å¤„ç†åˆå§‹åŒ–
function initializeFormSubmission() {
    console.log('ğŸ“ åˆå§‹åŒ–è¡¨å•æäº¤å¤„ç†...');

    const form = document.getElementById('conversionForm');
    if (form) {
        form.addEventListener('submit', handleFormSubmit);
    }

    // ç»‘å®šè´¨é‡æ»‘å—äº‹ä»¶
    const qualitySlider = document.getElementById('videoQuality');
    const qualityValue = document.getElementById('qualityValue');
    if (qualitySlider && qualityValue) {
        qualitySlider.addEventListener('input', function() {
            qualityValue.textContent = this.value;
        });
    }
}

// è¡¨å•æäº¤å¤„ç†
async function handleFormSubmit(e) {
    e.preventDefault();

    console.log('ğŸ“¤ å¤„ç†è¡¨å•æäº¤...');

    const fileInput = document.getElementById('videoFile');
    const file = fileInput.files[0];

    if (!file) {
        showAlert('warning', 'è¯·é€‰æ‹©è¦è½¬æ¢çš„è§†é¢‘æ–‡ä»¶');
        return;
    }

    // åˆ›å»ºFormData
    const formData = new FormData(e.target);

    // å¤„ç†å¤é€‰æ¡†å€¼
    const checkboxes = ['twoPass', 'fastStart', 'copyTimestamps'];
    checkboxes.forEach(name => {
        const checkbox = document.getElementById(name);
        if (checkbox) {
            formData.delete(name);
            formData.append(name, checkbox.checked ? 'true' : 'false');
        }
    });

    try {
        // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
        updateSubmitButtonState('submitting');

        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼Œå†³å®šä½¿ç”¨å“ªç§ä¸Šä¼ æ–¹å¼
        const isLargeFile = file.size > 100 * 1024 * 1024; // 100MB

        let result;
        if (isLargeFile) {
            result = await handleLargeFileUpload(file, formData);
        } else {
            result = await handleNormalFileUpload(formData);
        }

        if (result.success) {
            showAlert('success', 'è½¬æ¢ä»»åŠ¡å·²æäº¤');
            // ä»»åŠ¡å¼€å§‹äº‹ä»¶ä¼šé€šè¿‡SignalRæ¥æ”¶
        } else {
            throw new Error(result.message || 'æäº¤å¤±è´¥');
        }
    } catch (error) {
        console.error('è¡¨å•æäº¤å¤±è´¥:', error);
        showAlert('danger', 'æäº¤å¤±è´¥: ' + error.message);
    } finally {
        // æ¢å¤æäº¤æŒ‰é’®çŠ¶æ€
        updateSubmitButtonState('normal');
    }
}

// æ™®é€šæ–‡ä»¶ä¸Šä¼ 
async function handleNormalFileUpload(formData) {
    console.log('ğŸ“¤ å¤„ç†æ™®é€šæ–‡ä»¶ä¸Šä¼ ...');

    const response = await fetch('/api/conversion/start', {
        method: 'POST',
        body: formData
    });

    return await response.json();
}

// æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
function updateSubmitButtonState(state) {
    const button = document.getElementById('startConversion');
    if (!button) return;

    switch (state) {
        case 'submitting':
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';
            break;
        case 'normal':
        default:
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹è½¬æ¢';
            break;
    }
}
```

## ğŸ“Š ç¬¬äº”é˜¶æ®µï¼šä»»åŠ¡ç®¡ç†æ¨¡å—

### æ­¥éª¤5.1ï¼šåˆ›å»ºä»»åŠ¡æ˜¾ç¤ºç•Œé¢

#### ä»»åŠ¡æ¸…å•
- [ ] è®¾è®¡å½“å‰ä»»åŠ¡æ˜¾ç¤ºåŒºåŸŸ
- [ ] åˆ›å»ºè¿›åº¦æ¡å’ŒçŠ¶æ€æ˜¾ç¤º
- [ ] æ·»åŠ ä»»åŠ¡æ“ä½œæŒ‰é’®
- [ ] å®ç°æœ€è¿‘ä»»åŠ¡åˆ—è¡¨

#### å®ç°ä»£ç 
```html
<!-- å½“å‰ä»»åŠ¡æ˜¾ç¤ºåŒºåŸŸ -->
<div id="currentTaskSection" class="card mb-4" style="display: none;">
    <div class="card-header bg-primary text-white">
        <h6 class="mb-0">
            <i class="fas fa-cog fa-spin"></i>
            å½“å‰è½¬æ¢ä»»åŠ¡
        </h6>
    </div>
    <div class="card-body">
        <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">
                <span id="currentTaskName">ä»»åŠ¡åç§°</span>
            </h6>
            <small class="text-muted" id="taskId">ä»»åŠ¡ID</small>
        </div>

        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <div class="row mb-3" id="fileInfo" style="display: none;">
            <div class="col-6">
                <small class="text-muted">åŸå§‹æ–‡ä»¶</small><br>
                <span id="originalFileName" class="fw-bold"></span>
            </div>
            <div class="col-6">
                <small class="text-muted">è¾“å‡ºæ ¼å¼</small><br>
                <span id="outputFormat" class="fw-bold"></span>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress mb-3" style="height: 25px;">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                 role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <span class="fw-bold">0%</span>
            </div>
        </div>

        <!-- è¯¦ç»†çŠ¶æ€ä¿¡æ¯ -->
        <div class="row text-center mb-3">
            <div class="col-3">
                <small class="text-muted">è½¬æ¢é€Ÿåº¦</small><br>
                <span id="conversionSpeed" class="fw-bold">-</span>
            </div>
            <div class="col-3">
                <small class="text-muted">å‰©ä½™æ—¶é—´</small><br>
                <span id="remainingTime" class="fw-bold">-</span>
            </div>
            <div class="col-3">
                <small class="text-muted">å·²ç”¨æ—¶é—´</small><br>
                <span id="elapsedTime" class="fw-bold">-</span>
            </div>
            <div class="col-3">
                <small class="text-muted">æ–‡ä»¶å¤§å°</small><br>
                <span id="fileSize" class="fw-bold">-</span>
            </div>
        </div>

        <!-- å½“å‰çŠ¶æ€ -->
        <div class="alert alert-info mb-3" role="alert" id="taskStatusAlert">
            <i class="fas fa-info-circle"></i>
            <span id="taskStatus">ç­‰å¾…ä¸­...</span>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="d-flex gap-2" id="taskActionButtons">
            <button type="button" class="btn btn-outline-danger btn-sm" id="cancelTask">
                <i class="fas fa-stop"></i> å–æ¶ˆè½¬æ¢
            </button>
            <button type="button" class="btn btn-outline-info btn-sm" id="refreshTask" style="display: none;">
                <i class="fas fa-sync"></i> åˆ·æ–°çŠ¶æ€
            </button>
            <a class="btn btn-outline-success btn-sm" id="downloadTask" style="display: none;">
                <i class="fas fa-download"></i> ä¸‹è½½æ–‡ä»¶
            </a>
            <button type="button" class="btn btn-outline-primary btn-sm" id="restartTask" style="display: none;">
                <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
            </button>
        </div>
    </div>
</div>

<!-- æœ€è¿‘ä»»åŠ¡åˆ—è¡¨ -->
<div id="recentTasksSection" class="card">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="fas fa-history text-secondary"></i>
            æœ€è¿‘ä»»åŠ¡
        </h6>
    </div>
    <div class="card-body">
        <div id="recentTasks">
            <p class="text-muted text-center">æš‚æ— æœ€è¿‘ä»»åŠ¡</p>
        </div>
    </div>
</div>
```

### æ­¥éª¤5.2ï¼šå®ç°ä»»åŠ¡çŠ¶æ€ç®¡ç†

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç°ä»»åŠ¡å¼€å§‹å¤„ç†
- [ ] æ·»åŠ è¿›åº¦æ›´æ–°é€»è¾‘
- [ ] å¤„ç†ä»»åŠ¡å®Œæˆå’Œå¤±è´¥
- [ ] å®ç°ä»»åŠ¡æ“ä½œåŠŸèƒ½

#### å®ç°ä»£ç 
```javascript
// ä»»åŠ¡ç®¡ç†æ¨¡å—åˆå§‹åŒ–
function initializeTaskManagement() {
    console.log('ğŸ“Š åˆå§‹åŒ–ä»»åŠ¡ç®¡ç†æ¨¡å—...');

    // ç»‘å®šä»»åŠ¡æ“ä½œæŒ‰é’®äº‹ä»¶
    bindTaskActionButtons();

    // åŠ è½½æœ€è¿‘ä»»åŠ¡
    loadRecentTasks();
}

// ä»»åŠ¡å¼€å§‹å¤„ç†
function handleTaskStarted(data) {
    console.log('ğŸš€ ä»»åŠ¡å¼€å§‹:', data);

    currentTaskId = data.taskId;
    currentTaskStartTime = new Date();

    // æ˜¾ç¤ºå½“å‰ä»»åŠ¡
    showCurrentTask(data);

    // åŠ å…¥ä»»åŠ¡ç»„ä»¥æ¥æ”¶è¿›åº¦æ›´æ–°
    connection.invoke("JoinTaskGroup", data.taskId).catch(err => {
        console.error("åŠ å…¥ä»»åŠ¡ç»„å¤±è´¥:", err);
    });

    // å¼€å§‹è®¡æ—¶
    startTaskTimer();

    // æ›´æ–°UIçŠ¶æ€
    updateTaskActionButtons('running');

    // æ˜¾ç¤ºé€šçŸ¥
    showAlert('info', `è½¬æ¢ä»»åŠ¡å·²å¼€å§‹: ${data.fileName || data.taskId}`);
}

// æ˜¾ç¤ºå½“å‰ä»»åŠ¡
function showCurrentTask(data) {
    console.log('ğŸ“‹ æ˜¾ç¤ºå½“å‰ä»»åŠ¡');

    const currentTaskSection = document.getElementById('currentTaskSection');
    const taskName = document.getElementById('currentTaskName');
    const taskIdElement = document.getElementById('taskId');
    const originalFileName = document.getElementById('originalFileName');
    const fileInfo = document.getElementById('fileInfo');

    // æ›´æ–°ä»»åŠ¡ä¿¡æ¯
    if (taskName) taskName.textContent = data.fileName || data.taskId;
    if (taskIdElement) taskIdElement.textContent = data.taskId;

    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
    if (data.fileName && originalFileName) {
        originalFileName.textContent = data.fileName;
        if (fileInfo) fileInfo.style.display = 'block';
    }

    // é‡ç½®è¿›åº¦æ¡
    resetProgressBar();

    // æ˜¾ç¤ºä»»åŠ¡å®¹å™¨
    if (currentTaskSection) {
        currentTaskSection.style.display = 'block';
    }
}

// é‡ç½®è¿›åº¦æ¡
function resetProgressBar() {
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
        progressBar.style.width = '0%';
        progressBar.setAttribute('aria-valuenow', '0');
        progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated';
        const span = progressBar.querySelector('span');
        if (span) span.textContent = '0%';
    }
}

// è¿›åº¦æ›´æ–°å¤„ç†
function updateProgress(data) {
    if (!data || !data.taskId || data.taskId !== currentTaskId) return;

    console.log('ğŸ“Š æ›´æ–°è¿›åº¦:', data.progress + '%');

    // æ›´æ–°è¿›åº¦æ¡
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
        progressBar.style.width = `${data.progress}%`;
        progressBar.setAttribute('aria-valuenow', data.progress);
        const span = progressBar.querySelector('span');
        if (span) span.textContent = `${data.progress}%`;
    }

    // æ›´æ–°è¯¦ç»†ä¿¡æ¯
    updateTaskDetails(data);

    // æ›´æ–°æœ€è¿‘ä»»åŠ¡åˆ—è¡¨ä¸­çš„è¿›åº¦
    updateRecentTaskProgress(data.taskId, data.progress);
}

// æ›´æ–°ä»»åŠ¡è¯¦ç»†ä¿¡æ¯
function updateTaskDetails(data) {
    // æ›´æ–°è½¬æ¢é€Ÿåº¦
    if (data.speed) {
        const speedElement = document.getElementById('conversionSpeed');
        if (speedElement) speedElement.textContent = data.speed;
    }

    // æ›´æ–°å‰©ä½™æ—¶é—´
    if (data.remainingSeconds) {
        const remainingElement = document.getElementById('remainingTime');
        if (remainingElement) {
            remainingElement.textContent = formatTime(data.remainingSeconds);
        }
    }

    // æ›´æ–°å·²ç”¨æ—¶é—´
    if (currentTaskStartTime) {
        const elapsedSeconds = Math.floor((new Date() - currentTaskStartTime) / 1000);
        const elapsedElement = document.getElementById('elapsedTime');
        if (elapsedElement) {
            elapsedElement.textContent = formatTime(elapsedSeconds);
        }
    }

    // æ›´æ–°çŠ¶æ€æ¶ˆæ¯
    if (data.message) {
        const statusElement = document.getElementById('taskStatus');
        if (statusElement) statusElement.textContent = data.message;
    }
}

// ä»»åŠ¡å®Œæˆå¤„ç†
function handleTaskCompleted(data) {
    console.log('âœ… ä»»åŠ¡å®Œæˆ:', data);

    currentTaskId = null;
    currentTaskStartTime = null;

    // æ›´æ–°è¿›åº¦æ¡ä¸º100%
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
        progressBar.style.width = '100%';
        progressBar.setAttribute('aria-valuenow', '100');
        progressBar.classList.remove('progress-bar-animated');
        progressBar.classList.add('bg-success');
        const span = progressBar.querySelector('span');
        if (span) span.textContent = '100%';
    }

    // æ›´æ–°çŠ¶æ€
    updateTaskStatus('è½¬æ¢å®Œæˆï¼', 'success');

    // æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
    if (data.downloadUrl) {
        showDownloadButton(data.downloadUrl, data.fileName);
    }

    // æ›´æ–°æ“ä½œæŒ‰é’®
    updateTaskActionButtons('completed');

    // åˆ·æ–°æœ€è¿‘ä»»åŠ¡åˆ—è¡¨
    loadRecentTasks();

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    const duration = data.duration ? ` (è€—æ—¶: ${formatTime(data.duration)})` : '';
    showAlert('success', `è½¬æ¢å®Œæˆ: ${data.fileName || data.taskId}${duration}`);
}

// ä»»åŠ¡å¤±è´¥å¤„ç†
function handleTaskFailed(data) {
    console.log('âŒ ä»»åŠ¡å¤±è´¥:', data);

    currentTaskId = null;
    currentTaskStartTime = null;

    // æ›´æ–°è¿›åº¦æ¡æ ·å¼
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
        progressBar.classList.remove('progress-bar-animated');
        progressBar.classList.add('bg-danger');
    }

    // æ›´æ–°çŠ¶æ€
    updateTaskStatus(`è½¬æ¢å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}`, 'danger');

    // æ›´æ–°æ“ä½œæŒ‰é’®
    updateTaskActionButtons('failed');

    // åˆ·æ–°æœ€è¿‘ä»»åŠ¡åˆ—è¡¨
    loadRecentTasks();

    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    showAlert('danger', `è½¬æ¢å¤±è´¥: ${data.fileName || data.taskId} - ${data.error || 'æœªçŸ¥é”™è¯¯'}`);
}

// æ›´æ–°ä»»åŠ¡çŠ¶æ€æ˜¾ç¤º
function updateTaskStatus(message, type) {
    const statusAlert = document.getElementById('taskStatusAlert');
    const statusElement = document.getElementById('taskStatus');

    if (statusElement) statusElement.textContent = message;
    if (statusAlert) {
        statusAlert.className = `alert alert-${type} mb-3`;
    }
}

// æ˜¾ç¤ºä¸‹è½½æŒ‰é’®
function showDownloadButton(downloadUrl, fileName) {
    const downloadBtn = document.getElementById('downloadTask');
    if (downloadBtn) {
        downloadBtn.href = downloadUrl;
        downloadBtn.download = fileName || 'converted_video';
        downloadBtn.style.display = 'inline-block';
    }
}

// æ›´æ–°ä»»åŠ¡æ“ä½œæŒ‰é’®çŠ¶æ€
function updateTaskActionButtons(status) {
    const cancelBtn = document.getElementById('cancelTask');
    const refreshBtn = document.getElementById('refreshTask');
    const downloadBtn = document.getElementById('downloadTask');
    const restartBtn = document.getElementById('restartTask');

    // éšè—æ‰€æœ‰æŒ‰é’®
    [cancelBtn, refreshBtn, downloadBtn, restartBtn].forEach(btn => {
        if (btn) btn.style.display = 'none';
    });

    // æ ¹æ®çŠ¶æ€æ˜¾ç¤ºç›¸åº”æŒ‰é’®
    switch (status) {
        case 'running':
            if (cancelBtn) cancelBtn.style.display = 'inline-block';
            if (refreshBtn) refreshBtn.style.display = 'inline-block';
            break;
        case 'completed':
            if (downloadBtn) downloadBtn.style.display = 'inline-block';
            if (restartBtn) restartBtn.style.display = 'inline-block';
            break;
        case 'failed':
            if (refreshBtn) refreshBtn.style.display = 'inline-block';
            if (restartBtn) restartBtn.style.display = 'inline-block';
            break;
    }
}
```

## ğŸ–¥ï¸ ç¬¬å…­é˜¶æ®µï¼šGPUç¡¬ä»¶åŠ é€Ÿæ¨¡å—

### æ­¥éª¤6.1ï¼šåˆ›å»ºGPUä¿¡æ¯æ˜¾ç¤ºç•Œé¢

#### ä»»åŠ¡æ¸…å•
- [ ] è®¾è®¡GPUä¿¡æ¯å¡ç‰‡
- [ ] æ·»åŠ GPUçŠ¶æ€æŒ‡ç¤ºå™¨
- [ ] åˆ›å»ºåˆ·æ–°æŒ‰é’®
- [ ] å®ç°åŠ è½½çŠ¶æ€æ˜¾ç¤º

#### å®ç°ä»£ç 
```html
<!-- GPUä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
<div id="gpuInfoSection" class="card mb-4">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
                <i class="fas fa-microchip text-primary"></i>
                GPUç¡¬ä»¶åŠ é€Ÿ
            </h6>
            <button class="btn btn-outline-primary btn-sm" onclick="loadGpuInfo()">
                <i class="fas fa-redo"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div id="gpuInfo">
            <!-- GPUä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>
    </div>
</div>
```

### æ­¥éª¤6.2ï¼šå®ç°GPUæ£€æµ‹é€»è¾‘

#### ä»»åŠ¡æ¸…å•
- [ ] å®ç°GPUä¿¡æ¯åŠ è½½å‡½æ•°
- [ ] æ·»åŠ GPUä¿¡æ¯æ˜¾ç¤ºé€»è¾‘
- [ ] å¤„ç†GPUæ£€æµ‹é”™è¯¯
- [ ] åˆ›å»ºGPUå¡ç‰‡ç”Ÿæˆå™¨

#### å®ç°ä»£ç 
```javascript
// GPUæ¨¡å—åˆå§‹åŒ–
function initializeGpuModule() {
    console.log('ğŸ–¥ï¸ åˆå§‹åŒ–GPUæ¨¡å—...');

    // åŠ è½½GPUä¿¡æ¯
    loadGpuInfo();
}

// GPUä¿¡æ¯åŠ è½½
async function loadGpuInfo() {
    const gpuInfoDiv = document.getElementById('gpuInfo');
    if (!gpuInfoDiv) return;

    try {
        console.log('ğŸ” æ£€æµ‹GPUç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›...');

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        gpuInfoDiv.innerHTML = `
            <div class="text-center">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">æ£€æµ‹ä¸­...</span>
                </div>
                <p class="mt-2 mb-0 text-muted">æ­£åœ¨æ£€æµ‹GPUç¡¬ä»¶åŠ é€Ÿèƒ½åŠ›...</p>
            </div>
        `;

        const response = await fetch('/api/gpu/capabilities');
        const result = await response.json();

        if (result.success) {
            displayGpuInfo(result.data);
        } else {
            displayGpuError('è·å–GPUä¿¡æ¯å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
        }
    } catch (error) {
        console.error('GPUä¿¡æ¯åŠ è½½å¤±è´¥:', error);
        displayGpuError('æ— æ³•è¿æ¥åˆ°GPUæ£€æµ‹æœåŠ¡');
    }
}

// æ˜¾ç¤ºGPUä¿¡æ¯
function displayGpuInfo(gpuData) {
    const gpuInfoDiv = document.getElementById('gpuInfo');
    if (!gpuInfoDiv) return;

    console.log('ğŸ“Š æ˜¾ç¤ºGPUä¿¡æ¯:', gpuData);

    if (!gpuData.hasAnyGpuSupport) {
        // æ— GPUæ”¯æŒçš„æƒ…å†µ
        gpuInfoDiv.innerHTML = `
            <div class="text-center text-muted py-3">
                <i class="fas fa-exclamation-triangle fa-2x text-warning mb-3"></i>
                <h6>æœªæ£€æµ‹åˆ°GPUç¡¬ä»¶åŠ é€Ÿæ”¯æŒ</h6>
                <p class="mb-2">ç³»ç»Ÿå°†ä½¿ç”¨CPUè¿›è¡Œè§†é¢‘è½¬ç </p>
                <small class="text-muted">
                    æ£€æµ‹æ—¶é—´: ${new Date().toLocaleString()}
                </small>
            </div>
        `;
        return;
    }

    // æœ‰GPUæ”¯æŒçš„æƒ…å†µ
    let html = `
        <div class="alert alert-success mb-3">
            <strong><i class="fas fa-check-circle"></i> GPUç¡¬ä»¶åŠ é€Ÿå¯ç”¨!</strong><br>
            <small>æ”¯æŒçš„GPUç±»å‹: ${getSupportedGpuTypes(gpuData)}</small>
        </div>
    `;

    // NVIDIA NVENC
    if (gpuData.nvidia && gpuData.nvidia.supported) {
        html += generateGpuCard('NVIDIA NVENC', gpuData.nvidia, 'success');
    }

    // Intel QSV
    if (gpuData.intel && gpuData.intel.supported) {
        html += generateGpuCard('Intel QSV', gpuData.intel, 'info');
    }

    // AMD AMF
    if (gpuData.amd && gpuData.amd.supported) {
        html += generateGpuCard('AMD AMF', gpuData.amd, 'warning');
    }

    html += `
        <div class="mt-3">
            <small class="text-muted">
                <i class="fas fa-clock"></i> æ£€æµ‹æ—¶é—´: ${new Date().toLocaleString()}
            </small>
        </div>
    `;

    gpuInfoDiv.innerHTML = html;
}

// ç”ŸæˆGPUå¡ç‰‡
function generateGpuCard(title, gpuInfo, variant) {
    const iconMap = {
        'NVIDIA NVENC': 'fas fa-microchip text-success',
        'Intel QSV': 'fas fa-microchip text-info',
        'AMD AMF': 'fas fa-microchip text-warning'
    };

    return `
        <div class="card mb-2 border-${variant}">
            <div class="card-body p-3">
                <h6 class="card-title">
                    <i class="${iconMap[title] || 'fas fa-microchip'}"></i> ${title}
                </h6>
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted">è®¾å¤‡æ•°é‡</small><br>
                        <span class="fw-bold">${gpuInfo.deviceCount || 0}</span>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">ç¼–ç å™¨æ•°é‡</small><br>
                        <span class="fw-bold">${gpuInfo.encoders?.length || 0}</span>
                    </div>
                </div>
                ${gpuInfo.encoders && gpuInfo.encoders.length > 0 ? `
                    <div class="mt-2">
                        <small class="text-muted">æ”¯æŒçš„ç¼–ç å™¨:</small><br>
                        <div class="d-flex flex-wrap gap-1 mt-1">
                            ${gpuInfo.encoders.map(encoder =>
                                `<span class="badge bg-${variant}">${encoder}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// è·å–æ”¯æŒçš„GPUç±»å‹åˆ—è¡¨
function getSupportedGpuTypes(gpuData) {
    const types = [];
    if (gpuData.nvidia?.supported) types.push('NVIDIA');
    if (gpuData.intel?.supported) types.push('Intel');
    if (gpuData.amd?.supported) types.push('AMD');
    return types.join(', ') || 'æ— ';
}

// æ˜¾ç¤ºGPUé”™è¯¯ä¿¡æ¯
function displayGpuError(errorMessage) {
    const gpuInfoDiv = document.getElementById('gpuInfo');
    if (!gpuInfoDiv) return;

    gpuInfoDiv.innerHTML = `
        <div class="alert alert-warning">
            <h6><i class="fas fa-exclamation-triangle"></i> GPUä¿¡æ¯åŠ è½½å¤±è´¥</h6>
            <p class="mb-2">${errorMessage}</p>
            <button class="btn btn-outline-primary btn-sm" onclick="loadGpuInfo()">
                <i class="fas fa-redo"></i> é‡æ–°æ£€æµ‹
            </button>
        </div>
    `;
}
```

## ğŸ›¡ï¸ ç¬¬ä¸ƒé˜¶æ®µï¼šé”™è¯¯å¤„ç†å’Œä¼˜åŒ–

### æ­¥éª¤7.1ï¼šå®ç°å…¨å±€é”™è¯¯å¤„ç†

#### ä»»åŠ¡æ¸…å•
- [ ] åˆ›å»ºé”™è¯¯åˆ†ç±»ç³»ç»Ÿ
- [ ] å®ç°é”™è¯¯æ¢å¤æœºåˆ¶
- [ ] æ·»åŠ æ•…éšœæ’é™¤å»ºè®®
- [ ] è®¾ç½®æ€§èƒ½ä¼˜åŒ–

#### å®ç°ä»£ç 
```javascript
// å…¨å±€é”™è¯¯å¤„ç†åˆå§‹åŒ–
function initializeErrorHandling() {
    console.log('ğŸ›¡ï¸ åˆå§‹åŒ–é”™è¯¯å¤„ç†ç³»ç»Ÿ...');

    // è®¾ç½®å…¨å±€é”™è¯¯ç›‘å¬å™¨
    window.addEventListener('error', handleGlobalError);
    window.addEventListener('unhandledrejection', handleUnhandledRejection);

    // è®¾ç½®é¡µé¢å¸è½½æ¸…ç†
    window.addEventListener('beforeunload', cleanupResources);
}

// å…¨å±€é”™è¯¯å¤„ç†å™¨
function handleGlobalError(event) {
    console.error('å…¨å±€é”™è¯¯:', event.error);

    const error = event.error;
    const context = event.filename ? `${event.filename}:${event.lineno}` : 'æœªçŸ¥ä½ç½®';

    handleError(error, context, { global: true });
}

// æœªå¤„ç†çš„Promiseæ‹’ç»
function handleUnhandledRejection(event) {
    console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);

    handleError(event.reason, 'Promiseæ‹’ç»', { promise: true });
    event.preventDefault(); // é˜²æ­¢é»˜è®¤çš„é”™è¯¯å¤„ç†
}

// ç»Ÿä¸€é”™è¯¯å¤„ç†å‡½æ•°
function handleError(error, context, options = {}) {
    console.error(`é”™è¯¯å‘ç”Ÿåœ¨ ${context}:`, error);

    // é”™è¯¯åˆ†ç±»å¤„ç†
    const errorType = classifyError(error);

    switch (errorType) {
        case 'NetworkError':
            handleNetworkError(error, context, options);
            break;
        case 'ValidationError':
            handleValidationError(error, context, options);
            break;
        case 'ServerError':
            handleServerError(error, context, options);
            break;
        case 'TimeoutError':
            handleTimeoutError(error, context, options);
            break;
        default:
            handleGenericError(error, context, options);
    }

    // è®°å½•é”™è¯¯åˆ°æ§åˆ¶å°å’Œå¯èƒ½çš„æ—¥å¿—æœåŠ¡
    logError(error, context);
}

// é”™è¯¯åˆ†ç±»
function classifyError(error) {
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
        return 'NetworkError';
    }
    if (error.name === 'ValidationError' || error.status === 400) {
        return 'ValidationError';
    }
    if (error.status >= 500) {
        return 'ServerError';
    }
    if (error.name === 'TimeoutError' || error.code === 'TIMEOUT') {
        return 'TimeoutError';
    }
    return 'GenericError';
}

// ç½‘ç»œé”™è¯¯å¤„ç†
function handleNetworkError(error, context, options) {
    showAlert('warning', 'ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');

    // å°è¯•é‡æ–°è¿æ¥SignalR
    if (context.includes('SignalR')) {
        setTimeout(() => {
            console.log('å°è¯•é‡æ–°è¿æ¥SignalR...');
            startConnection();
        }, 5000);
    }
}

// èµ„æºæ¸…ç†
function cleanupResources() {
    console.log('ğŸ§¹ æ¸…ç†é¡µé¢èµ„æº...');

    // æ¸…ç†å®šæ—¶å™¨
    if (window.taskTimer) {
        clearInterval(window.taskTimer);
    }

    // æ–­å¼€SignalRè¿æ¥
    if (connection && connection.state === signalR.HubConnectionState.Connected) {
        try {
            if (currentTaskId) {
                connection.invoke("LeaveTaskGroup", currentTaskId);
            }
            connection.stop();
        } catch (error) {
            console.error('å…³é—­SignalRè¿æ¥æ—¶å‡ºé”™:', error);
        }
    }
}

// é”™è¯¯æ—¥å¿—è®°å½•
function logError(error, context) {
    const errorLog = {
        timestamp: new Date().toISOString(),
        context: context,
        message: error.message,
        stack: error.stack,
        userAgent: navigator.userAgent,
        url: window.location.href
    };

    console.error('é”™è¯¯æ—¥å¿—:', errorLog);

    // å¯ä»¥å‘é€åˆ°æ—¥å¿—æœåŠ¡
    // sendErrorToLoggingService(errorLog);
}
```

## ğŸ§ª ç¬¬å…«é˜¶æ®µï¼šæµ‹è¯•å’Œéƒ¨ç½²

### æ­¥éª¤8.1ï¼šåŠŸèƒ½æµ‹è¯•æ¸…å•

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] **æ–‡ä»¶ä¸Šä¼ æµ‹è¯•**
  - [ ] æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
  - [ ] ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
  - [ ] æ–‡ä»¶æ ¼å¼éªŒè¯
  - [ ] æ–‡ä»¶å¤§å°é™åˆ¶
  - [ ] å¤§æ–‡ä»¶ä¸Šä¼ è¿›åº¦

- [ ] **è½¬æ¢è®¾ç½®æµ‹è¯•**
  - [ ] é¢„è®¾é€‰æ‹©åŠŸèƒ½
  - [ ] æ™ºèƒ½GPUé¢„è®¾é€‰æ‹©
  - [ ] é«˜çº§è®¾ç½®é…ç½®
  - [ ] è¡¨å•éªŒè¯

- [ ] **SignalRé€šä¿¡æµ‹è¯•**
  - [ ] è¿æ¥å»ºç«‹å’Œæ–­å¼€
  - [ ] è‡ªåŠ¨é‡è¿æœºåˆ¶
  - [ ] å®æ—¶è¿›åº¦æ›´æ–°
  - [ ] äº‹ä»¶å¤„ç†

- [ ] **ä»»åŠ¡ç®¡ç†æµ‹è¯•**
  - [ ] ä»»åŠ¡å¼€å§‹æ˜¾ç¤º
  - [ ] è¿›åº¦å®æ—¶æ›´æ–°
  - [ ] ä»»åŠ¡å®Œæˆå¤„ç†
  - [ ] ä»»åŠ¡å¤±è´¥å¤„ç†
  - [ ] ä»»åŠ¡æ“ä½œæŒ‰é’®

- [ ] **GPUåŠŸèƒ½æµ‹è¯•**
  - [ ] GPUä¿¡æ¯æ£€æµ‹
  - [ ] GPUçŠ¶æ€æ˜¾ç¤º
  - [ ] åˆ·æ–°åŠŸèƒ½
  - [ ] é”™è¯¯å¤„ç†

#### é”™è¯¯åœºæ™¯æµ‹è¯•
- [ ] **ç½‘ç»œé”™è¯¯æµ‹è¯•**
  - [ ] æ–­ç½‘æƒ…å†µå¤„ç†
  - [ ] æœåŠ¡å™¨ä¸å¯ç”¨
  - [ ] è¶…æ—¶å¤„ç†

- [ ] **æ–‡ä»¶é”™è¯¯æµ‹è¯•**
  - [ ] æ— æ•ˆæ–‡ä»¶æ ¼å¼
  - [ ] æŸåçš„æ–‡ä»¶
  - [ ] è¶…å¤§æ–‡ä»¶

- [ ] **è½¬æ¢é”™è¯¯æµ‹è¯•**
  - [ ] è½¬æ¢å¤±è´¥å¤„ç†
  - [ ] ä»»åŠ¡å–æ¶ˆ
  - [ ] æœåŠ¡å™¨é”™è¯¯

### æ­¥éª¤8.2ï¼šæ€§èƒ½ä¼˜åŒ–æ£€æŸ¥

#### æ€§èƒ½ä¼˜åŒ–æ¸…å•
- [ ] **JavaScriptä¼˜åŒ–**
  - [ ] é˜²æŠ–å’ŒèŠ‚æµå®ç°
  - [ ] å†…å­˜æ³„æ¼æ£€æŸ¥
  - [ ] äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
  - [ ] DOMæ“ä½œä¼˜åŒ–

- [ ] **ç½‘ç»œä¼˜åŒ–**
  - [ ] APIè¯·æ±‚ä¼˜åŒ–
  - [ ] ç¼“å­˜ç­–ç•¥
  - [ ] å¤§æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–

- [ ] **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
  - [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤º
  - [ ] é”™è¯¯æç¤ºå‹å¥½æ€§
  - [ ] æ“ä½œåé¦ˆåŠæ—¶æ€§

### æ­¥éª¤8.3ï¼šéƒ¨ç½²å‡†å¤‡

#### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] **ä»£ç è´¨é‡æ£€æŸ¥**
  - [ ] ä»£ç æ ¼å¼åŒ–
  - [ ] æ³¨é‡Šå®Œæ•´æ€§
  - [ ] é”™è¯¯å¤„ç†è¦†ç›–
  - [ ] æ—¥å¿—è®°å½•

- [ ] **é…ç½®æ£€æŸ¥**
  - [ ] APIç«¯ç‚¹é…ç½®
  - [ ] SignalR Hubé…ç½®
  - [ ] æ–‡ä»¶ä¸Šä¼ é™åˆ¶
  - [ ] å®‰å…¨è®¾ç½®

- [ ] **æµè§ˆå™¨å…¼å®¹æ€§**
  - [ ] Chromeæµ‹è¯•
  - [ ] Firefoxæµ‹è¯•
  - [ ] Edgeæµ‹è¯•
  - [ ] Safariæµ‹è¯•

### æ­¥éª¤8.4ï¼šå®Œæ•´çš„é¡µé¢åˆå§‹åŒ–å‡½æ•°

#### æœ€ç»ˆåˆå§‹åŒ–ä»£ç 
```javascript
// é¡µé¢å®Œæ•´åˆå§‹åŒ–å‡½æ•°
function initializePageComponents() {
    console.log('ğŸ¨ åˆå§‹åŒ–é¡µé¢ç»„ä»¶...');

    try {
        // 1. åˆå§‹åŒ–åŸºç¡€å·¥å…·å‡½æ•°
        setupUtilityFunctions();

        // 2. åˆå§‹åŒ–é”™è¯¯å¤„ç†
        initializeErrorHandling();

        // 3. åˆå§‹åŒ–SignalRè¿æ¥
        initializeSignalR();

        // 4. åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ æ¨¡å—
        initializeFileUpload();

        // 5. åˆå§‹åŒ–è¡¨å•æäº¤å¤„ç†
        initializeFormSubmission();

        // 6. åˆå§‹åŒ–ä»»åŠ¡ç®¡ç†
        initializeTaskManagement();

        // 7. åˆå§‹åŒ–GPUæ¨¡å—
        initializeGpuModule();

        // 8. ç»‘å®šå…¨å±€äº‹ä»¶
        bindGlobalEvents();

        console.log('âœ… æ‰€æœ‰é¡µé¢ç»„ä»¶åˆå§‹åŒ–å®Œæˆ');

    } catch (error) {
        console.error('âŒ é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
        showAlert('danger', 'é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
}

// ç»‘å®šå…¨å±€äº‹ä»¶
function bindGlobalEvents() {
    console.log('ğŸ”— ç»‘å®šå…¨å±€äº‹ä»¶...');

    // ç»‘å®šä»»åŠ¡æ“ä½œæŒ‰é’®äº‹ä»¶
    bindTaskActionButtons();

    // ç»‘å®šé¢„è®¾é€‰æ‹©å˜åŒ–äº‹ä»¶
    const presetSelect = document.getElementById('preset');
    if (presetSelect) {
        presetSelect.addEventListener('change', function() {
            updateAdvancedSettings(this.value);
        });
    }
}

// ç»‘å®šä»»åŠ¡æ“ä½œæŒ‰é’®äº‹ä»¶
function bindTaskActionButtons() {
    // å–æ¶ˆä»»åŠ¡æŒ‰é’®
    const cancelBtn = document.getElementById('cancelTask');
    if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
            if (currentTaskId) {
                cancelTask(currentTaskId);
            }
        });
    }

    // åˆ·æ–°ä»»åŠ¡çŠ¶æ€æŒ‰é’®
    const refreshBtn = document.getElementById('refreshTask');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            if (currentTaskId) {
                refreshTaskStatus(currentTaskId);
            }
        });
    }

    // é‡æ–°å¼€å§‹ä»»åŠ¡æŒ‰é’®
    const restartBtn = document.getElementById('restartTask');
    if (restartBtn) {
        restartBtn.addEventListener('click', function() {
            // é‡ç½®è¡¨å•å¹¶é‡æ–°å¼€å§‹
            const form = document.getElementById('conversionForm');
            if (form) {
                form.dispatchEvent(new Event('submit'));
            }
        });
    }
}

// ä»»åŠ¡æ“ä½œå‡½æ•°
async function cancelTask(taskId) {
    if (!taskId) return;

    try {
        const response = await fetch(`/api/conversion/cancel/${taskId}`, {
            method: 'POST'
        });

        const result = await response.json();

        if (result.success) {
            showAlert('success', 'ä»»åŠ¡å–æ¶ˆè¯·æ±‚å·²å‘é€');
        } else {
            throw new Error(result.message || 'å–æ¶ˆå¤±è´¥');
        }
    } catch (error) {
        console.error('å–æ¶ˆä»»åŠ¡å¤±è´¥:', error);
        showAlert('danger', 'å–æ¶ˆä»»åŠ¡å¤±è´¥: ' + error.message);
    }
}

// åˆ·æ–°ä»»åŠ¡çŠ¶æ€
async function refreshTaskStatus(taskId) {
    if (!taskId || !connection || connection.state !== signalR.HubConnectionState.Connected) {
        showAlert('warning', 'æ— æ³•åˆ·æ–°ä»»åŠ¡çŠ¶æ€ï¼šè¿æ¥ä¸å¯ç”¨');
        return;
    }

    try {
        await connection.invoke("GetTaskStatus", taskId);
        showAlert('info', 'å·²è¯·æ±‚åˆ·æ–°ä»»åŠ¡çŠ¶æ€');
    } catch (error) {
        console.error('åˆ·æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error);
        showAlert('danger', 'åˆ·æ–°å¤±è´¥: ' + error.message);
    }
}

// åŠ è½½æœ€è¿‘ä»»åŠ¡
async function loadRecentTasks() {
    try {
        const response = await fetch('/api/conversion/recent?count=10');
        const result = await response.json();

        if (result.success) {
            displayRecentTasks(result.data);
        }
    } catch (error) {
        console.error('åŠ è½½æœ€è¿‘ä»»åŠ¡å¤±è´¥:', error);
    }
}

// æ˜¾ç¤ºæœ€è¿‘ä»»åŠ¡
function displayRecentTasks(tasks) {
    const recentTasksDiv = document.getElementById('recentTasks');
    if (!recentTasksDiv) return;

    if (!tasks || tasks.length === 0) {
        recentTasksDiv.innerHTML = '<p class="text-muted text-center">æš‚æ— æœ€è¿‘ä»»åŠ¡</p>';
        return;
    }

    let html = '';
    tasks.forEach(task => {
        const statusClass = task.status === 'Completed' ? 'success' :
                           task.status === 'Failed' ? 'danger' :
                           task.status === 'Running' ? 'primary' : 'secondary';

        html += `
            <div class="card mb-2">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="card-title mb-1">${task.fileName || task.taskName}</h6>
                            <small class="text-muted">${task.createdAt}</small>
                        </div>
                        <span class="badge bg-${statusClass}">${task.status}</span>
                    </div>
                    ${task.progress ? `
                        <div class="progress mt-2" style="height: 4px;">
                            <div class="progress-bar" style="width: ${task.progress}%"></div>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    });

    recentTasksDiv.innerHTML = html;
}

// å¼€å§‹ä»»åŠ¡è®¡æ—¶å™¨
function startTaskTimer() {
    if (window.taskTimer) {
        clearInterval(window.taskTimer);
    }

    window.taskTimer = setInterval(() => {
        if (currentTaskStartTime) {
            const elapsedSeconds = Math.floor((new Date() - currentTaskStartTime) / 1000);
            const elapsedElement = document.getElementById('elapsedTime');
            if (elapsedElement) {
                elapsedElement.textContent = formatTime(elapsedSeconds);
            }
        }
    }, 1000);
}
```

## ğŸ“‹ å¼€å‘å®Œæˆæ£€æŸ¥æ¸…å•

### âœ… åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥
- [ ] æ–‡ä»¶ä¸Šä¼ æ¨¡å—å®Œæ•´å®ç°
- [ ] SignalRé€šä¿¡æ¨¡å—æ­£å¸¸å·¥ä½œ
- [ ] è½¬æ¢è®¾ç½®æ¨¡å—åŠŸèƒ½å®Œå–„
- [ ] ä»»åŠ¡ç®¡ç†æ¨¡å—çŠ¶æ€æ­£ç¡®
- [ ] GPUç¡¬ä»¶åŠ é€Ÿæ¨¡å—æ£€æµ‹å‡†ç¡®
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶è¦†ç›–å…¨é¢

### âœ… ä»£ç è´¨é‡æ£€æŸ¥
- [ ] ä»£ç æ³¨é‡Šè¯¦ç»†å®Œæ•´
- [ ] å‡½æ•°å‘½åæ¸…æ™°æ˜“æ‡‚
- [ ] é”™è¯¯å¤„ç†è¦†ç›–å……åˆ†
- [ ] æ€§èƒ½ä¼˜åŒ–æªæ–½åˆ°ä½
- [ ] å†…å­˜ç®¡ç†æœºåˆ¶å®Œå–„

### âœ… ç”¨æˆ·ä½“éªŒæ£€æŸ¥
- [ ] ç•Œé¢å“åº”åŠæ—¶
- [ ] æ“ä½œåé¦ˆæ˜ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½
- [ ] åŠ è½½çŠ¶æ€æ¸…æ™°
- [ ] åŠŸèƒ½å¼•å¯¼å®Œå–„

### âœ… å®‰å…¨æ€§æ£€æŸ¥
- [ ] æ–‡ä»¶ä¸Šä¼ éªŒè¯ä¸¥æ ¼
- [ ] è¾“å…¥å‚æ•°éªŒè¯å®Œæ•´
- [ ] XSSé˜²æŠ¤æªæ–½
- [ ] CSRFä¿æŠ¤æœºåˆ¶

## ğŸ‰ æ€»ç»“

é€šè¿‡ä»¥ä¸Š8ä¸ªé˜¶æ®µçš„è¯¦ç»†å¼€å‘æ­¥éª¤ï¼Œæ‚¨å¯ä»¥å®Œæ•´å®ç°Indexé¡µé¢çš„æ‰€æœ‰åŠŸèƒ½ï¼š

1. **åŸºç¡€æ¶æ„** - å»ºç«‹äº†åšå®çš„é¡µé¢åŸºç¡€å’Œå·¥å…·å‡½æ•°
2. **æ–‡ä»¶ä¸Šä¼ ** - å®ç°äº†å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ å’ŒéªŒè¯æœºåˆ¶
3. **SignalRé€šä¿¡** - å»ºç«‹äº†å¯é çš„å®æ—¶é€šä¿¡ç³»ç»Ÿ
4. **è½¬æ¢è®¾ç½®** - æä¾›äº†æ™ºèƒ½çš„é¢„è®¾é€‰æ‹©å’Œé…ç½®åŠŸèƒ½
5. **ä»»åŠ¡ç®¡ç†** - å®ç°äº†å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
6. **GPUç¡¬ä»¶åŠ é€Ÿ** - æä¾›äº†å‡†ç¡®çš„GPUæ£€æµ‹å’Œæ˜¾ç¤º
7. **é”™è¯¯å¤„ç†** - å»ºç«‹äº†å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
8. **æµ‹è¯•éƒ¨ç½²** - ç¡®ä¿äº†ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒ

è¿™ä¸ªå®ç°æ–¹æ¡ˆå…·å¤‡äº†ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„æ‰€æœ‰ç‰¹æ€§ï¼ŒåŒ…æ‹¬æ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†ã€ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§è€ƒè™‘ã€‚
