# 任务1：基础架构搭建

## 📋 任务概述

建立Index页面的基础架构，包括页面布局、全局变量初始化、基础工具函数和JavaScript架构设计。

## 🎯 任务目标

- [ ] 创建响应式页面布局
- [ ] 设置全局变量和配置
- [ ] 实现基础工具函数
- [ ] 建立JavaScript初始化架构

## 📝 详细任务清单

### 步骤1.1：创建页面基础结构

#### 任务清单
- [ ] 创建响应式布局容器
- [ ] 设置页面标题和导航
- [ ] 添加基础CSS样式
- [ ] 创建主要区域划分

#### 实现代码
```html
<!-- 页面头部 -->
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">
                <i class="fas fa-video text-primary"></i>
                视频转换工具
            </h1>
        </div>
    </div>
    
    <!-- 主要内容区域 -->
    <div class="row">
        <!-- 左侧：文件上传和设置 -->
        <div class="col-lg-8">
            <div id="fileUploadSection">
                <!-- 文件上传区域 - 待实现 -->
            </div>
            <div id="conversionSettings">
                <!-- 转换设置区域 - 待实现 -->
            </div>
        </div>
        
        <!-- 右侧：状态和信息 -->
        <div class="col-lg-4">
            <div id="currentTaskSection">
                <!-- 当前任务显示 - 待实现 -->
            </div>
            <div id="gpuInfoSection">
                <!-- GPU信息显示 - 待实现 -->
            </div>
            <div id="recentTasksSection">
                <!-- 最近任务列表 - 待实现 -->
            </div>
        </div>
    </div>
</div>
```

### 步骤1.2：初始化JavaScript架构

#### 任务清单
- [ ] 创建全局变量和配置
- [ ] 设置页面初始化函数
- [ ] 添加基础工具函数
- [ ] 建立错误处理框架

#### 实现代码
```javascript
<script>
// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    console.log('📄 Index页面初始化开始...');
    
    // 全局变量初始化
    initializeGlobalVariables();
    
    // 基础工具函数设置
    setupUtilityFunctions();
    
    // 页面组件初始化
    initializePageComponents();
    
    console.log('✅ Index页面初始化完成');
});

// 全局变量
let currentTaskId = null;
let connectionState = 'Disconnected';
let currentTaskStartTime = null;
let lastProgressUpdate = null;
let connection = null;

// 全局变量初始化
function initializeGlobalVariables() {
    console.log('🔧 初始化全局变量...');
    
    // SignalR连接配置
    connection = new signalR.HubConnectionBuilder()
        .withUrl("/conversionHub")
        .withAutomaticReconnect([0, 2000, 10000, 30000])
        .configureLogging(signalR.LogLevel.Information)
        .build();
}

// 基础工具函数
function setupUtilityFunctions() {
    console.log('🛠️ 设置基础工具函数...');
    // 工具函数将在后续步骤中实现
}

// 页面组件初始化
function initializePageComponents() {
    console.log('🎨 初始化页面组件...');
    // 各个模块的初始化将在后续步骤中实现
}
</script>
```

### 步骤1.3：添加基础工具函数

#### 任务清单
- [ ] 实现消息提示函数
- [ ] 添加文件大小格式化函数
- [ ] 创建时间格式化函数
- [ ] 实现连接状态更新函数

#### 实现代码
```javascript
// 基础工具函数实现
function setupUtilityFunctions() {
    console.log('🛠️ 设置基础工具函数...');
    
    // 消息提示函数
    window.showAlert = function(type, message) {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                type === 'danger' ? 'exclamation-triangle' : 
                                'info-circle'}"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const container = document.querySelector('.container-fluid');
        container.insertBefore(alertDiv, container.firstChild);
        
        // 5秒后自动消失
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    };
    
    // 文件大小格式化
    window.formatFileSize = function(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return `${(bytes / Math.pow(k, i)).toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;
    };
    
    // 时间格式化
    window.formatTime = function(seconds) {
        if (!seconds || seconds <= 0) return '-';
        
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        if (hours > 0) {
            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        } else {
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
    };
    
    // 连接状态更新
    window.updateConnectionStatus = function(status) {
        connectionState = status;
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
            statusElement.textContent = status;
            statusElement.className = `badge ${status === 'Connected' ? 'bg-success' : 
                                               status === 'Reconnecting' ? 'bg-warning' : 'bg-danger'}`;
        }
    };
}
```

## ✅ 验收标准

### 功能验收
- [ ] 页面布局正确显示
- [ ] 全局变量正确初始化
- [ ] 工具函数正常工作
- [ ] 控制台无错误信息

### 代码质量验收
- [ ] 代码格式规范
- [ ] 注释详细完整
- [ ] 变量命名清晰
- [ ] 函数职责单一

### 测试验收
- [ ] 页面加载正常
- [ ] JavaScript初始化成功
- [ ] 工具函数测试通过
- [ ] 浏览器兼容性测试

## 🔗 依赖关系

### 前置依赖
- [ ] .NET 8.0 项目环境
- [ ] Bootstrap 5.x CSS框架
- [ ] Font Awesome 图标库
- [ ] SignalR JavaScript客户端库

### 后续任务
- 任务2：文件上传模块
- 任务3：SignalR通信模块

## 📊 预估工时

- **开发时间**: 2-3小时
- **测试时间**: 1小时
- **总计**: 3-4小时

## 🚨 注意事项

1. **响应式设计**: 确保在不同屏幕尺寸下布局正确
2. **浏览器兼容**: 测试主流浏览器的兼容性
3. **性能考虑**: 避免不必要的DOM操作
4. **错误处理**: 为每个函数添加适当的错误处理

## 📝 完成标记

任务完成后，请在此处标记：

- [ ] 步骤1.1完成
- [ ] 步骤1.2完成  
- [ ] 步骤1.3完成
- [ ] 验收测试通过
- [ ] 代码提交完成

**完成时间**: ___________  
**开发者**: ___________  
**审核者**: ___________
