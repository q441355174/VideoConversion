# VideoConversion åç«¯æ•°æ®éœ€æ±‚æ¸…å•

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ—å‡ºäº†VideoConversionå‰ç«¯åº”ç”¨éœ€è¦ä»åç«¯APIè·å–çš„æ‰€æœ‰æ•°æ®ç±»å‹å’Œç»“æ„ã€‚æ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®å’Œæµ‹è¯•ä»£ç å·²è¢«ç§»é™¤ï¼Œç°åœ¨éœ€è¦çœŸå®çš„åç«¯æ•°æ®æ”¯æŒã€‚

## ğŸ® GPUç¡¬ä»¶æ£€æµ‹æ•°æ®

### 1. GPUç¡¬ä»¶ä¿¡æ¯ (`GET /api/gpu/detect`)

**æ•°æ®ç»“æ„**:
```json
{
  "success": true,
  "data": [
    {
      "name": "NVIDIA GeForce RTX 4070",
      "vendor": "NVIDIA",
      "driver": "546.17",
      "memory": "12 GB",
      "encoder": "NVENC H.264/H.265",
      "maxResolution": "8K",
      "performanceLevel": "High",
      "supported": true,
      "supportedFormats": ["H.264", "H.265", "AV1"],
      "reason": null
    }
  ]
}
```

**å­—æ®µè¯´æ˜**:
- `name`: GPUåç§°
- `vendor`: å‚å•† (NVIDIA/Intel/AMD)
- `driver`: é©±åŠ¨ç‰ˆæœ¬
- `memory`: æ˜¾å­˜å¤§å°
- `encoder`: ç¼–ç å™¨ç±»å‹
- `maxResolution`: æœ€å¤§æ”¯æŒåˆ†è¾¨ç‡
- `performanceLevel`: æ€§èƒ½ç­‰çº§ (High/Medium/Low)
- `supported`: æ˜¯å¦æ”¯æŒç¡¬ä»¶åŠ é€Ÿ
- `supportedFormats`: æ”¯æŒçš„ç¼–ç æ ¼å¼
- `reason`: ä¸æ”¯æŒçš„åŸå› ï¼ˆå¦‚æœsupportedä¸ºfalseï¼‰

### 2. GPUèƒ½åŠ›ä¿¡æ¯ (`GET /api/gpu/capabilities`)

**æ•°æ®ç»“æ„**:
```json
{
  "success": true,
  "data": {
    "hasAnyGpuSupport": true,
    "supportedTypes": "NVIDIA NVENC",
    "nvidia": {
      "supported": true,
      "encoders": ["h264_nvenc", "hevc_nvenc", "av1_nvenc"],
      "maxResolution": "8K",
      "performanceLevel": "High"
    },
    "intel": {
      "supported": true,
      "encoders": ["h264_qsv", "hevc_qsv"],
      "maxResolution": "4K",
      "performanceLevel": "Medium"
    },
    "amd": {
      "supported": false,
      "encoders": [],
      "maxResolution": "",
      "performanceLevel": "None"
    }
  }
}
```

### 3. GPUæ€§èƒ½æ•°æ® (`GET /api/gpu/performance`)

**æ•°æ®ç»“æ„**:
```json
{
  "success": true,
  "data": [
    {
      "usage": 75,
      "memoryUsed": 8192,
      "memoryTotal": 12288,
      "temperature": 65,
      "encoderActive": true
    }
  ]
}
```

**å­—æ®µè¯´æ˜**:
- `usage`: GPUä½¿ç”¨ç‡ (0-100%)
- `memoryUsed`: å·²ä½¿ç”¨æ˜¾å­˜ (MB)
- `memoryTotal`: æ€»æ˜¾å­˜ (MB)
- `temperature`: GPUæ¸©åº¦ (Â°C)
- `encoderActive`: ç¼–ç å™¨æ˜¯å¦å·¥ä½œä¸­

## ğŸ“ æ–‡ä»¶ä¸Šä¼ æ•°æ®

### 1. æ™®é€šæ–‡ä»¶ä¸Šä¼  (`POST /api/conversion/start`)

**è¯·æ±‚æ•°æ®**:
```javascript
FormData {
  videoFile: File,
  preset: "gpu_fast_1080p_nvenc",
  outputFormat: "mp4",
  videoCodec: "h264_nvenc",
  videoQuality: "23",
  audioCodec: "aac",
  audioBitrate: "192k"
}
```

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "taskId": "task-20250120-abc123",
    "fileName": "video.mp4",
    "status": "Started",
    "message": "è½¬æ¢ä»»åŠ¡å·²å¼€å§‹"
  }
}
```

### 2. å¤§æ–‡ä»¶ä¸Šä¼  (`POST /api/upload/large-file`)

**è¯·æ±‚æ•°æ®**: åŒæ™®é€šä¸Šä¼ 

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "uploadId": "upload-20250120-def456",
    "taskId": "task-20250120-abc123",
    "fileName": "large_video.mp4",
    "fileSize": 3221225472,
    "status": "Uploaded",
    "message": "å¤§æ–‡ä»¶ä¸Šä¼ å®Œæˆ"
  }
}
```

### 3. ä¸Šä¼ è¿›åº¦ (`GET /api/upload/progress/{uploadId}`)
**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "uploadId": "upload-20250120-def456",
    "progress": 75,
    "speed": 5242880,
    "estimatedTimeRemaining": 30,
    "status": "Uploading"
  }
}
```

## ğŸ“‹ ä»»åŠ¡ç®¡ç†æ•°æ®

### 1. æœ€è¿‘ä»»åŠ¡åˆ—è¡¨ (`GET /api/conversion/recent`)

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    {
      "taskId": "task-001",
      "fileName": "sample_video.mp4",
      "status": "Completed",
      "progress": 100,
      "createdAt": "2025-01-20T10:30:00.000Z",
      "downloadUrl": "/downloads/sample_video_converted.mp4",
      "duration": 300,
      "fileSize": 1073741824
    }
  ]
}
```

**å­—æ®µè¯´æ˜**:
- `taskId`: ä»»åŠ¡ID
- `fileName`: åŸæ–‡ä»¶å
- `status`: ä»»åŠ¡çŠ¶æ€ (Pending/Running/Completed/Failed/Cancelled)
- `progress`: è¿›åº¦ (0-100)
- `createdAt`: åˆ›å»ºæ—¶é—´ (ISOæ ¼å¼)
- `downloadUrl`: ä¸‹è½½é“¾æ¥ï¼ˆå®Œæˆæ—¶ï¼‰
- `duration`: è½¬æ¢è€—æ—¶ï¼ˆç§’ï¼‰
- `fileSize`: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰

### 2. ä»»åŠ¡çŠ¶æ€ (`GET /api/conversion/status/{taskId}`)

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "taskId": "task-001",
    "status": "Running",
    "progress": 45,
    "speed": "2.5x",
    "remainingSeconds": 120,
    "message": "æ­£åœ¨è½¬æ¢... 45%",
    "currentStep": "è§†é¢‘ç¼–ç ",
    "totalSteps": 4
  }
}
```

### 3. è½¬æ¢é¢„è®¾ (`GET /api/conversion/presets`)

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    {
      "id": "gpu_fast_1080p_nvenc",
      "name": "GPU Fast 1080p (NVENC)",
      "description": "ä½¿ç”¨NVIDIA GPUå¿«é€Ÿè½¬æ¢1080pè§†é¢‘",
      "gpuType": "NVIDIA",
      "outputFormat": "mp4",
      "videoCodec": "h264_nvenc",
      "resolution": "1920x1080",
      "quality": 23,
      "audioCodec": "aac",
      "audioBitrate": "192k",
      "category": "gpu",
      "recommended": true
    }
  ]
}
```

## ğŸ”— SignalRå®æ—¶æ•°æ®

### 1. Hubæ–¹æ³•è¿”å›æ•°æ®

#### GetRecentTasks(count)
```json
{
  "success": true,
  "data": [
    // åŒREST APIçš„æœ€è¿‘ä»»åŠ¡æ•°æ®ç»“æ„
  ]
}
```

#### GetTaskStatus(taskId)
```json
{
  "taskId": "task-001",
  "status": "Running",
  "progress": 45,
  "speed": "2.5x",
  "remainingSeconds": 120,
  "message": "æ­£åœ¨è½¬æ¢... 45%"
}
```

### 2. æœåŠ¡å™¨æ¨é€äº‹ä»¶æ•°æ®

#### ProgressUpdate
```json
{
  "taskId": "task-001",
  "progress": 45,
  "speed": "2.5x",
  "remainingSeconds": 120,
  "message": "æ­£åœ¨è½¬æ¢... 45%",
  "currentStep": "è§†é¢‘ç¼–ç "
}
```

#### TaskStarted
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "taskName": "è½¬æ¢ video.mp4",
  "message": "ä»»åŠ¡å·²å¼€å§‹"
}
```

#### TaskCompleted
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "downloadUrl": "/downloads/video_converted.mp4",
  "duration": 300,
  "message": "è½¬æ¢å®Œæˆ",
  "outputFileSize": 1073741824
}
```

#### TaskFailed
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "error": "ç¼–ç å™¨åˆå§‹åŒ–å¤±è´¥",
  "message": "è½¬æ¢å¤±è´¥",
  "errorCode": "ENCODER_INIT_FAILED"
}
```

## ğŸš¨ é”™è¯¯å¤„ç†æ•°æ®

### 1. é”™è¯¯æŠ¥å‘Š (`POST /api/errors/report`)

**è¯·æ±‚æ•°æ®**:
```json
{
  "type": "JavaScript Error",
  "message": "Cannot read property of undefined",
  "stack": "Error stack trace...",
  "url": "https://example.com/page",
  "userAgent": "Mozilla/5.0...",
  "timestamp": "2025-01-20T10:30:00.000Z",
  "sessionId": "session_123",
  "browserInfo": {
    "language": "zh-CN",
    "platform": "Win32",
    "screen": {"width": 1920, "height": 1080},
    "viewport": {"width": 1200, "height": 800}
  }
}
```

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "reportId": "error-report-123",
    "message": "é”™è¯¯æŠ¥å‘Šå·²æ”¶åˆ°",
    "timestamp": "2025-01-20T10:30:00.000Z"
  }
}
```

### 2. ç”¨æˆ·åé¦ˆ (`POST /api/errors/feedback`)

**è¯·æ±‚æ•°æ®**:
```json
{
  "errorId": "error-report-123",
  "userFeedback": "ç”¨æˆ·åé¦ˆå†…å®¹",
  "timestamp": "2025-01-20T10:30:00.000Z"
}
```

## ğŸ¥ ç³»ç»Ÿå¥åº·æ•°æ®

### 1. ç³»ç»ŸçŠ¶æ€ (`GET /api/health/status`)

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "status": "Healthy",
    "timestamp": "2025-01-20T10:30:00.000Z",
    "services": {
      "database": "Healthy",
      "signalr": "Healthy",
      "gpu": "Healthy",
      "storage": "Healthy"
    },
    "metrics": {
      "activeTasks": 3,
      "queuedTasks": 1,
      "completedToday": 25,
      "failedToday": 2
    }
  }
}
```

## ğŸ“Š æ•°æ®éªŒè¯è¦æ±‚

### 1. å¿…éœ€å­—æ®µéªŒè¯
- æ‰€æœ‰APIå“åº”å¿…é¡»åŒ…å«`success`å­—æ®µ
- æˆåŠŸå“åº”å¿…é¡»åŒ…å«`data`å­—æ®µ
- å¤±è´¥å“åº”å¿…é¡»åŒ…å«`message`å­—æ®µ

### 2. æ•°æ®ç±»å‹éªŒè¯
- æ—¶é—´å­—æ®µä½¿ç”¨ISO 8601æ ¼å¼
- æ–‡ä»¶å¤§å°ä½¿ç”¨å­—èŠ‚ä¸ºå•ä½
- è¿›åº¦å€¼ä¸º0-100çš„æ•´æ•°
- æ¸©åº¦å€¼ä¸ºæ‘„æ°åº¦æ•´æ•°

### 3. çŠ¶æ€å€¼æšä¸¾
- ä»»åŠ¡çŠ¶æ€: `Pending`, `Running`, `Completed`, `Failed`, `Cancelled`
- GPUå‚å•†: `NVIDIA`, `Intel`, `AMD`
- æ€§èƒ½ç­‰çº§: `High`, `Medium`, `Low`, `None`

## ğŸ”§ å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ (å¿…é¡»å®ç°)
1. **GPUæ£€æµ‹API** - `/api/gpu/detect`, `/api/gpu/capabilities`
2. **æ–‡ä»¶ä¸Šä¼ API** - `/api/conversion/start`, `/api/upload/large-file`
3. **ä»»åŠ¡ç®¡ç†API** - `/api/conversion/recent`, `/api/conversion/status/{taskId}`
4. **SignalR Hubæ–¹æ³•** - `GetRecentTasks`, `GetTaskStatus`

### ä¸­ä¼˜å…ˆçº§ (å»ºè®®å®ç°)
1. **GPUæ€§èƒ½ç›‘æ§** - `/api/gpu/performance`
2. **SignalRå®æ—¶äº‹ä»¶** - `ProgressUpdate`, `TaskCompleted`
3. **é”™è¯¯æŠ¥å‘ŠAPI** - `/api/errors/report`

### ä½ä¼˜å…ˆçº§ (å¯é€‰å®ç°)
1. **ç³»ç»Ÿå¥åº·æ£€æŸ¥** - `/api/health/status`
2. **ç”¨æˆ·åé¦ˆAPI** - `/api/errors/feedback`
3. **è½¬æ¢é¢„è®¾API** - `/api/conversion/presets`

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é”™è¯¯å¤„ç†**: æ‰€æœ‰APIéƒ½åº”è¯¥æœ‰ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
2. **æ€§èƒ½è€ƒè™‘**: GPUæ€§èƒ½æ•°æ®éœ€è¦å®šæœŸæ›´æ–°ï¼ˆå»ºè®®5ç§’é—´éš”ï¼‰
3. **æ–‡ä»¶å¤§å°**: å¤§æ–‡ä»¶ä¸Šä¼ éœ€è¦æ”¯æŒè¿›åº¦è·Ÿè¸ªå’Œæ–­ç‚¹ç»­ä¼ 
4. **å®æ—¶æ€§**: SignalRäº‹ä»¶åº”è¯¥åŠæ—¶æ¨é€ï¼Œé¿å…å»¶è¿Ÿ
5. **å®‰å…¨æ€§**: æ–‡ä»¶ä¸Šä¼ éœ€è¦éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°é™åˆ¶

è¿™ä»½æ¸…å•æ¶µç›–äº†å‰ç«¯åº”ç”¨æ­£å¸¸è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰åç«¯æ•°æ®æ”¯æŒï¼
