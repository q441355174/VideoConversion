# VideoConversion 后端数据需求清单

## 📋 概述

本文档列出了VideoConversion前端应用需要从后端API获取的所有数据类型和结构。所有模拟数据和测试代码已被移除，现在需要真实的后端数据支持。

## 🎮 GPU硬件检测数据

### 1. GPU硬件信息 (`GET /api/gpu/detect`)

**数据结构**:
```json
{
  "success": true,
  "data": [
    {
      "name": "NVIDIA GeForce RTX 4070",
      "vendor": "NVIDIA",
      "driver": "546.17",
      "memory": "12 GB",
      "encoder": "NVENC H.264/H.265",
      "maxResolution": "8K",
      "performanceLevel": "High",
      "supported": true,
      "supportedFormats": ["H.264", "H.265", "AV1"],
      "reason": null
    }
  ]
}
```

**字段说明**:
- `name`: GPU名称
- `vendor`: 厂商 (NVIDIA/Intel/AMD)
- `driver`: 驱动版本
- `memory`: 显存大小
- `encoder`: 编码器类型
- `maxResolution`: 最大支持分辨率
- `performanceLevel`: 性能等级 (High/Medium/Low)
- `supported`: 是否支持硬件加速
- `supportedFormats`: 支持的编码格式
- `reason`: 不支持的原因（如果supported为false）

### 2. GPU能力信息 (`GET /api/gpu/capabilities`)

**数据结构**:
```json
{
  "success": true,
  "data": {
    "hasAnyGpuSupport": true,
    "supportedTypes": "NVIDIA NVENC",
    "nvidia": {
      "supported": true,
      "encoders": ["h264_nvenc", "hevc_nvenc", "av1_nvenc"],
      "maxResolution": "8K",
      "performanceLevel": "High"
    },
    "intel": {
      "supported": true,
      "encoders": ["h264_qsv", "hevc_qsv"],
      "maxResolution": "4K",
      "performanceLevel": "Medium"
    },
    "amd": {
      "supported": false,
      "encoders": [],
      "maxResolution": "",
      "performanceLevel": "None"
    }
  }
}
```

### 3. GPU性能数据 (`GET /api/gpu/performance`)

**数据结构**:
```json
{
  "success": true,
  "data": [
    {
      "usage": 75,
      "memoryUsed": 8192,
      "memoryTotal": 12288,
      "temperature": 65,
      "encoderActive": true
    }
  ]
}
```

**字段说明**:
- `usage`: GPU使用率 (0-100%)
- `memoryUsed`: 已使用显存 (MB)
- `memoryTotal`: 总显存 (MB)
- `temperature`: GPU温度 (°C)
- `encoderActive`: 编码器是否工作中

## 📁 文件上传数据

### 1. 普通文件上传 (`POST /api/conversion/start`)

**请求数据**:
```javascript
FormData {
  videoFile: File,
  preset: "gpu_fast_1080p_nvenc",
  outputFormat: "mp4",
  videoCodec: "h264_nvenc",
  videoQuality: "23",
  audioCodec: "aac",
  audioBitrate: "192k"
}
```

**响应数据**:
```json
{
  "success": true,
  "data": {
    "taskId": "task-20250120-abc123",
    "fileName": "video.mp4",
    "status": "Started",
    "message": "转换任务已开始"
  }
}
```

### 2. 大文件上传 (`POST /api/upload/large-file`)

**请求数据**: 同普通上传

**响应数据**:
```json
{
  "success": true,
  "data": {
    "uploadId": "upload-20250120-def456",
    "taskId": "task-20250120-abc123",
    "fileName": "large_video.mp4",
    "fileSize": 3221225472,
    "status": "Uploaded",
    "message": "大文件上传完成"
  }
}
```

### 3. 上传进度 (`GET /api/upload/progress/{uploadId}`)
**响应数据**:
```json
{
  "success": true,
  "data": {
    "uploadId": "upload-20250120-def456",
    "progress": 75,
    "speed": 5242880,
    "estimatedTimeRemaining": 30,
    "status": "Uploading"
  }
}
```

## 📋 任务管理数据

### 1. 最近任务列表 (`GET /api/conversion/recent`)

**响应数据**:
```json
{
  "success": true,
  "data": [
    {
      "taskId": "task-001",
      "fileName": "sample_video.mp4",
      "status": "Completed",
      "progress": 100,
      "createdAt": "2025-01-20T10:30:00.000Z",
      "downloadUrl": "/downloads/sample_video_converted.mp4",
      "duration": 300,
      "fileSize": 1073741824
    }
  ]
}
```

**字段说明**:
- `taskId`: 任务ID
- `fileName`: 原文件名
- `status`: 任务状态 (Pending/Running/Completed/Failed/Cancelled)
- `progress`: 进度 (0-100)
- `createdAt`: 创建时间 (ISO格式)
- `downloadUrl`: 下载链接（完成时）
- `duration`: 转换耗时（秒）
- `fileSize`: 文件大小（字节）

### 2. 任务状态 (`GET /api/conversion/status/{taskId}`)

**响应数据**:
```json
{
  "success": true,
  "data": {
    "taskId": "task-001",
    "status": "Running",
    "progress": 45,
    "speed": "2.5x",
    "remainingSeconds": 120,
    "message": "正在转换... 45%",
    "currentStep": "视频编码",
    "totalSteps": 4
  }
}
```

### 3. 转换预设 (`GET /api/conversion/presets`)

**响应数据**:
```json
{
  "success": true,
  "data": [
    {
      "id": "gpu_fast_1080p_nvenc",
      "name": "GPU Fast 1080p (NVENC)",
      "description": "使用NVIDIA GPU快速转换1080p视频",
      "gpuType": "NVIDIA",
      "outputFormat": "mp4",
      "videoCodec": "h264_nvenc",
      "resolution": "1920x1080",
      "quality": 23,
      "audioCodec": "aac",
      "audioBitrate": "192k",
      "category": "gpu",
      "recommended": true
    }
  ]
}
```

## 🔗 SignalR实时数据

### 1. Hub方法返回数据

#### GetRecentTasks(count)
```json
{
  "success": true,
  "data": [
    // 同REST API的最近任务数据结构
  ]
}
```

#### GetTaskStatus(taskId)
```json
{
  "taskId": "task-001",
  "status": "Running",
  "progress": 45,
  "speed": "2.5x",
  "remainingSeconds": 120,
  "message": "正在转换... 45%"
}
```

### 2. 服务器推送事件数据

#### ProgressUpdate
```json
{
  "taskId": "task-001",
  "progress": 45,
  "speed": "2.5x",
  "remainingSeconds": 120,
  "message": "正在转换... 45%",
  "currentStep": "视频编码"
}
```

#### TaskStarted
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "taskName": "转换 video.mp4",
  "message": "任务已开始"
}
```

#### TaskCompleted
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "downloadUrl": "/downloads/video_converted.mp4",
  "duration": 300,
  "message": "转换完成",
  "outputFileSize": 1073741824
}
```

#### TaskFailed
```json
{
  "taskId": "task-001",
  "fileName": "video.mp4",
  "error": "编码器初始化失败",
  "message": "转换失败",
  "errorCode": "ENCODER_INIT_FAILED"
}
```

## 🚨 错误处理数据

### 1. 错误报告 (`POST /api/errors/report`)

**请求数据**:
```json
{
  "type": "JavaScript Error",
  "message": "Cannot read property of undefined",
  "stack": "Error stack trace...",
  "url": "https://example.com/page",
  "userAgent": "Mozilla/5.0...",
  "timestamp": "2025-01-20T10:30:00.000Z",
  "sessionId": "session_123",
  "browserInfo": {
    "language": "zh-CN",
    "platform": "Win32",
    "screen": {"width": 1920, "height": 1080},
    "viewport": {"width": 1200, "height": 800}
  }
}
```

**响应数据**:
```json
{
  "success": true,
  "data": {
    "reportId": "error-report-123",
    "message": "错误报告已收到",
    "timestamp": "2025-01-20T10:30:00.000Z"
  }
}
```

### 2. 用户反馈 (`POST /api/errors/feedback`)

**请求数据**:
```json
{
  "errorId": "error-report-123",
  "userFeedback": "用户反馈内容",
  "timestamp": "2025-01-20T10:30:00.000Z"
}
```

## 🏥 系统健康数据

### 1. 系统状态 (`GET /api/health/status`)

**响应数据**:
```json
{
  "success": true,
  "data": {
    "status": "Healthy",
    "timestamp": "2025-01-20T10:30:00.000Z",
    "services": {
      "database": "Healthy",
      "signalr": "Healthy",
      "gpu": "Healthy",
      "storage": "Healthy"
    },
    "metrics": {
      "activeTasks": 3,
      "queuedTasks": 1,
      "completedToday": 25,
      "failedToday": 2
    }
  }
}
```

## 📊 数据验证要求

### 1. 必需字段验证
- 所有API响应必须包含`success`字段
- 成功响应必须包含`data`字段
- 失败响应必须包含`message`字段

### 2. 数据类型验证
- 时间字段使用ISO 8601格式
- 文件大小使用字节为单位
- 进度值为0-100的整数
- 温度值为摄氏度整数

### 3. 状态值枚举
- 任务状态: `Pending`, `Running`, `Completed`, `Failed`, `Cancelled`
- GPU厂商: `NVIDIA`, `Intel`, `AMD`
- 性能等级: `High`, `Medium`, `Low`, `None`

## 🔧 实现优先级

### 高优先级 (必须实现)
1. **GPU检测API** - `/api/gpu/detect`, `/api/gpu/capabilities`
2. **文件上传API** - `/api/conversion/start`, `/api/upload/large-file`
3. **任务管理API** - `/api/conversion/recent`, `/api/conversion/status/{taskId}`
4. **SignalR Hub方法** - `GetRecentTasks`, `GetTaskStatus`

### 中优先级 (建议实现)
1. **GPU性能监控** - `/api/gpu/performance`
2. **SignalR实时事件** - `ProgressUpdate`, `TaskCompleted`
3. **错误报告API** - `/api/errors/report`

### 低优先级 (可选实现)
1. **系统健康检查** - `/api/health/status`
2. **用户反馈API** - `/api/errors/feedback`
3. **转换预设API** - `/api/conversion/presets`

## 📝 注意事项

1. **错误处理**: 所有API都应该有统一的错误响应格式
2. **性能考虑**: GPU性能数据需要定期更新（建议5秒间隔）
3. **文件大小**: 大文件上传需要支持进度跟踪和断点续传
4. **实时性**: SignalR事件应该及时推送，避免延迟
5. **安全性**: 文件上传需要验证文件类型和大小限制

这份清单涵盖了前端应用正常运行所需的所有后端数据支持！
