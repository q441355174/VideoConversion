@*
@page
@model IndexModel
@{
    ViewData["Title"] = "ËßÜÈ¢ëËΩ¨Êç¢Â∑•ÂÖ∑";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="text-center mb-4">
                <h1 class="display-4">
                    <i class="fas fa-video text-primary"></i>
                    ËßÜÈ¢ëËΩ¨Êç¢Â∑•ÂÖ∑
                </h1>
                <p class="lead">Âü∫‰∫éHandBrakeÁöÑÂº∫Â§ßËßÜÈ¢ëËΩ¨Êç¢ÂäüËÉΩÔºåÊîØÊåÅÂ§öÁßçÊ†ºÂºèÂíåÈ¢ÑËÆæÈÄâÈ°π</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Â∑¶‰æßÔºöÊñá‰ª∂‰∏ä‰º†ÂíåËÆæÁΩÆ -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-upload"></i>
                        Êñá‰ª∂‰∏ä‰º†ÂíåËÆæÁΩÆ
                    </h5>
                </div>
                <div class="card-body">
                    <form id="conversionForm" enctype="multipart/form-data">
                        <!-- Êñá‰ª∂ÈÄâÊã© -->
                        <div class="mb-3">
                            <label for="videoFile" class="form-label">ÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂</label>
                            <div class="file-drop-zone" id="fileDropZone">
                                <div class="text-center">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                    <p class="mb-2">ÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§ÑÊàñÁÇπÂáªÈÄâÊã©</p>
                                    <input type="file" class="form-control" id="videoFile" name="videoFile"
                                           accept="@string.Join(",", Model.SupportedExtensions.Select(ext => ext))" required>
                                </div>
                            </div>
                            <div class="form-text mt-2">
                                <i class="fas fa-info-circle"></i>
                                ÊîØÊåÅÊ†ºÂºè: @string.Join(", ", Model.SupportedExtensions)
                                <br><i class="fas fa-weight-hanging"></i>
                                ÊúÄÂ§ßÊñá‰ª∂Â§ßÂ∞è: @Model.MaxFileSizeFormatted
                            </div>
                            <div id="selectedFileInfo" class="mt-2" style="display: none;">
                                <div class="alert alert-info">
                                    <i class="fas fa-file-video"></i>
                                    Â∑≤ÈÄâÊã©: <span id="selectedFileName"></span>
                                    (<span id="selectedFileSize"></span>)
                                </div>
                            </div>

                            <!-- ‰∏ä‰º†ËøõÂ∫¶Êù° -->
                            <div id="uploadProgressContainer" class="mt-3" style="display: none;">
                                <div class="card border-primary">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0">
                                            <i class="fas fa-upload text-primary"></i>
                                            Êñá‰ª∂‰∏ä‰º†ËøõÂ∫¶
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-2">
                                            <div class="d-flex justify-content-between">
                                                <span id="uploadFileName">Ê≠£Âú®‰∏ä‰º†...</span>
                                                <span id="uploadPercentage">0%</span>
                                            </div>
                                        </div>
                                        <div class="progress mb-2" style="height: 20px;">
                                            <div id="uploadProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                                                 role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                            </div>
                                        </div>
                                        <div class="row text-muted small">
                                            <div class="col-6">
                                                <i class="fas fa-tachometer-alt"></i>
                                                ÈÄüÂ∫¶: <span id="uploadSpeed">0 MB/s</span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <i class="fas fa-clock"></i>
                                                Ââ©‰Ωô: <span id="uploadTimeRemaining">ËÆ°ÁÆó‰∏≠...</span>
                                            </div>
                                        </div>
                                        <div class="row text-muted small mt-1">
                                            <div class="col-12">
                                                <i class="fas fa-info-circle"></i>
                                                <span id="uploadedSize">0 MB</span> / <span id="totalSize">0 MB</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰ªªÂä°ÂêçÁß∞ -->
                        <div class="mb-3">
                            <label for="taskName" class="form-label">‰ªªÂä°ÂêçÁß∞</label>
                            <input type="text" class="form-control" id="taskName" name="taskName"
                                   placeholder="ÂèØÈÄâÔºåÁïôÁ©∫Â∞Ü‰ΩøÁî®Êñá‰ª∂Âêç">
                        </div>

                        <!-- ËΩ¨Êç¢È¢ÑËÆæ -->
                        <div class="mb-3">
                            <label for="preset" class="form-label">ËΩ¨Êç¢È¢ÑËÆæ</label>
                            <select class="form-select" id="preset" name="preset">
                                @foreach (var preset in Model.ConversionPresets)
                                {
                                    <option value="@preset.Name" selected="@preset.IsDefault">
                                        @preset.Name - @preset.Description
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- ËØ¶ÁªÜËΩ¨Á†ÅËÆæÁΩÆ -->
                        <div class="accordion mb-3" id="advancedSettings">
                            <!-- Âü∫Êú¨ËÆæÁΩÆ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#basicPanel">
                                        <i class="fas fa-cogs"></i>&nbsp;Âü∫Êú¨ËÆæÁΩÆ
                                    </button>
                                </h2>
                                <div id="basicPanel" class="accordion-collapse collapse show">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="outputFormat" class="form-label">ËæìÂá∫Ê†ºÂºè</label>
                                                <select class="form-select" id="outputFormat" name="outputFormat">
                                                    <option value="mp4">MP4 (H.264)</option>
                                                    <option value="mp4_h265">MP4 (H.265/HEVC)</option>
                                                    <option value="webm">WebM (VP9)</option>
                                                    <option value="avi">AVI</option>
                                                    <option value="mkv">MKV</option>
                                                    <option value="mov">MOV</option>
                                                    <option value="mp3">MP3 (‰ªÖÈü≥È¢ë)</option>
                                                    <option value="aac">AAC (‰ªÖÈü≥È¢ë)</option>
                                                    <option value="flac">FLAC (‰ªÖÈü≥È¢ë)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="resolution" class="form-label">ÂàÜËæ®Áéá</label>
                                                <select class="form-select" id="resolution" name="resolution">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="3840x2160">4K (3840x2160)</option>
                                                    <option value="2560x1440">2K (2560x1440)</option>
                                                    <option value="1920x1080">1080p (1920x1080)</option>
                                                    <option value="1280x720">720p (1280x720)</option>
                                                    <option value="854x480">480p (854x480)</option>
                                                    <option value="640x360">360p (640x360)</option>
                                                    <option value="custom">Ëá™ÂÆö‰πâ</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mt-2" id="customResolution" style="display: none;">
                                            <div class="col-md-3">
                                                <label for="customWidth" class="form-label">ÂÆΩÂ∫¶</label>
                                                <input type="number" class="form-control" id="customWidth" placeholder="1920">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="customHeight" class="form-label">È´òÂ∫¶</label>
                                                <input type="number" class="form-control" id="customHeight" placeholder="1080">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="aspectRatio" class="form-label">ÂÆΩÈ´òÊØî</label>
                                                <select class="form-select" id="aspectRatio">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="16:9">16:9</option>
                                                    <option value="4:3">4:3</option>
                                                    <option value="1:1">1:1 (Ê≠£ÊñπÂΩ¢)</option>
                                                    <option value="21:9">21:9 (Ë∂ÖÂÆΩÂ±è)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ËßÜÈ¢ëËÆæÁΩÆ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#videoPanel">
                                        <i class="fas fa-video"></i>&nbsp;ËßÜÈ¢ëËÆæÁΩÆ
                                    </button>
                                </h2>
                                <div id="videoPanel" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="videoCodec" class="form-label">ËßÜÈ¢ëÁºñËß£Á†ÅÂô®</label>
                                                <select class="form-select" id="videoCodec" name="videoCodec">
                                                    <option value="libx264">H.264 (x264)</option>
                                                    <option value="libx265">H.265 (x265)</option>
                                                    <option value="libvpx-vp9">VP9</option>
                                                    <option value="libvpx">VP8</option>
                                                    <option value="libaom-av1">AV1</option>
                                                    <option value="mpeg4">MPEG-4</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="frameRate" class="form-label">Â∏ßÁéá (FPS)</label>
                                                <select class="form-select" id="frameRate" name="frameRate">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="23.976">23.976 (ÁîµÂΩ±)</option>
                                                    <option value="24">24</option>
                                                    <option value="25">25 (PAL)</option>
                                                    <option value="29.97">29.97 (NTSC)</option>
                                                    <option value="30">30</option>
                                                    <option value="50">50</option>
                                                    <option value="60">60</option>
                                                    <option value="120">120</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Ë¥®ÈáèÊéßÂà∂Ê®°Âºè</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="qualityMode" id="crfMode" value="crf" checked>
                                                    <label class="btn btn-outline-primary" for="crfMode">CRF (Ë¥®Èáè)</label>

                                                    <input type="radio" class="btn-check" name="qualityMode" id="bitrateMode" value="bitrate">
                                                    <label class="btn btn-outline-primary" for="bitrateMode">ÊØîÁâπÁéá</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div id="crfSettings">
                                                    <label for="videoQuality" class="form-label">CRFÂÄº</label>
                                                    <input type="range" class="form-range" id="videoQuality"
                                                           min="0" max="51" value="23">
                                                    <div class="form-text">
                                                        <span id="qualityValue">23</span> (0=Êó†Êçü, 18=È´òË¥®Èáè, 23=ÈªòËÆ§, 28=‰ΩéË¥®Èáè)
                                                    </div>
                                                </div>
                                                <div id="bitrateSettings" style="display: none;">
                                                    <label for="videoBitrate" class="form-label">ËßÜÈ¢ëÊØîÁâπÁéá (kbps)</label>
                                                    <input type="number" class="form-control" id="videoBitrate"
                                                           placeholder="5000" min="100" max="50000">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label for="preset" class="form-label">ÁºñÁ†ÅÈ¢ÑËÆæ (ÈÄüÂ∫¶vsË¥®Èáè)</label>
                                                <select class="form-select" id="encodingPreset" name="encodingPreset">
                                                    <option value="ultrafast">ultrafast (ÊúÄÂø´)</option>
                                                    <option value="superfast">superfast</option>
                                                    <option value="veryfast">veryfast</option>
                                                    <option value="faster">faster</option>
                                                    <option value="fast">fast</option>
                                                    <option value="medium" selected>medium (Âπ≥Ë°°)</option>
                                                    <option value="slow">slow</option>
                                                    <option value="slower">slower</option>
                                                    <option value="veryslow">veryslow (ÊúÄÊÖ¢/ÊúÄÈ´òË¥®Èáè)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="profile" class="form-label">H.264ÈÖçÁΩÆÊñá‰ª∂</label>
                                                <select class="form-select" id="profile" name="profile">
                                                    <option value="">Ëá™Âä®</option>
                                                    <option value="baseline">Baseline</option>
                                                    <option value="main">Main</option>
                                                    <option value="high">High</option>
                                                    <option value="high10">High 10</option>
                                                    <option value="high422">High 4:2:2</option>
                                                    <option value="high444">High 4:4:4</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Èü≥È¢ëËÆæÁΩÆ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#audioPanel">
                                        <i class="fas fa-volume-up"></i>&nbsp;Èü≥È¢ëËÆæÁΩÆ
                                    </button>
                                </h2>
                                <div id="audioPanel" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="audioCodec" class="form-label">Èü≥È¢ëÁºñËß£Á†ÅÂô®</label>
                                                <select class="form-select" id="audioCodec" name="audioCodec">
                                                    <option value="aac">AAC</option>
                                                    <option value="libmp3lame">MP3</option>
                                                    <option value="libvorbis">Vorbis</option>
                                                    <option value="libopus">Opus</option>
                                                    <option value="flac">FLAC (Êó†Êçü)</option>
                                                    <option value="pcm_s16le">PCM (Êó†ÂéãÁº©)</option>
                                                    <option value="ac3">AC-3</option>
                                                    <option value="eac3">E-AC-3</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="audioChannels" class="form-label">Â£∞ÈÅìÊï∞</label>
                                                <select class="form-select" id="audioChannels" name="audioChannels">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="1">ÂçïÂ£∞ÈÅì (1.0)</option>
                                                    <option value="2">Á´ã‰ΩìÂ£∞ (2.0)</option>
                                                    <option value="6">5.1ÁéØÁªïÂ£∞</option>
                                                    <option value="8">7.1ÁéØÁªïÂ£∞</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Èü≥È¢ëË¥®ÈáèÊ®°Âºè</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="audioQualityMode" id="audioBitrateMode" value="bitrate" checked>
                                                    <label class="btn btn-outline-success" for="audioBitrateMode">ÊØîÁâπÁéá</label>

                                                    <input type="radio" class="btn-check" name="audioQualityMode" id="audioQualityMode" value="quality">
                                                    <label class="btn btn-outline-success" for="audioQualityMode">Ë¥®Èáè</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div id="audioBitrateSettings">
                                                    <label for="audioBitrate" class="form-label">Èü≥È¢ëÊØîÁâπÁéá</label>
                                                    <select class="form-select" id="audioBitrate" name="audioBitrate">
                                                        <option value="64k">64 kbps</option>
                                                        <option value="96k">96 kbps</option>
                                                        <option value="128k" selected>128 kbps</option>
                                                        <option value="160k">160 kbps</option>
                                                        <option value="192k">192 kbps</option>
                                                        <option value="256k">256 kbps</option>
                                                        <option value="320k">320 kbps</option>
                                                        <option value="custom">Ëá™ÂÆö‰πâ</option>
                                                    </select>
                                                </div>
                                                <div id="audioQualitySettings" style="display: none;">
                                                    <label for="audioQualityValue" class="form-label">Èü≥È¢ëË¥®Èáè</label>
                                                    <input type="range" class="form-range" id="audioQualityValue"
                                                           min="0" max="9" value="2">
                                                    <div class="form-text">
                                                        <span id="audioQualityDisplay">2</span> (0=ÊúÄÈ´òË¥®Èáè, 9=ÊúÄ‰ΩéË¥®Èáè)
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt-3" id="customAudioBitrate" style="display: none;">
                                            <div class="col-md-6">
                                                <label for="customAudioBitrateValue" class="form-label">Ëá™ÂÆö‰πâÊØîÁâπÁéá (kbps)</label>
                                                <input type="number" class="form-control" id="customAudioBitrateValue"
                                                       placeholder="128" min="8" max="1411">
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label for="sampleRate" class="form-label">ÈááÊ†∑Áéá</label>
                                                <select class="form-select" id="sampleRate" name="sampleRate">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="8000">8 kHz</option>
                                                    <option value="11025">11.025 kHz</option>
                                                    <option value="16000">16 kHz</option>
                                                    <option value="22050">22.05 kHz</option>
                                                    <option value="32000">32 kHz</option>
                                                    <option value="44100">44.1 kHz (CDË¥®Èáè)</option>
                                                    <option value="48000">48 kHz (DVDË¥®Èáè)</option>
                                                    <option value="96000">96 kHz (È´òÊ∏Ö)</option>
                                                    <option value="192000">192 kHz (Ë∂ÖÈ´òÊ∏Ö)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="audioVolume" class="form-label">Èü≥ÈáèË∞ÉÊï¥</label>
                                                <input type="range" class="form-range" id="audioVolume"
                                                       min="0" max="200" value="100">
                                                <div class="form-text">
                                                    <span id="volumeValue">100</span>% (100%=ÂéüÂßãÈü≥Èáè)
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- È´òÁ∫ßÈÄâÈ°π -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#advancedPanel">
                                        <i class="fas fa-tools"></i>&nbsp;È´òÁ∫ßÈÄâÈ°π
                                    </button>
                                </h2>
                                <div id="advancedPanel" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="startTime" class="form-label">ÂºÄÂßãÊó∂Èó¥ (HH:MM:SS)</label>
                                                <input type="text" class="form-control" id="startTime" name="startTime"
                                                       placeholder="00:00:00" pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}">
                                                <div class="form-text">ÁïôÁ©∫Ë°®Á§∫‰ªéÂ§¥ÂºÄÂßã</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="duration" class="form-label">ÊåÅÁª≠Êó∂Èó¥ (HH:MM:SS)</label>
                                                <input type="text" class="form-control" id="duration" name="duration"
                                                       placeholder="00:00:00" pattern="[0-9]{2}:[0-9]{2}:[0-9]{2}">
                                                <div class="form-text">ÁïôÁ©∫Ë°®Á§∫Âà∞ÁªìÂ∞æ</div>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label for="deinterlace" class="form-label">ÂéªÈöîË°åÊâ´Êèè</label>
                                                <select class="form-select" id="deinterlace" name="deinterlace">
                                                    <option value="">‰∏çÂ§ÑÁêÜ</option>
                                                    <option value="yadif">YADIF (Êé®Ëçê)</option>
                                                    <option value="bwdif">BWDIF</option>
                                                    <option value="w3fdif">W3FDIF</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="denoise" class="form-label">ÈôçÂô™</label>
                                                <select class="form-select" id="denoise" name="denoise">
                                                    <option value="">‰∏çÂ§ÑÁêÜ</option>
                                                    <option value="nlmeans">NLMeans (È´òË¥®Èáè)</option>
                                                    <option value="hqdn3d">HQDN3D (Âø´ÈÄü)</option>
                                                    <option value="bm3d">BM3D (ÊúÄ‰Ω≥)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-md-6">
                                                <label for="colorSpace" class="form-label">Ëâ≤ÂΩ©Á©∫Èó¥</label>
                                                <select class="form-select" id="colorSpace" name="colorSpace">
                                                    <option value="">‰øùÊåÅÂéüÂßã</option>
                                                    <option value="bt709">BT.709 (HD)</option>
                                                    <option value="bt2020">BT.2020 (4K HDR)</option>
                                                    <option value="smpte170m">SMPTE-170M (NTSC)</option>
                                                    <option value="bt470bg">BT.470BG (PAL)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="pixelFormat" class="form-label">ÂÉèÁ¥†Ê†ºÂºè</label>
                                                <select class="form-select" id="pixelFormat" name="pixelFormat">
                                                    <option value="">Ëá™Âä®</option>
                                                    <option value="yuv420p">YUV420P (Ê†áÂáÜ)</option>
                                                    <option value="yuv422p">YUV422P</option>
                                                    <option value="yuv444p">YUV444P (È´òË¥®Èáè)</option>
                                                    <option value="yuv420p10le">YUV420P10LE (10-bit)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-12">
                                                <label for="customParams" class="form-label">Ëá™ÂÆö‰πâFFmpegÂèÇÊï∞</label>
                                                <textarea class="form-control" id="customParams" name="customParams"
                                                          rows="2" placeholder="‰æãÂ¶Ç: -tune film -x264opts keyint=250"></textarea>
                                                <div class="form-text">
                                                    <i class="fas fa-exclamation-triangle text-warning"></i>
                                                    È´òÁ∫ßÁî®Êà∑ÈÄâÈ°πÔºåÈîôËØØÁöÑÂèÇÊï∞ÂèØËÉΩÂØºËá¥ËΩ¨Êç¢Â§±Ë¥•
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <div class="col-12">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="twoPass" name="twoPass">
                                                    <label class="form-check-label" for="twoPass">
                                                        ÂêØÁî®‰∏§ÈÅçÁºñÁ†Å (Êõ¥Â•ΩÁöÑË¥®ÈáèÔºå‰ΩÜÈÄüÂ∫¶ËæÉÊÖ¢)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="fastStart" name="fastStart" checked>
                                                    <label class="form-check-label" for="fastStart">
                                                        Âø´ÈÄüÂêØÂä® (‰ºòÂåñÁΩëÁªúÊí≠Êîæ)
                                                    </label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="copyTimestamps" name="copyTimestamps" checked>
                                                    <label class="form-check-label" for="copyTimestamps">
                                                        ‰øùÊåÅÊó∂Èó¥Êà≥
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Êèê‰∫§ÊåâÈíÆ -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="startConversion">
                                <i class="fas fa-play"></i>
                                ÂºÄÂßãËΩ¨Êç¢
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Âè≥‰æßÔºöËΩ¨Êç¢ËøõÂ∫¶ÂíåÁä∂ÊÄÅ -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-tasks"></i>
                        ËΩ¨Êç¢ËøõÂ∫¶
                    </h5>
                    <div>
                        <small>ËøûÊé•Áä∂ÊÄÅ: </small>
                        <span id="connectionStatus" class="badge bg-warning connection-status">Disconnected</span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- ÂΩìÂâç‰ªªÂä°ËøõÂ∫¶ -->
                    <div id="currentTask" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">ÂΩìÂâç‰ªªÂä°: <span id="currentTaskName"></span></h6>
                            <small class="text-muted" id="taskId"></small>
                        </div>

                        <!-- Êñá‰ª∂‰ø°ÊÅØ -->
                        <div class="row mb-3" id="fileInfo" style="display: none;">
                            <div class="col-md-6 mb-2">
                                <small class="text-muted"><i class="fas fa-file-video"></i> ÂéüÂßãÊñá‰ª∂</small><br>
                                <span id="originalFileName" class="small fw-bold"></span>
                            </div>
                            <div class="col-md-6 mb-2">
                                <small class="text-muted"><i class="fas fa-cog"></i> ËæìÂá∫Ê†ºÂºè</small><br>
                                <span id="outputFormat" class="small fw-bold"></span>
                            </div>
                        </div>

                        <!-- ËΩ¨Êç¢ÂèÇÊï∞ËØ¶ÊÉÖ -->
                        <div class="accordion mb-3" id="taskDetailsAccordion" style="display: none;">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#taskDetailsPanel">
                                        <i class="fas fa-info-circle"></i>&nbsp;ËΩ¨Êç¢ÂèÇÊï∞ËØ¶ÊÉÖ
                                    </button>
                                </h2>
                                <div id="taskDetailsPanel" class="accordion-collapse collapse">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-video"></i> ËßÜÈ¢ëËÆæÁΩÆ</h6>
                                                <ul class="list-unstyled small">
                                                    <li><strong>ÁºñËß£Á†ÅÂô®:</strong> <span id="videoCodecDetail">-</span> <span id="gpuAccelBadge" class="badge bg-success ms-1" style="display: none;">üöÄ GPUÂä†ÈÄü</span></li>
                                                    <li><strong>ÂàÜËæ®Áéá:</strong> <span id="resolutionDetail">-</span></li>
                                                    <li><strong>Ë¥®Èáè:</strong> <span id="qualityDetail">-</span></li>
                                                    <li><strong>Â∏ßÁéá:</strong> <span id="frameRateDetail">-</span></li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h6><i class="fas fa-volume-up"></i> Èü≥È¢ëËÆæÁΩÆ</h6>
                                                <ul class="list-unstyled small">
                                                    <li><strong>ÁºñËß£Á†ÅÂô®:</strong> <span id="audioCodecDetail">-</span></li>
                                                    <li><strong>ÊØîÁâπÁéá:</strong> <span id="audioBitrateDetail">-</span></li>
                                                    <li><strong>Â£∞ÈÅì:</strong> <span id="audioChannelsDetail">-</span></li>
                                                    <li><strong>ÈááÊ†∑Áéá:</strong> <span id="sampleRateDetail">-</span></li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-12">
                                                <h6><i class="fas fa-tools"></i> È´òÁ∫ßÈÄâÈ°π</h6>
                                                <ul class="list-unstyled small">
                                                    <li><strong>ÁºñÁ†ÅÈ¢ÑËÆæ:</strong> <span id="encodingPresetDetail">-</span></li>
                                                    <li><strong>‰∏§ÈÅçÁºñÁ†Å:</strong> <span id="twoPassDetail">-</span></li>
                                                    <li><strong>Âø´ÈÄüÂêØÂä®:</strong> <span id="fastStartDetail">-</span></li>
                                                    <li id="customParamsDetail" style="display: none;"><strong>Ëá™ÂÆö‰πâÂèÇÊï∞:</strong> <code class="small"></code></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ËøõÂ∫¶Êù° -->
                        <div class="progress mb-3" style="height: 30px;">
                            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                                 role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                <span class="fw-bold">0%</span>
                            </div>
                        </div>

                        <!-- ËØ¶ÁªÜÁä∂ÊÄÅ‰ø°ÊÅØ -->
                        <div class="row text-center mb-3">
                            <div class="col-3">
                                <small class="text-muted">ËΩ¨Êç¢ÈÄüÂ∫¶</small><br>
                                <span id="conversionSpeed" class="fw-bold">-</span>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">Ââ©‰ΩôÊó∂Èó¥</small><br>
                                <span id="remainingTime" class="fw-bold">-</span>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">Â∑≤Áî®Êó∂Èó¥</small><br>
                                <span id="elapsedTime" class="fw-bold">-</span>
                            </div>
                            <div class="col-3">
                                <small class="text-muted">Êñá‰ª∂Â§ßÂ∞è</small><br>
                                <span id="fileSize" class="fw-bold">-</span>
                            </div>
                        </div>

                        <!-- ÂΩìÂâçÁä∂ÊÄÅ -->
                        <div class="alert alert-info mb-3" role="alert">
                            <i class="fas fa-info-circle"></i>
                            <span id="taskStatus">Á≠âÂæÖ‰∏≠...</span>
                        </div>

                        <!-- ÈîôËØØËØ¶ÊÉÖ -->
                        <div class="alert alert-danger mb-3" id="errorDetails" style="display: none;" role="alert">
                            <h6><i class="fas fa-exclamation-triangle"></i> ÈîôËØØËØ¶ÊÉÖ</h6>
                            <div id="errorMessage" class="small"></div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-danger" onclick="copyErrorToClipboard()">
                                    <i class="fas fa-copy"></i> Â§çÂà∂ÈîôËØØ‰ø°ÊÅØ
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="showTroubleshooting()">
                                    <i class="fas fa-question-circle"></i> ÊïÖÈöúÊéíÈô§
                                </button>
                            </div>
                        </div>

                        <!-- ÊïÖÈöúÊéíÈô§ÊèêÁ§∫ -->
                        <div class="alert alert-warning mb-3" id="troubleshootingTips" style="display: none;" role="alert">
                            <h6><i class="fas fa-tools"></i> ÊïÖÈöúÊéíÈô§Âª∫ËÆÆ</h6>
                            <ul class="mb-0 small" id="troubleshootingList">
                                <!-- Âä®ÊÄÅÁîüÊàêÊïÖÈöúÊéíÈô§Âª∫ËÆÆ -->
                            </ul>
                        </div>

                        <!-- Êìç‰ΩúÊåâÈíÆ -->
                        <div class="d-flex gap-2" id="taskActionButtons">
                            <button type="button" class="btn btn-outline-danger btn-sm" id="cancelTask">
                                <i class="fas fa-stop"></i> ÂèñÊ∂àËΩ¨Êç¢
                            </button>
                            <button type="button" class="btn btn-outline-info btn-sm" id="refreshTask" style="display: none;">
                                <i class="fas fa-sync"></i> Âà∑Êñ∞Áä∂ÊÄÅ
                            </button>
                            <a class="btn btn-outline-success btn-sm" id="downloadTask" style="display: none;">
                                <i class="fas fa-download"></i> ‰∏ãËΩΩÊñá‰ª∂
                            </a>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="restartTask" style="display: none;">
                                <i class="fas fa-redo"></i> ÈáçÊñ∞ÂºÄÂßã
                            </button>
                        </div>
                    </div>

                    <!-- Êó†‰ªªÂä°Êó∂ÁöÑÊèêÁ§∫ -->
                    <div id="noTask" class="text-center text-muted">
                        <i class="fas fa-video fa-3x mb-3 text-secondary"></i>
                        <h6>ÊöÇÊó†ËΩ¨Êç¢‰ªªÂä°</h6>
                        <p class="mb-0">ËØ∑ÈÄâÊã©ËßÜÈ¢ëÊñá‰ª∂Âπ∂ÂºÄÂßãËΩ¨Êç¢</p>
                    </div>
                </div>
            </div>

            <!-- ÊúÄËøë‰ªªÂä° -->
            <div class="card shadow-sm mt-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-history"></i>
                        ÊúÄËøë‰ªªÂä°
                    </h6>
                </div>
                <div class="card-body">
                    <div id="recentTasks">
                        <div class="text-center text-muted">
                            <small>ÊöÇÊó†‰ªªÂä°ËÆ∞ÂΩï</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GPUÁ°¨‰ª∂Âä†ÈÄü‰ø°ÊÅØ -->
            <div class="card shadow-sm mt-3">
                <div class="card-header bg-gradient text-white d-flex justify-content-between align-items-center" style="background: linear-gradient(45deg, #6f42c1, #e83e8c);">
                    <h6 class="mb-0">
                        <i class="fas fa-microchip"></i>
                        GPUÁ°¨‰ª∂Âä†ÈÄü
                    </h6>
                    <button id="refreshGpuInfo" class="btn btn-sm btn-outline-light" title="Âà∑Êñ∞GPU‰ø°ÊÅØ">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="card-body">
                    <div id="gpuInfo">
                        <div class="text-center text-muted">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="visually-hidden">Ê£ÄÊµã‰∏≠...</span>
                            </div>
                            <small class="ms-2">Ê≠£Âú®Ê£ÄÊµãGPUÁ°¨‰ª∂Âä†ÈÄüËÉΩÂäõ...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        /* ËøõÂ∫¶Êù°Âä®ÁîªÊïàÊûú */
        .progress-bar-animated {
            animation: progress-bar-stripes 1s linear infinite;
        }

        /* ËøûÊé•Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .connection-status {
            position: relative;
            display: inline-block;
        }

        .connection-status::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: currentColor;
            animation: pulse 2s infinite;
        }

        @@keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* ‰ªªÂä°Âç°ÁâáÊÇ¨ÂÅúÊïàÊûú */
        .task-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        /* ËøõÂ∫¶Êù°Ê∏êÂèòÊïàÊûú */
        .progress-bar.bg-primary {
            background: linear-gradient(45deg, #007bff, #0056b3) !important;
        }

        .progress-bar.bg-success {
            background: linear-gradient(45deg, #28a745, #1e7e34) !important;
        }

        .progress-bar.bg-info {
            background: linear-gradient(45deg, #17a2b8, #138496) !important;
        }

        .progress-bar.bg-danger {
            background: linear-gradient(45deg, #dc3545, #bd2130) !important;
        }

        /* ‰∏ä‰º†ËøõÂ∫¶Êù°ÁâπÊÆäÊ†∑Âºè */
        #uploadProgressBar {
            transition: width 0.3s ease-out !important;
            background: linear-gradient(45deg, #007bff, #0056b3) !important;
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        #uploadProgressBar.bg-success {
            background: linear-gradient(45deg, #28a745, #1e7e34) !important;
            box-shadow: 0 2px 4px rgba(40,167,69,0.3);
        }

        #uploadProgressBar.bg-info {
            background: linear-gradient(45deg, #17a2b8, #138496) !important;
            box-shadow: 0 2px 4px rgba(23,162,184,0.3);
        }

        /* ‰∏ä‰º†ËøõÂ∫¶ÂÆπÂô®Âä®Áîª */
        #uploadProgressContainer {
            animation: slideDown 0.3s ease-out;
        }

        @@keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* È´òÈÄü‰∏ä‰º†Êó∂ÁöÑÁâπÊÆäÊïàÊûú */
        .high-speed-upload .progress-bar {
            animation: pulse 1s ease-in-out infinite alternate;
        }

        @@keyframes pulse {
            from {
                box-shadow: 0 2px 4px rgba(0,123,255,0.3);
            }
            to {
                box-shadow: 0 2px 8px rgba(0,123,255,0.6);
            }
        }

        /* Áä∂ÊÄÅÂæΩÁ´†Âä®Áîª */
        .badge.bg-primary {
            animation: pulse-blue 2s infinite;
        }

        @@keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }

        /* Êñá‰ª∂ÊãñÊãΩÂå∫Âüü */
        .file-drop-zone {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }

        .file-drop-zone.dragover {
            border-color: #007bff;
            background-color: #e3f2fd;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Áä∂ÊÄÅÂõæÊ†á */
        .status-icon {
            font-size: 1.2em;
            margin-right: 5px;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @@media (max-width: 768px) {
            .task-card {
                margin-bottom: 10px;
            }

            .progress {
                height: 25px !important;
            }

            .btn-sm {
                font-size: 0.8rem;
                padding: 0.25rem 0.5rem;
            }
        }

        /* È¢ÑËÆæÊõ¥Êñ∞ÊèêÁ§∫Ê†∑Âºè */
        .preset-updated {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
            transition: all 0.3s ease;
        }

        .preset-updated:focus {
            border-color: #28a745 !important;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25) !important;
        }

        /* GPUÂä†ÈÄüÊ†áËØÜÂä®Áîª */
        .gpu-accel-badge {
            animation: pulse 2s infinite;
        }

        @@keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Êô∫ËÉΩÈ¢ÑËÆæÈÄâÊã©ÊèêÁ§∫ */
        .smart-preset-notification {
            border-left: 4px solid #28a745;
            background: linear-gradient(90deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
        }
    </style>
}

@section Scripts {
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
    <script>
        // Á≠âÂæÖDOMÂä†ËΩΩÂÆåÊàê
        document.addEventListener('DOMContentLoaded', function() {
            // SignalRËøûÊé•ÈÖçÁΩÆ
            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/conversionHub")
                .withAutomaticReconnect([0, 2000, 10000, 30000]) // Ëá™Âä®ÈáçËøû
                .configureLogging(signalR.LogLevel.Information)
                .build();

        let currentTaskId = null;
        let connectionState = 'Disconnected';
        let refreshInterval = null;
        let lastRefreshTime = 0;

        // ÊòæÁ§∫Ë≠¶ÂëäÊ∂àÊÅØ
        function showAlert(type, message) {
            // ÂàõÂª∫Ë≠¶ÂëäÂÖÉÁ¥†
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            // ÊèíÂÖ•Âà∞È°µÈù¢È°∂ÈÉ®
            const container = document.querySelector('.container-fluid');
            container.insertBefore(alertDiv, container.firstChild);

            // 5ÁßíÂêéËá™Âä®Ê∂àÂ§±
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Êõ¥Êñ∞ËøûÊé•Áä∂ÊÄÅÊòæÁ§∫
        function updateConnectionStatus(status) {
            connectionState = status;
            const statusElement = document.getElementById('connectionStatus');
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.className = `badge ${status === 'Connected' ? 'bg-success' : 'bg-warning'}`;
            }
        }

        // ÂêØÂä®SignalRËøûÊé•
        async function startConnection() {
            try {
                await connection.start();
                console.log("‚úÖ SignalRËøûÊé•ÊàêÂäü");
                updateConnectionStatus('Connected');
                showAlert('success', 'SignalRËøûÊé•Â∑≤Âª∫Á´ãÔºåÂèØ‰ª•ÂÆûÊó∂Êé•Êî∂ËΩ¨Êç¢ËøõÂ∫¶');

                // ËøûÊé•ÊàêÂäüÂêéÂä†ËΩΩÊúÄËøë‰ªªÂä°
                loadRecentTasks();
            } catch (err) {
                console.error("‚ùå SignalRËøûÊé•Â§±Ë¥•:", err);
                updateConnectionStatus('Failed');
                showAlert('danger', 'SignalRËøûÊé•Â§±Ë¥•ÔºåËøõÂ∫¶Êõ¥Êñ∞ÂèØËÉΩ‰∏çÂèØÁî®');

                // 5ÁßíÂêéÈáçËØïËøûÊé•
                setTimeout(startConnection, 5000);
            }
        }

        // ËøûÊé•Áä∂ÊÄÅ‰∫ã‰ª∂Â§ÑÁêÜ
        connection.onreconnecting((error) => {
            console.log("üîÑ SignalRÈáçËøû‰∏≠...", error);
            updateConnectionStatus('Reconnecting');
            showAlert('warning', 'SignalRËøûÊé•‰∏≠Êñ≠ÔºåÊ≠£Âú®ÈáçËøû...');
        });

        connection.onreconnected((connectionId) => {
            console.log("‚úÖ SignalRÈáçËøûÊàêÂäü:", connectionId);
            updateConnectionStatus('Connected');
            showAlert('success', 'SignalRËøûÊé•Â∑≤ÊÅ¢Â§ç');

            // ÈáçËøûÂêéÈáçÊñ∞Âä†ÂÖ•‰ªªÂä°ÁªÑ
            if (currentTaskId) {
                connection.invoke("JoinTaskGroup", currentTaskId).catch(err => {
                    console.error("ÈáçÊñ∞Âä†ÂÖ•‰ªªÂä°ÁªÑÂ§±Ë¥•:", err);
                });
            }
        });

        connection.onclose((error) => {
            console.log("‚ùå SignalRËøûÊé•ÂÖ≥Èó≠:", error);
            updateConnectionStatus('Disconnected');
            showAlert('danger', 'SignalRËøûÊé•Â∑≤Êñ≠ÂºÄ');
        });

        // ÂêØÂä®ËøûÊé•
        startConnection();

        // ÁõëÂê¨ËøõÂ∫¶Êõ¥Êñ∞
        connection.on("ProgressUpdate", function (data) {
            updateProgress(data);
        });

        // ÁõëÂê¨‰∏ä‰º†ËøõÂ∫¶Êõ¥Êñ∞
        connection.on("UploadProgress", function (data) {
            updateUploadProgress(data);
        });

        // ÁõëÂê¨‰∏ä‰º†ÂºÄÂßã
        connection.on("UploadStarted", function (data) {
            console.log("üì§ ‰∏ä‰º†ÂºÄÂßã:", data);
            const uploadContainer = document.getElementById('uploadProgressContainer');
            uploadContainer.style.display = 'block';
            document.getElementById('uploadFileName').textContent = data.FileName;
            document.getElementById('totalSize').textContent = formatFileSize(data.TotalSize);
        });

        // ÁõëÂê¨‰∏ä‰º†ÂÆåÊàê
        connection.on("UploadCompleted", function (data) {
            console.log("‚úÖ ‰∏ä‰º†ÂÆåÊàê:", data);
            showAlert('success', `Êñá‰ª∂‰∏ä‰º†ÂÆåÊàê: ${data.FilePath}`);
        });

        // ÁõëÂê¨‰∏ä‰º†Â§±Ë¥•
        connection.on("UploadFailed", function (data) {
            console.log("‚ùå ‰∏ä‰º†Â§±Ë¥•:", data);
            showAlert('danger', `‰∏ä‰º†Â§±Ë¥•: ${data.ErrorMessage}`);
            hideUploadProgress();
        });

        // ÁõëÂê¨Áä∂ÊÄÅÊõ¥Êñ∞
        connection.on("StatusUpdate", function (data) {
            updateTaskStatus(data);
        });

        // ÁõëÂê¨‰ªªÂä°ÂÆåÊàê
        connection.on("TaskCompleted", function (data) {
            handleTaskCompleted(data);
        });

        // ÁõëÂê¨‰ªªÂä°Áä∂ÊÄÅÂìçÂ∫î
        connection.on("TaskStatus", function (data) {
            console.log("üìä Êî∂Âà∞‰ªªÂä°Áä∂ÊÄÅ:", data);
            if (data.taskId === currentTaskId) {
                updateProgress({
                    taskId: data.taskId,
                    progress: data.progress,
                    message: data.status,
                    speed: data.conversionSpeed,
                    remainingSeconds: data.estimatedTimeRemaining
                });
            }
        });

        // ÁõëÂê¨‰ªªÂä°Êú™ÊâæÂà∞
        connection.on("TaskNotFound", function (taskId) {
            console.warn("‚ö†Ô∏è ‰ªªÂä°Êú™ÊâæÂà∞:", taskId);
            showAlert('warning', `‰ªªÂä° ${taskId} Êú™ÊâæÂà∞`);
        });

        // ÁõëÂê¨Á≥ªÁªüÈÄöÁü•
        connection.on("SystemNotification", function (data) {
            console.log("üì¢ Á≥ªÁªüÈÄöÁü•:", data);
            showAlert(data.type || 'info', data.message);
        });

        // ÁõëÂê¨ÈîôËØØ
        connection.on("Error", function (message) {
            console.error("‚ùå SignalRÈîôËØØ:", message);
            showAlert('danger', 'SignalRÈîôËØØ: ' + message);
        });

        // ÁõëÂê¨‰ªªÂä°ÂèñÊ∂àÂÆåÊàê
        connection.on("TaskCancelCompleted", function (data) {
            console.log("üö´ ‰ªªÂä°ÂèñÊ∂àÂÆåÊàê:", data);
            if (data.taskId === currentTaskId) {
                showAlert('success', '‰ªªÂä°ÂèñÊ∂àÊàêÂäü');

                // Êõ¥Êñ∞UIÁä∂ÊÄÅ
                const taskStatus = document.getElementById('taskStatus');
                if (taskStatus) {
                    taskStatus.textContent = '‰ªªÂä°Â∑≤ÂèñÊ∂à';
                    const statusAlert = taskStatus.closest('.alert');
                    if (statusAlert) {
                        statusAlert.className = 'alert alert-warning mb-3';
                    }
                }

                // Êõ¥Êñ∞ÊåâÈíÆ‰∏∫ÂèñÊ∂àÁä∂ÊÄÅ
                updateTaskActionButtons('cancelled');

                // Ê∏ÖÈô§ÂΩìÂâç‰ªªÂä°
                currentTaskId = null;
                currentTaskStartTime = null;

                // Âà∑Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®
                setTimeout(loadRecentTasks, 1000);
            }
        });

        // ÁõëÂê¨‰ªªÂä°Ë¢´ÂèñÊ∂àÔºàÊù•Ëá™ÂÖ∂‰ªñÂÆ¢Êà∑Á´ØÔºâ
        connection.on("TaskCancelled", function (data) {
            console.log("üö´ ‰ªªÂä°Ë¢´ÂèñÊ∂à:", data);
            updateRecentTaskStatus(data.taskId, 'Cancelled');

            // Â¶ÇÊûúÊòØÂΩìÂâç‰ªªÂä°Ë¢´ÂÖ∂‰ªñÂÆ¢Êà∑Á´ØÂèñÊ∂à
            if (data.taskId === currentTaskId) {
                showAlert('warning', 'ÂΩìÂâç‰ªªÂä°Â∑≤Ë¢´ÂÖ∂‰ªñÂÆ¢Êà∑Á´ØÂèñÊ∂à');
                currentTaskId = null;
                currentTaskStartTime = null;

                // ÈöêËóèÂΩìÂâç‰ªªÂä°ÊòæÁ§∫
                document.getElementById('currentTask').style.display = 'none';
                document.getElementById('noTask').style.display = 'block';
            }
        });

        // ÁõëÂê¨Êñ∞‰ªªÂä°ÂàõÂª∫ÔºàÊù•Ëá™ÂÖ∂‰ªñÂÆ¢Êà∑Á´ØÔºâ
        connection.on("TaskCreated", function (data) {
            console.log("üìù Êñ∞‰ªªÂä°ÂàõÂª∫:", data);
            // Âª∂ËøüÂà∑Êñ∞‰ª•Á°Æ‰øùÊï∞ÊçÆÂ∫ìÂ∑≤Êõ¥Êñ∞
            setTimeout(loadRecentTasks, 1000);
        });

        // ÁõëÂê¨‰ªªÂä°Áä∂ÊÄÅÂèòÂåñÔºàÂÖ®Â±ÄÔºâ
        connection.on("TaskStatusChanged", function (data) {
            console.log("üìä ‰ªªÂä°Áä∂ÊÄÅÂèòÂåñ:", data);
            updateRecentTaskStatus(data.taskId, data.status);

            // Â¶ÇÊûúÊúâËøõÂ∫¶‰ø°ÊÅØÔºå‰πüÊõ¥Êñ∞ËøõÂ∫¶
            if (data.progress !== undefined) {
                updateRecentTaskProgress(data.taskId, data.progress, data.message);
            }
        });

        // Ë°®ÂçïÊèê‰∫§Â§ÑÁêÜ - ÊîØÊåÅÂ§ßÊñá‰ª∂‰∏ä‰º†ÂíåËøõÂ∫¶Ë∑üË∏™
        document.getElementById('conversionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];

            if (!file) {
                showAlert('danger', 'ËØ∑ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂');
                return;
            }

            // Ê£ÄÊü•Êñá‰ª∂Â§ßÂ∞èÔºåÂ¶ÇÊûúË∂ÖËøá100MB‰ΩøÁî®Â§ßÊñá‰ª∂‰∏ä‰º†API
            const isLargeFile = file.size > 100 * 1024 * 1024; // 100MB

            if (isLargeFile) {
                await handleLargeFileUpload(file, this);
            } else {
                await handleNormalFileUpload(this);
            }
        });

        // Â§ÑÁêÜÂ§ßÊñá‰ª∂‰∏ä‰º†
        async function handleLargeFileUpload(file, form) {
            const startButton = document.getElementById('startConversion');
            const uploadContainer = document.getElementById('uploadProgressContainer');

            // ÊòæÁ§∫‰∏ä‰º†ËøõÂ∫¶ÂÆπÂô®
            uploadContainer.style.display = 'block';

            // Êõ¥Êñ∞UI
            startButton.disabled = true;
            startButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‰∏ä‰º†‰∏≠...';

            // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
            document.getElementById('uploadFileName').textContent = file.name;
            document.getElementById('totalSize').textContent = formatFileSize(file.size);

            try {
                const formData = new FormData();
                formData.append('videoFile', file);

                // Ê∑ªÂä†ÂÖ∂‰ªñË°®ÂçïÊï∞ÊçÆ
                const formElements = new FormData(form);
                for (let [key, value] of formElements.entries()) {
                    if (key !== 'videoFile') {
                        formData.append(key, value);
                    }
                }

                const response = await fetch('/api/upload/large-file', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`‰∏ä‰º†Â§±Ë¥• (${response.status}): ${errorText}`);
                }

                const result = await response.json();
                console.log('Â§ßÊñá‰ª∂‰∏ä‰º†ÁªìÊûú:', result);

                if (result.success) {
                    // ‰∏ä‰º†ÂíåËΩ¨Êç¢‰ªªÂä°ÂàõÂª∫ÈÉΩÊàêÂäü‰∫ÜÔºÅ
                    await handleConversionSuccess(result);
                    hideUploadProgress();
                } else {
                    throw new Error(result.message || '‰∏ä‰º†Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Â§ßÊñá‰ª∂‰∏ä‰º†Â§±Ë¥•:', error);
                showAlert('danger', '‰∏ä‰º†Â§±Ë¥•: ' + error.message);
                hideUploadProgress();
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆ
                startButton.disabled = false;
                startButton.innerHTML = '<i class="fas fa-play"></i> ÂºÄÂßãËΩ¨Êç¢';
            }
        }

        // Â§ÑÁêÜÊôÆÈÄöÊñá‰ª∂‰∏ä‰º†ÔºàÂéüÊúâÈÄªËæëÔºâ
        async function handleNormalFileUpload(form) {
            const formData = new FormData(form);

            // Â§ÑÁêÜÂ§çÈÄâÊ°ÜÂÄº
            const checkboxes = ['twoPass', 'fastStart', 'copyTimestamps'];
            checkboxes.forEach(name => {
                const checkbox = document.getElementById(name);
                if (checkbox) {
                    formData.delete(name);
                    formData.append(name, checkbox.checked ? 'true' : 'false');
                }
            });

            // Â§ÑÁêÜdeinterlaceÂ≠óÊÆµ - ËΩ¨Êç¢‰∏∫Â∏ÉÂ∞îÂÄº
            const deinterlaceSelect = document.getElementById('deinterlace');
            if (deinterlaceSelect) {
                formData.delete('deinterlace');
                // Â¶ÇÊûúÈÄâÊã©‰∫ÜÂéªÈöîË°åÊâ´ÊèèÊñπÊ≥ïÔºà‰∏çÊòØÁ©∫ÂÄºÔºâÔºåÂàô‰∏∫true
                const deinterlaceValue = deinterlaceSelect.value && deinterlaceSelect.value !== '';
                formData.append('deinterlace', deinterlaceValue ? 'true' : 'false');
            }

            const startButton = document.getElementById('startConversion');
            startButton.disabled = true;
            startButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‰∏ä‰º†‰∏≠...';

            try {
                const response = await fetch('/api/conversion/start', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`ËΩ¨Êç¢ÂêØÂä®Â§±Ë¥• (${response.status}): ${errorText}`);
                }

                const result = await response.json();
                console.log('ËΩ¨Êç¢ÂêØÂä®ÁªìÊûú:', result);

                if (result.success) {
                    await handleConversionSuccess(result);
                } else {
                    throw new Error(result.message || 'ËΩ¨Êç¢ÂêØÂä®Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ËΩ¨Êç¢ÂêØÂä®Â§±Ë¥•:', error);
                showAlert('danger', 'ËΩ¨Êç¢ÂêØÂä®Â§±Ë¥•: ' + error.message);
            } finally {
                startButton.disabled = false;
                startButton.innerHTML = '<i class="fas fa-play"></i> ÂºÄÂßãËΩ¨Êç¢';
            }
        }



        // Â§ÑÁêÜËΩ¨Êç¢ÊàêÂäü
        async function handleConversionSuccess(result) {
            currentTaskId = result.taskId;
            console.log("üéØ ËÆæÁΩÆÂΩìÂâç‰ªªÂä°ID:", currentTaskId);

            // Ëé∑ÂèñÊñá‰ª∂‰ø°ÊÅØ
            const fileInput = document.getElementById('videoFile');
            const outputFormat = document.getElementById('outputFormat').value;
            const taskData = {
                originalFileName: fileInput.files[0]?.name || result.fileName || '',
                outputFormat: outputFormat,
                fileSize: fileInput.files[0]?.size || result.fileSize || 0
            };

            showCurrentTask(result.taskName, taskData);

            // Âä†ÂÖ•‰ªªÂä°ÁªÑ‰ª•Êé•Êî∂ËøõÂ∫¶Êõ¥Êñ∞
            if (connection.state === signalR.HubConnectionState.Connected) {
                await connection.invoke("JoinTaskGroup", currentTaskId);
                console.log("‚úÖ Â∑≤Âä†ÂÖ•‰ªªÂä°ÁªÑ:", currentTaskId);
            } else {
                console.warn("‚ö†Ô∏è SignalRËøûÊé•Êú™Âª∫Á´ãÔºåÊó†Ê≥ïÂä†ÂÖ•‰ªªÂä°ÁªÑ");
                showAlert('warning', 'SignalRËøûÊé•Êú™Âª∫Á´ãÔºåÂèØËÉΩÊó†Ê≥ïÂÆûÊó∂ÊòæÁ§∫ËøõÂ∫¶');
            }

            // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
            showAlert('success', `ËΩ¨Êç¢‰ªªÂä°Â∑≤ÂàõÂª∫: ${result.taskName}`);

            // Á´ãÂç≥Âà∑Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®
            setTimeout(loadRecentTasks, 500);
        }

        // ÈöêËóè‰∏ä‰º†ËøõÂ∫¶
        function hideUploadProgress() {
            const uploadContainer = document.getElementById('uploadProgressContainer');
            uploadContainer.style.display = 'none';

            // ÈáçÁΩÆËøõÂ∫¶Êù°
            const progressBar = document.getElementById('uploadProgressBar');
            progressBar.style.width = '0%';
            progressBar.setAttribute('aria-valuenow', '0');

            document.getElementById('uploadPercentage').textContent = '0%';
            document.getElementById('uploadSpeed').textContent = '0 MB/s';
            document.getElementById('uploadTimeRemaining').textContent = 'ËÆ°ÁÆó‰∏≠...';
            document.getElementById('uploadedSize').textContent = '0 MB';
        }

        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Ê†ºÂºèÂåñÊó∂Èó¥
        function formatTime(seconds) {
            if (seconds < 60) return Math.round(seconds) + 'Áßí';
            if (seconds < 3600) return Math.round(seconds / 60) + 'ÂàÜÈíü';
            return Math.round(seconds / 3600) + 'Â∞èÊó∂';
        }

        // ÂèñÊ∂à‰ªªÂä° - ÊîπËøõÁâàÊú¨
        document.getElementById('cancelTask').addEventListener('click', async function() {
            if (currentTaskId && confirm('Á°ÆÂÆöË¶ÅÂèñÊ∂àÂΩìÂâçËΩ¨Êç¢‰ªªÂä°ÂêóÔºü\n\n‚ö†Ô∏è ËøôÂ∞ÜÁ´ãÂç≥ÁªàÊ≠¢FFmpegËøõÁ®ãÂπ∂ÂèñÊ∂àËΩ¨Êç¢„ÄÇ')) {
                const button = this;
                const originalText = button.innerHTML;

                try {
                    button.disabled = true;
                    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ê≠£Âú®ÂèñÊ∂à...';

                    console.log('üõë ÂèëÈÄÅÂèñÊ∂àËØ∑Ê±Ç:', currentTaskId);

                    // Ë∞ÉÁî®REST APIÂèñÊ∂à‰ªªÂä°
                    const response = await fetch(`/api/conversion/cancel/${currentTaskId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    const result = await response.json();

                    if (result.success) {
                        showAlert('success', '‚úÖ ‰ªªÂä°ÂèñÊ∂àÊàêÂäüÔºÅFFmpegËøõÁ®ãÂ∑≤ÁªàÊ≠¢„ÄÇ');
                        console.log('‚úÖ ‰ªªÂä°ÂèñÊ∂àÊàêÂäü:', currentTaskId);

                        // Á´ãÂç≥Êõ¥Êñ∞UIÁä∂ÊÄÅ
                        updateTaskStatus('cancelled', '‰ªªÂä°Â∑≤ÂèñÊ∂à');
                        updateTaskActionButtons('cancelled');

                        // Ê∏ÖÈô§ÂΩìÂâç‰ªªÂä°
                        currentTaskId = null;
                        hideCurrentTask();

                        // Âà∑Êñ∞‰ªªÂä°ÂàóË°®
                        setTimeout(loadRecentTasks, 1000);
                    } else {
                        throw new Error(result.message || 'ÂèñÊ∂àÂ§±Ë¥•');
                    }
                } catch (error) {
                    console.error('‚ùå ÂèñÊ∂à‰ªªÂä°Â§±Ë¥•:', error);
                    showAlert('danger', '‚ùå ÂèñÊ∂à‰ªªÂä°Â§±Ë¥•: ' + error.message);
                } finally {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }
            }
        });

        // Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅ
        document.getElementById('refreshTask').addEventListener('click', function() {
            refreshCurrentTask();
        });

        // ÈáçÊñ∞ÂºÄÂßãËΩ¨Êç¢
        document.getElementById('restartTask').addEventListener('click', function() {
            // ÈöêËóèÂΩìÂâç‰ªªÂä°ÊòæÁ§∫
            document.getElementById('currentTask').style.display = 'none';
            document.getElementById('noTask').style.display = 'block';

            // Ê∏ÖÈô§ÂΩìÂâç‰ªªÂä°ID
            currentTaskId = null;
            currentTaskStartTime = null;

            // ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
            showAlert('info', 'ËØ∑ÈáçÊñ∞ÈÄâÊã©Êñá‰ª∂Âπ∂ÈÖçÁΩÆËΩ¨Êç¢ÂèÇÊï∞');
        });

        // È¢ÑËÆæÈÄâÊã©ÂèòÂåñÊó∂Êõ¥Êñ∞È´òÁ∫ßËÆæÁΩÆ
        document.getElementById('preset').addEventListener('change', function() {
            updateAdvancedSettings(this.value);
            updateGpuAccelBadge(getVideoCodecFromPreset(this.value));
        });

        // Êô∫ËÉΩGPUÈ¢ÑËÆæÈÄâÊã©
        async function initializeSmartPresetSelection() {
            try {
                console.log('üîç ÂºÄÂßãÊô∫ËÉΩGPUÈ¢ÑËÆæÈÄâÊã©...');

                // Ê£ÄÊü•GPUËÉΩÂäõ
                const gpuResponse = await fetch('/api/gpu/capabilities');
                const gpuData = await gpuResponse.json();

                if (gpuData.success && gpuData.data) {
                    const capabilities = gpuData.data;
                    console.log('GPUËÉΩÂäõÊ£ÄÊµãÁªìÊûú:', capabilities);

                    // Â¶ÇÊûúÊîØÊåÅNVENCÔºå‰ºòÂÖàÈÄâÊã©GPUÈ¢ÑËÆæ
                    if (capabilities.nvidia && capabilities.nvidia.supported) {
                        selectBestGpuPreset('nvenc');
                        console.log('‚úÖ Ëá™Âä®ÈÄâÊã©NVIDIA GPUÈ¢ÑËÆæ');
                    }
                    // Â¶ÇÊûúÊîØÊåÅQSVÔºåÈÄâÊã©Intel GPUÈ¢ÑËÆæ
                    else if (capabilities.intel && capabilities.intel.supported) {
                        selectBestGpuPreset('qsv');
                        console.log('‚úÖ Ëá™Âä®ÈÄâÊã©Intel GPUÈ¢ÑËÆæ');
                    }
                    // Â¶ÇÊûúÊîØÊåÅAMFÔºåÈÄâÊã©AMD GPUÈ¢ÑËÆæ
                    else if (capabilities.amd && capabilities.amd.supported) {
                        selectBestGpuPreset('amf');
                        console.log('‚úÖ Ëá™Âä®ÈÄâÊã©AMD GPUÈ¢ÑËÆæ');
                    }
                    else {
                        console.log('‚ÑπÔ∏è Êú™Ê£ÄÊµãÂà∞GPUÊîØÊåÅÔºå‰ΩøÁî®ÈªòËÆ§CPUÈ¢ÑËÆæ');
                    }
                } else {
                    console.log('‚ö†Ô∏è GPUÊ£ÄÊµãÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§È¢ÑËÆæ');
                }
            } catch (error) {
                console.error('‚ùå Êô∫ËÉΩÈ¢ÑËÆæÈÄâÊã©Â§±Ë¥•:', error);
            }
        }

        // ÈÄâÊã©ÊúÄ‰Ω≥GPUÈ¢ÑËÆæ
        function selectBestGpuPreset(gpuType) {
            const presetSelect = document.getElementById('preset');
            const options = presetSelect.options;

            // È¢ÑËÆæ‰ºòÂÖàÁ∫ßÊò†Â∞Ñ
            const presetPriority = {
                'nvenc': [
                    'GPU Fast 1080p (NVENC)',
                    'GPU High Quality 1080p (NVENC)',
                    'GPU 4K Ultra (NVENC)'
                ],
                'qsv': [
                    'GPU Fast 1080p (QSV)',
                    'GPU High Quality 1080p (QSV)'
                ],
                'amf': [
                    'GPU Fast 1080p (AMF)',
                    'GPU High Quality 1080p (AMF)'
                ]
            };

            const preferredPresets = presetPriority[gpuType] || [];

            // Êåâ‰ºòÂÖàÁ∫ßÊü•ÊâæÂπ∂ÈÄâÊã©È¢ÑËÆæ
            for (const presetName of preferredPresets) {
                for (let i = 0; i < options.length; i++) {
                    if (options[i].value === presetName) {
                        presetSelect.selectedIndex = i;
                        updateAdvancedSettings(presetName);
                        updateGpuAccelBadge(getVideoCodecFromPreset(presetName));

                        // ÊòæÁ§∫GPUÂä†ÈÄüÊèêÁ§∫
                        showGpuAccelNotification(presetName);
                        return;
                    }
                }
            }
        }

        // ÊòæÁ§∫GPUÂä†ÈÄüÈÄöÁü•
        function showGpuAccelNotification(presetName) {
            const notification = document.createElement('div');
            notification.className = 'alert alert-success alert-dismissible fade show mt-2';
            notification.innerHTML = `
                <i class="fas fa-rocket"></i>
                <strong>GPUÂä†ÈÄüÂ∑≤ÂêØÁî®ÔºÅ</strong>
                Â∑≤Ëá™Âä®ÈÄâÊã© "${presetName}" È¢ÑËÆæÔºåËΩ¨Êç¢ÈÄüÂ∫¶Â∞ÜÊòæËëóÊèêÂçá„ÄÇ
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            const presetContainer = document.getElementById('preset').parentElement;
            presetContainer.appendChild(notification);

            // 3ÁßíÂêéËá™Âä®ÈöêËóè
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // ‰ªéÈ¢ÑËÆæÂêçÁß∞Ëé∑ÂèñËßÜÈ¢ëÁºñÁ†ÅÂô®
        function getVideoCodecFromPreset(presetName) {
            // ËøôÈáåÂèØ‰ª•Ê†πÊçÆÈ¢ÑËÆæÂêçÁß∞Êé®Êñ≠ÁºñÁ†ÅÂô®
            if (presetName.includes('NVENC')) return 'h264_nvenc';
            if (presetName.includes('QSV')) return 'h264_qsv';
            if (presetName.includes('AMF')) return 'h264_amf';
            return 'libx264'; // ÈªòËÆ§CPUÁºñÁ†ÅÂô®
        }

        // ÂàÜËæ®ÁéáÈÄâÊã©Â§ÑÁêÜ
        document.getElementById('resolution').addEventListener('change', function() {
            const customResolution = document.getElementById('customResolution');
            if (this.value === 'custom') {
                customResolution.style.display = 'block';
            } else {
                customResolution.style.display = 'none';
            }
        });

        // Ë¥®ÈáèÊéßÂà∂Ê®°ÂºèÂàáÊç¢
        document.querySelectorAll('input[name="qualityMode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const crfSettings = document.getElementById('crfSettings');
                const bitrateSettings = document.getElementById('bitrateSettings');

                if (this.value === 'crf') {
                    crfSettings.style.display = 'block';
                    bitrateSettings.style.display = 'none';
                } else {
                    crfSettings.style.display = 'none';
                    bitrateSettings.style.display = 'block';
                }
            });
        });

        // Èü≥È¢ëË¥®ÈáèÊ®°ÂºèÂàáÊç¢
        document.querySelectorAll('input[name="audioQualityMode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const bitrateSettings = document.getElementById('audioBitrateSettings');
                const qualitySettings = document.getElementById('audioQualitySettings');

                if (this.value === 'bitrate') {
                    bitrateSettings.style.display = 'block';
                    qualitySettings.style.display = 'none';
                } else {
                    bitrateSettings.style.display = 'none';
                    qualitySettings.style.display = 'block';
                }
            });
        });

        // Ëá™ÂÆö‰πâÈü≥È¢ëÊØîÁâπÁéá
        document.getElementById('audioBitrate').addEventListener('change', function() {
            const customBitrate = document.getElementById('customAudioBitrate');
            if (this.value === 'custom') {
                customBitrate.style.display = 'block';
            } else {
                customBitrate.style.display = 'none';
            }
        });

        // ÊªëÂùóÂÄºÊõ¥Êñ∞
        document.getElementById('videoQuality').addEventListener('input', function() {
            document.getElementById('qualityValue').textContent = this.value;
        });

        document.getElementById('audioQualityValue').addEventListener('input', function() {
            document.getElementById('audioQualityDisplay').textContent = this.value;
        });

        document.getElementById('audioVolume').addEventListener('input', function() {
            document.getElementById('volumeValue').textContent = this.value;
        });

        // ËæìÂá∫Ê†ºÂºèÂèòÂåñÊó∂Êõ¥Êñ∞Áõ∏ÂÖ≥ËÆæÁΩÆ
        document.getElementById('outputFormat').addEventListener('change', function() {
            updateCodecOptions(this.value);
            toggleVideoSettings(this.value);
        });

        // Ê†πÊçÆËæìÂá∫Ê†ºÂºèÊõ¥Êñ∞ÁºñËß£Á†ÅÂô®ÈÄâÈ°π
        function updateCodecOptions(format) {
            const videoCodec = document.getElementById('videoCodec');
            const audioCodec = document.getElementById('audioCodec');

            // Ê∏ÖÁ©∫Áé∞ÊúâÈÄâÈ°π
            videoCodec.innerHTML = '';
            audioCodec.innerHTML = '';

            // Ê†πÊçÆÊ†ºÂºèÊ∑ªÂä†Áõ∏Â∫îÁöÑÁºñËß£Á†ÅÂô®ÈÄâÈ°π
            switch(format) {
                case 'mp4':
                case 'mp4_h265':
                    videoCodec.innerHTML = `
                        <option value="libx264">H.264 (x264) - CPU</option>
                        <option value="h264_nvenc">H.264 (NVENC) - NVIDIA GPU</option>
                        <option value="h264_qsv">H.264 (QSV) - Intel GPU</option>
                        <option value="h264_amf">H.264 (AMF) - AMD GPU</option>
                        <option value="libx265">H.265 (x265) - CPU</option>
                        <option value="hevc_nvenc">H.265 (NVENC) - NVIDIA GPU</option>
                        <option value="hevc_qsv">H.265 (QSV) - Intel GPU</option>
                        <option value="hevc_amf">H.265 (AMF) - AMD GPU</option>
                        <option value="mpeg4">MPEG-4</option>
                    `;
                    audioCodec.innerHTML = `
                        <option value="aac">AAC</option>
                        <option value="libmp3lame">MP3</option>
                        <option value="ac3">AC-3</option>
                    `;
                    break;
                case 'webm':
                    videoCodec.innerHTML = `
                        <option value="libvpx-vp9">VP9</option>
                        <option value="libvpx">VP8</option>
                        <option value="libaom-av1">AV1</option>
                    `;
                    audioCodec.innerHTML = `
                        <option value="libvorbis">Vorbis</option>
                        <option value="libopus">Opus</option>
                    `;
                    break;
                case 'avi':
                    videoCodec.innerHTML = `
                        <option value="libx264">H.264 (x264)</option>
                        <option value="mpeg4">MPEG-4</option>
                        <option value="libxvid">Xvid</option>
                    `;
                    audioCodec.innerHTML = `
                        <option value="libmp3lame">MP3</option>
                        <option value="aac">AAC</option>
                        <option value="ac3">AC-3</option>
                    `;
                    break;
                case 'mkv':
                    videoCodec.innerHTML = `
                        <option value="libx264">H.264 (x264) - CPU</option>
                        <option value="h264_nvenc">H.264 (NVENC) - NVIDIA GPU</option>
                        <option value="h264_qsv">H.264 (QSV) - Intel GPU</option>
                        <option value="h264_amf">H.264 (AMF) - AMD GPU</option>
                        <option value="libx265">H.265 (x265) - CPU</option>
                        <option value="hevc_nvenc">H.265 (NVENC) - NVIDIA GPU</option>
                        <option value="hevc_qsv">H.265 (QSV) - Intel GPU</option>
                        <option value="hevc_amf">H.265 (AMF) - AMD GPU</option>
                        <option value="libvpx-vp9">VP9</option>
                        <option value="libaom-av1">AV1</option>
                        <option value="av1_nvenc">AV1 (NVENC) - NVIDIA GPU</option>
                        <option value="av1_qsv">AV1 (QSV) - Intel GPU</option>
                        <option value="av1_amf">AV1 (AMF) - AMD GPU</option>
                    `;
                    audioCodec.innerHTML = `
                        <option value="aac">AAC</option>
                        <option value="libvorbis">Vorbis</option>
                        <option value="libopus">Opus</option>
                        <option value="flac">FLAC</option>
                    `;
                    break;
                case 'mov':
                    videoCodec.innerHTML = `
                        <option value="libx264">H.264 (x264)</option>
                        <option value="libx265">H.265 (x265)</option>
                        <option value="mpeg4">MPEG-4</option>
                    `;
                    audioCodec.innerHTML = `
                        <option value="aac">AAC</option>
                        <option value="libmp3lame">MP3</option>
                        <option value="pcm_s16le">PCM</option>
                    `;
                    break;
                default: // Èü≥È¢ëÊ†ºÂºè
                    videoCodec.innerHTML = '<option value="">Êó† (‰ªÖÈü≥È¢ë)</option>';
                    if (format === 'mp3') {
                        audioCodec.innerHTML = '<option value="libmp3lame">MP3</option>';
                    } else if (format === 'aac') {
                        audioCodec.innerHTML = '<option value="aac">AAC</option>';
                    } else if (format === 'flac') {
                        audioCodec.innerHTML = '<option value="flac">FLAC</option>';
                    }
                    break;
            }
        }

        // Ê†πÊçÆÊ†ºÂºèÂàáÊç¢ËßÜÈ¢ëËÆæÁΩÆÊòæÁ§∫
        function toggleVideoSettings(format) {
            const videoPanel = document.getElementById('videoPanel');
            const isAudioOnly = ['mp3', 'aac', 'flac'].includes(format);

            if (isAudioOnly) {
                videoPanel.style.opacity = '0.5';
                videoPanel.style.pointerEvents = 'none';
            } else {
                videoPanel.style.opacity = '1';
                videoPanel.style.pointerEvents = 'auto';
            }
        }

        // ÂÆΩÈ´òÊØîËÆ°ÁÆó
        document.getElementById('aspectRatio').addEventListener('change', function() {
            const width = document.getElementById('customWidth');
            const height = document.getElementById('customHeight');

            if (this.value && width.value) {
                const ratios = {
                    '16:9': 16/9,
                    '4:3': 4/3,
                    '1:1': 1,
                    '21:9': 21/9
                };

                if (ratios[this.value]) {
                    height.value = Math.round(width.value / ratios[this.value]);
                }
            }
        });

        // Êó∂Èó¥Ê†ºÂºèÈ™åËØÅ
        function validateTimeFormat(input) {
            const timePattern = /^([0-9]{2}):([0-9]{2}):([0-9]{2})$/;
            return timePattern.test(input.value);
        }

        document.getElementById('startTime').addEventListener('blur', function() {
            if (this.value && !validateTimeFormat(this)) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });

        document.getElementById('duration').addEventListener('blur', function() {
            if (this.value && !validateTimeFormat(this)) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });

        // ÂàùÂßãÂåñÁºñËß£Á†ÅÂô®ÈÄâÈ°π
        updateCodecOptions(document.getElementById('outputFormat').value);

        // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫
        function updateProgress(data) {
            console.log("üìä Êî∂Âà∞ËøõÂ∫¶Êõ¥Êñ∞:", data);
            console.log("üîç ÂΩìÂâç‰ªªÂä°ID:", currentTaskId);
            console.log("üîç ËøõÂ∫¶Êï∞ÊçÆ‰ªªÂä°ID:", data.taskId);

            if (data.taskId !== currentTaskId) {
                console.log("‚ö†Ô∏è ‰ªªÂä°ID‰∏çÂåπÈÖçÔºåÂøΩÁï•ËøõÂ∫¶Êõ¥Êñ∞");
                console.log("‚ö†Ô∏è ÂΩìÂâç‰ªªÂä°ID:", currentTaskId);
                console.log("‚ö†Ô∏è ËøõÂ∫¶Êï∞ÊçÆ‰ªªÂä°ID:", data.taskId);
                return;
            }

            const progressBar = document.getElementById('progressBar');
            const taskStatus = document.getElementById('taskStatus');
            const conversionSpeed = document.getElementById('conversionSpeed');
            const remainingTime = document.getElementById('remainingTime');
            const elapsedTime = document.getElementById('elapsedTime');

            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            if (progressBar) {
                progressBar.style.width = data.progress + '%';
                progressBar.setAttribute('aria-valuenow', data.progress);
                progressBar.querySelector('span').textContent = data.progress + '%';

                // Ê†πÊçÆËøõÂ∫¶Ë∞ÉÊï¥ËøõÂ∫¶Êù°È¢úËâ≤
                if (data.progress >= 100) {
                    progressBar.className = 'progress-bar bg-success';
                } else if (data.progress >= 50) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-primary';
                } else {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated';
                }
            }

            // Êõ¥Êñ∞Áä∂ÊÄÅ‰ø°ÊÅØ - Âè™ÊúâÂΩìÊúâÂÖ∑‰ΩìÊ∂àÊÅØÊó∂ÊâçÊõ¥Êñ∞
            if (taskStatus && data.message) {
                taskStatus.textContent = data.message;
            }

            // Êõ¥Êñ∞ËΩ¨Êç¢ÈÄüÂ∫¶
            if (conversionSpeed && data.speed) {
                conversionSpeed.textContent = data.speed.toFixed(2) + 'x';
                conversionSpeed.className = data.speed > 1 ? 'fw-bold text-success' : 'fw-bold text-warning';
            }

            // Êõ¥Êñ∞Ââ©‰ΩôÊó∂Èó¥
            if (remainingTime && data.remainingSeconds) {
                remainingTime.textContent = formatTime(data.remainingSeconds);
            }

            // Êõ¥Êñ∞Â∑≤Áî®Êó∂Èó¥
            if (elapsedTime && currentTaskStartTime) {
                const elapsed = Math.floor((Date.now() - currentTaskStartTime) / 1000);
                elapsedTime.textContent = formatTime(elapsed);
            }

            // Êõ¥Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®‰∏≠ÁöÑËøõÂ∫¶
            updateRecentTaskProgress(data.taskId, data.progress, data.message);
        }

        // ‰∏ä‰º†ËøõÂ∫¶Êõ¥Êñ∞Èò≤ÊäñÊéßÂà∂
        let uploadProgressUpdateTimeout = null;
        let lastUploadProgressData = null;

        // Êõ¥Êñ∞‰∏ä‰º†ËøõÂ∫¶ÊòæÁ§∫ - ‰ºòÂåñÁâàÊú¨
        function updateUploadProgress(data) {
            console.log("üì§ Êî∂Âà∞‰∏ä‰º†ËøõÂ∫¶Êõ¥Êñ∞:", data);

            // ‰øùÂ≠òÊúÄÊñ∞Êï∞ÊçÆ
            lastUploadProgressData = data;

            // Ê∏ÖÈô§‰πãÂâçÁöÑÊõ¥Êñ∞ËÆ°Êó∂Âô®
            if (uploadProgressUpdateTimeout) {
                clearTimeout(uploadProgressUpdateTimeout);
            }

            // Á´ãÂç≥Êõ¥Êñ∞ÂÖ≥ÈîÆ‰ø°ÊÅØÔºàËøõÂ∫¶ÁôæÂàÜÊØîÔºâ
            updateProgressBarImmediate(data);

            // Âª∂ËøüÊõ¥Êñ∞ÂÖ∂‰ªñ‰ø°ÊÅØÔºàÈò≤ÊäñÔºâ
            uploadProgressUpdateTimeout = setTimeout(() => {
                updateProgressDetails(lastUploadProgressData);
            }, 50); // 50msÈò≤Êäñ
        }

        // Á´ãÂç≥Êõ¥Êñ∞ËøõÂ∫¶Êù°
        function updateProgressBarImmediate(data) {
            const uploadContainer = document.getElementById('uploadProgressContainer');
            if (uploadContainer.style.display === 'none') {
                uploadContainer.style.display = 'block';
            }

            const progressBar = document.getElementById('uploadProgressBar');
            const percentage = document.getElementById('uploadPercentage');

            if (progressBar) {
                // ‰ΩøÁî®CSSËøáÊ∏°ÂÆûÁé∞Âπ≥ÊªëÂä®Áîª
                progressBar.style.transition = 'width 0.3s ease-out';
                progressBar.style.width = data.ProgressPercent + '%';
                progressBar.setAttribute('aria-valuenow', data.ProgressPercent);

                // Ê†πÊçÆËøõÂ∫¶Ë∞ÉÊï¥È¢úËâ≤
                if (data.ProgressPercent >= 100) {
                    progressBar.className = 'progress-bar bg-success';
                } else if (data.ProgressPercent >= 80) {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-info';
                } else {
                    progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-primary';
                }
            }

            if (percentage) {
                percentage.textContent = data.ProgressPercent + '%';
            }
        }

        // Êõ¥Êñ∞ËØ¶ÁªÜ‰ø°ÊÅØ
        function updateProgressDetails(data) {
            if (!data) return;

            const speed = document.getElementById('uploadSpeed');
            const timeRemaining = document.getElementById('uploadTimeRemaining');
            const uploadedSize = document.getElementById('uploadedSize');
            const fileName = document.getElementById('uploadFileName');
            const uploadContainer = document.getElementById('uploadProgressContainer');

            // Ê£ÄÊµãÈ´òÈÄü‰∏ä‰º†ÔºàË∂ÖËøá100MB/sÔºâ
            const isHighSpeed = data.Speed && data.Speed > 100 * 1024 * 1024;
            if (isHighSpeed) {
                uploadContainer.classList.add('high-speed-upload');
            } else {
                uploadContainer.classList.remove('high-speed-upload');
            }

            // ‰ΩøÁî®ÂêéÁ´ØÊ†ºÂºèÂåñÁöÑÊï∞ÊçÆÔºàÂ¶ÇÊûúÂèØÁî®Ôºâ
            if (speed) {
                if (data.SpeedFormatted) {
                    speed.textContent = data.SpeedFormatted;
                    // È´òÈÄü‰∏ä‰º†Êó∂Ê∑ªÂä†ÁâπÊÆäÊ†áËØÜ
                    if (isHighSpeed) {
                        speed.innerHTML = `üöÄ ${data.SpeedFormatted}`;
                        speed.className = 'text-success fw-bold';
                    } else {
                        speed.className = '';
                    }
                } else if (data.Speed) {
                    const speedText = formatFileSize(data.Speed) + '/s';
                    speed.textContent = speedText;
                    if (isHighSpeed) {
                        speed.innerHTML = `üöÄ ${speedText}`;
                        speed.className = 'text-success fw-bold';
                    } else {
                        speed.className = '';
                    }
                } else {
                    speed.textContent = 'ËÆ°ÁÆó‰∏≠...';
                    speed.className = '';
                }
            }

            if (timeRemaining) {
                if (data.TimeRemainingFormatted) {
                    timeRemaining.textContent = data.TimeRemainingFormatted;
                } else if (data.EstimatedTimeRemaining && data.EstimatedTimeRemaining > 0) {
                    timeRemaining.textContent = formatTime(data.EstimatedTimeRemaining);
                } else {
                    timeRemaining.textContent = 'ËÆ°ÁÆó‰∏≠...';
                }
            }

            if (uploadedSize) {
                uploadedSize.textContent = formatFileSize(data.UploadedSize);
            }

            if (fileName && data.FileName) {
                fileName.textContent = data.FileName;
            }
        }

        // Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
        function updateTaskStatus(data) {
            console.log("üìã Êî∂Âà∞Áä∂ÊÄÅÊõ¥Êñ∞:", data);
            console.log("üîç ÂΩìÂâç‰ªªÂä°ID:", currentTaskId);
            console.log("üîç Áä∂ÊÄÅÊï∞ÊçÆ‰ªªÂä°ID:", data.taskId);

            if (data.taskId !== currentTaskId) {
                console.log("‚ö†Ô∏è ‰ªªÂä°ID‰∏çÂåπÈÖçÔºåÂøΩÁï•Áä∂ÊÄÅÊõ¥Êñ∞");
                console.log("‚ö†Ô∏è ÂΩìÂâç‰ªªÂä°ID:", currentTaskId);
                console.log("‚ö†Ô∏è Áä∂ÊÄÅÊï∞ÊçÆ‰ªªÂä°ID:", data.taskId);
                return;
            }

            const taskStatus = document.getElementById('taskStatus');
            const statusAlert = taskStatus?.closest('.alert');

            if (taskStatus) {
                // Ê†πÊçÆÁä∂ÊÄÅËÆæÁΩÆÂèãÂ•ΩÁöÑ‰∏≠ÊñáÊòæÁ§∫ÊñáÊú¨
                let statusText = '';
                switch (data.status) {
                    case 'Converting':
                        statusText = 'ËΩ¨Êç¢‰∏≠...';
                        break;
                    case 'Completed':
                        statusText = 'ËΩ¨Êç¢ÂÆåÊàê';
                        break;
                    case 'Failed':
                        statusText = 'ËΩ¨Êç¢Â§±Ë¥•';
                        break;
                    case 'Cancelled':
                        statusText = 'Â∑≤ÂèñÊ∂à';
                        break;
                    case 'Pending':
                        statusText = 'Á≠âÂæÖ‰∏≠...';
                        break;
                    default:
                        statusText = data.status || 'Áä∂ÊÄÅÊú™Áü•';
                }

                taskStatus.textContent = statusText;

                // Ê†πÊçÆÁä∂ÊÄÅÊõ¥Êñ∞Ê†∑Âºè
                if (statusAlert) {
                    statusAlert.className = 'alert mb-3';
                    switch (data.status) {
                        case 'Converting':
                            statusAlert.classList.add('alert-info');
                            break;
                        case 'Completed':
                            statusAlert.classList.add('alert-success');
                            break;
                        case 'Failed':
                            statusAlert.classList.add('alert-danger');
                            break;
                        case 'Cancelled':
                            statusAlert.classList.add('alert-warning');
                            break;
                        default:
                            statusAlert.classList.add('alert-secondary');
                    }
                }

                if (data.errorMessage) {
                    taskStatus.textContent += ' - ' + data.errorMessage;
                }
            }

            // Êõ¥Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®‰∏≠ÁöÑÁä∂ÊÄÅ
            updateRecentTaskStatus(data.taskId, data.status);
        }

        // Â§ÑÁêÜ‰ªªÂä°ÂÆåÊàê
        function handleTaskCompleted(data) {
            console.log("üéâ ‰ªªÂä°ÂÆåÊàê:", data);

            if (data.taskId !== currentTaskId) {
                console.log("‚ö†Ô∏è ‰ªªÂä°ID‰∏çÂåπÈÖçÔºåÂøΩÁï•ÂÆåÊàêÈÄöÁü•");
                return;
            }

            const progressBar = document.getElementById('progressBar');
            const taskStatus = document.getElementById('taskStatus');
            const cancelButton = document.getElementById('cancelTask');
            const refreshButton = document.getElementById('refreshTask');

            if (data.success) {
                // ÊàêÂäüÂÆåÊàê
                if (progressBar) {
                    progressBar.className = 'progress-bar bg-success';
                    progressBar.style.width = '100%';
                    progressBar.setAttribute('aria-valuenow', 100);
                    progressBar.querySelector('span').textContent = 'ÂÆåÊàê!';
                }

                if (taskStatus) {
                    taskStatus.textContent = 'ËΩ¨Êç¢ÂÆåÊàêÔºÅÊñá‰ª∂Â∑≤ÂáÜÂ§áÂ•Ω‰∏ãËΩΩ„ÄÇ';
                    const statusAlert = taskStatus.closest('.alert');
                    if (statusAlert) {
                        statusAlert.className = 'alert alert-success mb-3';
                    }
                }



                // ÊòæÁ§∫ÊàêÂäüÈÄöÁü•
                showAlert('success', `‰ªªÂä° "${data.taskName}" ËΩ¨Êç¢ÂÆåÊàêÔºÅ`);
            } else {
                // ËΩ¨Êç¢Â§±Ë¥•
                if (progressBar) {
                    progressBar.className = 'progress-bar bg-danger';
                    progressBar.style.width = '100%';
                    progressBar.querySelector('span').textContent = 'Â§±Ë¥•';
                }

                if (taskStatus) {
                    taskStatus.textContent = 'ËΩ¨Êç¢Â§±Ë¥•: ' + (data.errorMessage || 'Êú™Áü•ÈîôËØØ');
                    const statusAlert = taskStatus.closest('.alert');
                    if (statusAlert) {
                        statusAlert.className = 'alert alert-danger mb-3';
                    }
                }

                // ÊòæÁ§∫ËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ
                showErrorDetails(data.ErrorMessage || 'Êú™Áü•ÈîôËØØ');

                // ÊòæÁ§∫ÈîôËØØÈÄöÁü•
                showAlert('danger', `‰ªªÂä° "${data.TaskName}" ËΩ¨Êç¢Â§±Ë¥•: ${data.ErrorMessage || 'Êú™Áü•ÈîôËØØ'}`);
            }

            // Êõ¥Êñ∞Êìç‰ΩúÊåâÈíÆ
            updateTaskActionButtons(data.success ? 'completed' : 'failed', data.taskId);

            // Á´ãÂç≥Êõ¥Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®‰∏≠ÁöÑÁä∂ÊÄÅ
            if (data.success) {
                updateRecentTaskStatus(data.taskId, 'Completed');
            } else {
                updateRecentTaskStatus(data.taskId, 'Failed');
            }

            // Ê∏ÖÈô§ÂΩìÂâç‰ªªÂä°ID
            currentTaskId = null;
            currentTaskStartTime = null;

            // Âª∂ËøüÂà∑Êñ∞Êï¥‰∏™‰ªªÂä°ÂàóË°®‰ª•Á°Æ‰øùÊï∞ÊçÆÂ∫ìÂ∑≤Êõ¥Êñ∞
            setTimeout(loadRecentTasks, 1000);
        }

        // Êõ¥Êñ∞‰ªªÂä°Êìç‰ΩúÊåâÈíÆ
        function updateTaskActionButtons(state, taskId = null) {
            const cancelButton = document.getElementById('cancelTask');
            const refreshButton = document.getElementById('refreshTask');
            const downloadButton = document.getElementById('downloadTask');
            const restartButton = document.getElementById('restartTask');

            // ÈöêËóèÊâÄÊúâÊåâÈíÆ
            if (cancelButton) cancelButton.style.display = 'none';
            if (refreshButton) refreshButton.style.display = 'none';
            if (downloadButton) downloadButton.style.display = 'none';
            if (restartButton) restartButton.style.display = 'none';

            switch (state) {
                case 'converting':
                    // ËΩ¨Êç¢‰∏≠ÔºöÊòæÁ§∫ÂèñÊ∂àÊåâÈíÆ
                    if (cancelButton) cancelButton.style.display = 'inline-block';
                    break;

                case 'completed':
                    // ËΩ¨Êç¢ÂÆåÊàêÔºöÊòæÁ§∫‰∏ãËΩΩÂíåÈáçÊñ∞ÂºÄÂßãÊåâÈíÆ
                    if (downloadButton && taskId) {
                        downloadButton.href = `/api/conversion/download/${taskId}`;
                        downloadButton.style.display = 'inline-block';
                    }
                    if (restartButton) restartButton.style.display = 'inline-block';
                    if (refreshButton) refreshButton.style.display = 'inline-block';
                    break;

                case 'failed':
                    // ËΩ¨Êç¢Â§±Ë¥•ÔºöÊòæÁ§∫ÈáçÊñ∞ÂºÄÂßãÂíåÂà∑Êñ∞ÊåâÈíÆ
                    if (restartButton) restartButton.style.display = 'inline-block';
                    if (refreshButton) refreshButton.style.display = 'inline-block';
                    break;

                case 'cancelled':
                    // ËΩ¨Êç¢ÂèñÊ∂àÔºöÊòæÁ§∫ÈáçÊñ∞ÂºÄÂßãÂíåÂà∑Êñ∞ÊåâÈíÆ
                    if (restartButton) restartButton.style.display = 'inline-block';
                    if (refreshButton) refreshButton.style.display = 'inline-block';
                    break;

                default:
                    // ÈªòËÆ§Áä∂ÊÄÅÔºöÂè™ÊòæÁ§∫Âà∑Êñ∞ÊåâÈíÆ
                    if (refreshButton) refreshButton.style.display = 'inline-block';
                    break;
            }
        }

        let currentTaskStartTime = null;

        // ÊòæÁ§∫ÂΩìÂâç‰ªªÂä°
        function showCurrentTask(taskName, taskData = null) {
            console.log("üìù ÊòæÁ§∫ÂΩìÂâç‰ªªÂä°:", taskName, taskData);

            currentTaskStartTime = Date.now();

            document.getElementById('noTask').style.display = 'none';
            document.getElementById('currentTask').style.display = 'block';
            document.getElementById('currentTaskName').textContent = taskName;

            // ÊòæÁ§∫‰ªªÂä°ID
            if (currentTaskId) {
                document.getElementById('taskId').textContent = `ID: ${currentTaskId.substring(0, 8)}...`;
            }

            // ÊòæÁ§∫Êñá‰ª∂‰ø°ÊÅØ
            if (taskData) {
                const fileInfo = document.getElementById('fileInfo');
                const originalFileName = document.getElementById('originalFileName');
                const outputFormat = document.getElementById('outputFormat');
                const fileSize = document.getElementById('fileSize');

                if (taskData.originalFileName) {
                    originalFileName.textContent = taskData.originalFileName;
                    fileInfo.style.display = 'block';
                }

                if (taskData.outputFormat) {
                    outputFormat.textContent = taskData.outputFormat.toUpperCase();
                }

                if (taskData.fileSize) {
                    fileSize.textContent = formatFileSize(taskData.fileSize);
                }

                // ÊòæÁ§∫ËΩ¨Êç¢ÂèÇÊï∞ËØ¶ÊÉÖ
                showConversionDetails(taskData);
            }

            // ÈáçÁΩÆËøõÂ∫¶Êù°
            const progressBar = document.getElementById('progressBar');
            progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated';
            progressBar.style.width = '0%';
            progressBar.setAttribute('aria-valuenow', 0);
            progressBar.querySelector('span').textContent = '0%';

            // ÈáçÁΩÆÁä∂ÊÄÅ‰ø°ÊÅØ
            document.getElementById('taskStatus').textContent = 'ÂáÜÂ§á‰∏≠...';
            const statusAlert = document.getElementById('taskStatus').closest('.alert');
            if (statusAlert) {
                statusAlert.className = 'alert alert-info mb-3';
            }

            // ÈáçÁΩÆÂÖ∂‰ªñ‰ø°ÊÅØ
            document.getElementById('conversionSpeed').textContent = '-';
            document.getElementById('remainingTime').textContent = '-';
            document.getElementById('elapsedTime').textContent = '-';

            // ËÆæÁΩÆÊåâÈíÆ‰∏∫ËΩ¨Êç¢‰∏≠Áä∂ÊÄÅ
            updateTaskActionButtons('converting');

            // ÈöêËóèÈîôËØØËØ¶ÊÉÖ
            hideErrorDetails();
        }

        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Ê†ºÂºèÂåñÊó∂Èó¥ÔºàÁßíËΩ¨Êç¢‰∏∫HH:MM:SSÔºâ
        function formatTime(seconds) {
            if (!seconds || seconds <= 0) return '-';

            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);

            if (hours > 0) {
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        // Êõ¥Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®‰∏≠ÁöÑËøõÂ∫¶
        function updateRecentTaskProgress(taskId, progress, message) {
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                // Êõ¥Êñ∞ËøõÂ∫¶ÊñáÊú¨
                const progressElement = taskElement.querySelector('.task-progress');
                if (progressElement) {
                    progressElement.textContent = `${progress}%`;
                    progressElement.className = `task-progress ms-2 text-${progress >= 100 ? 'success' : 'primary'}`;
                }

                // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                const progressBar = taskElement.querySelector('.progress-bar');
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                    progressBar.className = `progress-bar ${progress >= 100 ? 'bg-success' : 'bg-primary'}`;
                }

                // Êõ¥Êñ∞Áä∂ÊÄÅÂõæÊ†á
                const statusIcon = taskElement.querySelector('.status-icon');
                if (statusIcon && progress < 100) {
                    statusIcon.className = `fas fa-spinner fa-spin status-icon text-primary`;
                }

                console.log(`üìä Â∑≤Êõ¥Êñ∞‰ªªÂä° ${taskId} ËøõÂ∫¶: ${progress}%`);
            } else {
                console.log(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°ÂÖÉÁ¥†: ${taskId}ÔºåÂà∑Êñ∞‰ªªÂä°ÂàóË°®`);
                // Â¶ÇÊûúÊâæ‰∏çÂà∞‰ªªÂä°ÂÖÉÁ¥†ÔºåÂà∑Êñ∞Êï¥‰∏™ÂàóË°®
                setTimeout(loadRecentTasks, 500);
            }
        }

        // Êõ¥Êñ∞ÊúÄËøë‰ªªÂä°ÂàóË°®‰∏≠ÁöÑÁä∂ÊÄÅ
        function updateRecentTaskStatus(taskId, status) {
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                // Êõ¥Êñ∞Áä∂ÊÄÅÂæΩÁ´†
                const statusBadge = taskElement.querySelector('.badge.task-status');
                if (statusBadge) {
                    statusBadge.textContent = getStatusText(status);
                    statusBadge.className = `badge ${getStatusClass(status)} task-status`;
                }

                // Êõ¥Êñ∞Áä∂ÊÄÅÂõæÊ†á
                const statusIcon = taskElement.querySelector('.status-icon');
                if (statusIcon) {
                    statusIcon.className = `fas fa-${getStatusIcon(status)} status-icon text-${getStatusColor(status)}`;
                }

                // Ê†πÊçÆÁä∂ÊÄÅÊõ¥Êñ∞Êìç‰ΩúÊåâÈíÆ
                const btnGroup = taskElement.querySelector('.btn-group-vertical');
                if (btnGroup) {
                    let buttonsHtml = '';

                    if (status === 'Completed') {
                        buttonsHtml = `
                            <a href="/api/conversion/download/${taskId}"
                               class="btn btn-sm btn-outline-success"
                               title="‰∏ãËΩΩËΩ¨Êç¢ÂêéÁöÑÊñá‰ª∂">
                                <i class="fas fa-download"></i>
                            </a>
                        `;
                    } else if (status === 'Converting' || status === 'Pending') {
                        buttonsHtml = `
                            <button class="btn btn-sm btn-outline-info"
                                    onclick="viewTaskDetails('${taskId}')"
                                    title="Êü•ÁúãËØ¶ÊÉÖ">
                                <i class="fas fa-eye"></i>
                            </button>
                        `;
                    }

                    btnGroup.innerHTML = buttonsHtml;
                }

                console.log(`üìã Â∑≤Êõ¥Êñ∞‰ªªÂä° ${taskId} Áä∂ÊÄÅ: ${status}`);
            } else {
                console.log(`‚ö†Ô∏è Êú™ÊâæÂà∞‰ªªÂä°ÂÖÉÁ¥†: ${taskId}ÔºåÂà∑Êñ∞‰ªªÂä°ÂàóË°®`);
                // Â¶ÇÊûúÊâæ‰∏çÂà∞‰ªªÂä°ÂÖÉÁ¥†ÔºåÂà∑Êñ∞Êï¥‰∏™ÂàóË°®
                setTimeout(loadRecentTasks, 500);
            }
        }

        // ÊòæÁ§∫ËΩ¨Êç¢ÂèÇÊï∞ËØ¶ÊÉÖ
        function showConversionDetails(taskData) {
            const detailsAccordion = document.getElementById('taskDetailsAccordion');

            // ‰ªéË°®ÂçïËé∑ÂèñÂΩìÂâçËÆæÁΩÆ
            const formData = {
                videoCodec: document.getElementById('videoCodec')?.value || '-',
                resolution: document.getElementById('resolution')?.value || '‰øùÊåÅÂéüÂßã',
                videoQuality: document.getElementById('videoQuality')?.value || '-',
                frameRate: document.getElementById('frameRate')?.value || '‰øùÊåÅÂéüÂßã',
                audioCodec: document.getElementById('audioCodec')?.value || '-',
                audioBitrate: document.getElementById('audioBitrate')?.value || '-',
                audioChannels: document.getElementById('audioChannels')?.value || '‰øùÊåÅÂéüÂßã',
                sampleRate: document.getElementById('sampleRate')?.value || '‰øùÊåÅÂéüÂßã',
                encodingPreset: document.getElementById('encodingPreset')?.value || 'medium',
                twoPass: document.getElementById('twoPass')?.checked || false,
                fastStart: document.getElementById('fastStart')?.checked || false,
                customParams: document.getElementById('customParams')?.value || ''
            };

            // Êõ¥Êñ∞ËØ¶ÊÉÖÊòæÁ§∫
            document.getElementById('videoCodecDetail').textContent = getCodecDisplayName(formData.videoCodec);
            document.getElementById('resolutionDetail').textContent = formData.resolution === 'custom' ?
                `${document.getElementById('customWidth')?.value || '?'}x${document.getElementById('customHeight')?.value || '?'}` :
                (formData.resolution || '‰øùÊåÅÂéüÂßã');

            // Ë¥®ÈáèÊòæÁ§∫
            const qualityMode = document.querySelector('input[name="qualityMode"]:checked')?.value;
            if (qualityMode === 'crf') {
                document.getElementById('qualityDetail').textContent = `CRF ${formData.videoQuality}`;
            } else {
                const bitrate = document.getElementById('videoBitrate')?.value;
                document.getElementById('qualityDetail').textContent = bitrate ? `${bitrate} kbps` : '-';
            }

            document.getElementById('frameRateDetail').textContent = formData.frameRate || '‰øùÊåÅÂéüÂßã';
            document.getElementById('audioCodecDetail').textContent = getCodecDisplayName(formData.audioCodec);

            // Èü≥È¢ëÊØîÁâπÁéáÊòæÁ§∫
            const audioBitrate = formData.audioBitrate === 'custom' ?
                document.getElementById('customAudioBitrateValue')?.value + ' kbps' :
                formData.audioBitrate;
            document.getElementById('audioBitrateDetail').textContent = audioBitrate || '-';

            document.getElementById('audioChannelsDetail').textContent = getChannelsDisplayName(formData.audioChannels);
            document.getElementById('sampleRateDetail').textContent = getSampleRateDisplayName(formData.sampleRate);
            document.getElementById('encodingPresetDetail').textContent = formData.encodingPreset;
            document.getElementById('twoPassDetail').textContent = formData.twoPass ? 'ÊòØ' : 'Âê¶';
            document.getElementById('fastStartDetail').textContent = formData.fastStart ? 'ÊòØ' : 'Âê¶';

            // Ëá™ÂÆö‰πâÂèÇÊï∞
            const customParamsDetail = document.getElementById('customParamsDetail');
            if (formData.customParams) {
                customParamsDetail.style.display = 'block';
                customParamsDetail.querySelector('code').textContent = formData.customParams;
            } else {
                customParamsDetail.style.display = 'none';
            }

            detailsAccordion.style.display = 'block';
        }

        // Ëé∑ÂèñÁºñËß£Á†ÅÂô®ÊòæÁ§∫ÂêçÁß∞
        function getCodecDisplayName(codec) {
            const codecNames = {
                'libx264': 'H.264 (x264)',
                'libx265': 'H.265 (x265)',
                'libvpx-vp9': 'VP9',
                'libvpx': 'VP8',
                'libaom-av1': 'AV1',
                'mpeg4': 'MPEG-4',
                'aac': 'AAC',
                'libmp3lame': 'MP3',
                'libvorbis': 'Vorbis',
                'libopus': 'Opus',
                'flac': 'FLAC',
                'ac3': 'AC-3'
            };
            return codecNames[codec] || codec || '-';
        }

        // Ëé∑ÂèñÂ£∞ÈÅìÊòæÁ§∫ÂêçÁß∞
        function getChannelsDisplayName(channels) {
            const channelNames = {
                '1': 'ÂçïÂ£∞ÈÅì (1.0)',
                '2': 'Á´ã‰ΩìÂ£∞ (2.0)',
                '6': '5.1ÁéØÁªïÂ£∞',
                '8': '7.1ÁéØÁªïÂ£∞'
            };
            return channelNames[channels] || channels || '‰øùÊåÅÂéüÂßã';
        }

        // Ëé∑ÂèñÈááÊ†∑ÁéáÊòæÁ§∫ÂêçÁß∞
        function getSampleRateDisplayName(sampleRate) {
            if (!sampleRate) return '‰øùÊåÅÂéüÂßã';
            const rate = parseInt(sampleRate);
            if (rate >= 1000) {
                return `${rate / 1000} kHz`;
            }
            return `${rate} Hz`;
        }

        // ÊòæÁ§∫ÈîôËØØËØ¶ÊÉÖ
        function showErrorDetails(errorMessage) {
            const errorDetails = document.getElementById('errorDetails');
            const errorMessageElement = document.getElementById('errorMessage');

            errorMessageElement.textContent = errorMessage;
            errorDetails.style.display = 'block';

            // ÁîüÊàêÊïÖÈöúÊéíÈô§Âª∫ËÆÆ
            generateTroubleshootingTips(errorMessage);
        }

        // ÈöêËóèÈîôËØØËØ¶ÊÉÖ
        function hideErrorDetails() {
            document.getElementById('errorDetails').style.display = 'none';
            document.getElementById('troubleshootingTips').style.display = 'none';
        }

        // Â§çÂà∂ÈîôËØØ‰ø°ÊÅØÂà∞Ââ™Ë¥¥Êùø
        async function copyErrorToClipboard() {
            const errorMessage = document.getElementById('errorMessage').textContent;
            try {
                await navigator.clipboard.writeText(errorMessage);
                showAlert('success', 'ÈîôËØØ‰ø°ÊÅØÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
            } catch (err) {
                console.error('Â§çÂà∂Â§±Ë¥•:', err);
                showAlert('danger', 'Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÊã©ÊñáÊú¨Â§çÂà∂');
            }
        }

        // ÊòæÁ§∫ÊïÖÈöúÊéíÈô§ÊèêÁ§∫
        function showTroubleshooting() {
            const troubleshootingTips = document.getElementById('troubleshootingTips');
            troubleshootingTips.style.display = troubleshootingTips.style.display === 'none' ? 'block' : 'none';
        }

        // ÁîüÊàêÊïÖÈöúÊéíÈô§Âª∫ËÆÆ
        function generateTroubleshootingTips(errorMessage) {
            const troubleshootingList = document.getElementById('troubleshootingList');
            const tips = [];

            const lowerError = errorMessage.toLowerCase();

            if (lowerError.includes('ffmpeg')) {
                tips.push('Ê£ÄÊü•FFmpegÊòØÂê¶Ê≠£Á°ÆÂÆâË£ÖÂπ∂Âú®Á≥ªÁªüPATH‰∏≠');
                tips.push('Á°ÆËÆ§FFmpegÁâàÊú¨ÂÖºÂÆπÊÄß');
                tips.push('Â∞ùËØïÈáçÊñ∞ÂÆâË£ÖFFmpeg');
            }

            if (lowerError.includes('file') || lowerError.includes('not found')) {
                tips.push('Ê£ÄÊü•ËæìÂÖ•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®‰∏îÂèØËÆøÈóÆ');
                tips.push('Á°ÆËÆ§Êñá‰ª∂Ë∑ØÂæÑÊ≠£Á°Æ');
                tips.push('Ê£ÄÊü•Êñá‰ª∂ÊùÉÈôêËÆæÁΩÆ');
            }

            if (lowerError.includes('codec') || lowerError.includes('format')) {
                tips.push('Â∞ùËØï‰ΩøÁî®‰∏çÂêåÁöÑÁºñËß£Á†ÅÂô®');
                tips.push('Ê£ÄÊü•ËæìÂÖ•Êñá‰ª∂Ê†ºÂºèÊòØÂê¶ÊîØÊåÅ');
                tips.push('Â∞ùËØï‰ΩøÁî®ÈªòËÆ§ËΩ¨Êç¢È¢ÑËÆæ');
            }

            if (lowerError.includes('memory') || lowerError.includes('space')) {
                tips.push('Ê£ÄÊü•Á≥ªÁªüÂÜÖÂ≠ò‰ΩøÁî®ÊÉÖÂÜµ');
                tips.push('Á°ÆËÆ§Á£ÅÁõòÁ©∫Èó¥ÂÖÖË∂≥');
                tips.push('Â∞ùËØïÈôç‰ΩéËßÜÈ¢ëË¥®ÈáèËÆæÁΩÆ');
            }

            if (lowerError.includes('permission') || lowerError.includes('access')) {
                tips.push('Ê£ÄÊü•Êñá‰ª∂ÂíåÁõÆÂΩïÊùÉÈôê');
                tips.push('‰ª•ÁÆ°ÁêÜÂëòÊùÉÈôêËøêË°åÂ∫îÁî®Á®ãÂ∫è');
                tips.push('Á°ÆËÆ§Èò≤ÁóÖÊØíËΩØ‰ª∂Êú™ÈòªÊ≠¢Êìç‰Ωú');
            }

            if (tips.length === 0) {
                tips.push('Ê£ÄÊü•ËæìÂÖ•Êñá‰ª∂ÊòØÂê¶ÂÆåÊï¥‰∏îÊú™ÊçüÂùè');
                tips.push('Â∞ùËØï‰ΩøÁî®‰∏çÂêåÁöÑËΩ¨Êç¢ËÆæÁΩÆ');
                tips.push('Êü•ÁúãËØ¶ÁªÜÊó•ÂøóËé∑ÂèñÊõ¥Â§ö‰ø°ÊÅØ');
                tips.push('ËÅîÁ≥ªÊäÄÊúØÊîØÊåÅËé∑ÂèñÂ∏ÆÂä©');
            }

            troubleshootingList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
        }

        // ÊòæÁ§∫‰∏ãËΩΩÊåâÈíÆ
        function showDownloadButton(taskId) {
            const cancelButton = document.getElementById('cancelTask');
            cancelButton.outerHTML = `
                <a href="/api/conversion/download/${taskId}" class="btn btn-success btn-sm">
                    <i class="fas fa-download"></i> ‰∏ãËΩΩÊñá‰ª∂
                </a>
            `;
        }

        // Ê†ºÂºèÂåñÊó∂Èó¥
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }

        // Êõ¥Êñ∞È´òÁ∫ßËÆæÁΩÆ - ÊîØÊåÅÈ¢ÑËÆæÂèÇÊï∞‰øÆÊîπ
        function updateAdvancedSettings(presetName) {
            console.log('üîß Êõ¥Êñ∞È´òÁ∫ßËÆæÁΩÆ:', presetName);

            // È¢ÑËÆæÈÖçÁΩÆÊò†Â∞Ñ
            const presetConfigs = {
                // CPUÈ¢ÑËÆæ
                'Fast 1080p30': {
                    videoCodec: 'libx264',
                    audioCodec: 'aac',
                    videoQuality: '23',
                    audioQuality: '128k',
                    resolution: '1920x1080',
                    frameRate: '30',
                    outputFormat: 'mp4'
                },
                'High Quality 1080p': {
                    videoCodec: 'libx264',
                    audioCodec: 'aac',
                    videoQuality: '18',
                    audioQuality: '192k',
                    resolution: '1920x1080',
                    frameRate: '',
                    outputFormat: 'mp4'
                },
                'Web Optimized': {
                    videoCodec: 'libx264',
                    audioCodec: 'aac',
                    videoQuality: '25',
                    audioQuality: '128k',
                    resolution: '1280x720',
                    frameRate: '',
                    outputFormat: 'mp4'
                },

                // GPUÈ¢ÑËÆæ - NVIDIA NVENC
                'GPU Fast 1080p (NVENC)': {
                    videoCodec: 'h264_nvenc',
                    audioCodec: 'aac',
                    videoQuality: '23',
                    audioQuality: '128k',
                    resolution: '1920x1080',
                    frameRate: '30',
                    outputFormat: 'mp4'
                },
                'GPU High Quality 1080p (NVENC)': {
                    videoCodec: 'h264_nvenc',
                    audioCodec: 'aac',
                    videoQuality: '18',
                    audioQuality: '192k',
                    resolution: '1920x1080',
                    frameRate: '',
                    outputFormat: 'mp4'
                },
                'GPU 4K Ultra (NVENC)': {
                    videoCodec: 'hevc_nvenc',
                    audioCodec: 'aac',
                    videoQuality: '20',
                    audioQuality: '256k',
                    resolution: '3840x2160',
                    frameRate: '',
                    outputFormat: 'mp4'
                },

                // GPUÈ¢ÑËÆæ - Intel QSV
                'GPU Fast 1080p (QSV)': {
                    videoCodec: 'h264_qsv',
                    audioCodec: 'aac',
                    videoQuality: '23',
                    audioQuality: '128k',
                    resolution: '1920x1080',
                    frameRate: '30',
                    outputFormat: 'mp4'
                },

                // GPUÈ¢ÑËÆæ - AMD AMF
                'GPU Fast 1080p (AMF)': {
                    videoCodec: 'h264_amf',
                    audioCodec: 'aac',
                    videoQuality: '23',
                    audioQuality: '128k',
                    resolution: '1920x1080',
                    frameRate: '30',
                    outputFormat: 'mp4'
                }
            };

            const config = presetConfigs[presetName];
            if (!config) {
                console.log('‚ö†Ô∏è Êú™ÊâæÂà∞È¢ÑËÆæÈÖçÁΩÆ:', presetName);
                return;
            }

            // Êõ¥Êñ∞Ë°®ÂçïÂ≠óÊÆµÔºà‰ΩÜ‰øùÊåÅÂèØÁºñËæëÁä∂ÊÄÅÔºâ
            updateFormField('videoCodec', config.videoCodec);
            updateFormField('audioCodec', config.audioCodec);
            updateFormField('videoQuality', config.videoQuality);
            updateFormField('audioQuality', config.audioQuality);
            updateFormField('resolution', config.resolution);
            updateFormField('frameRate', config.frameRate);
            updateFormField('outputFormat', config.outputFormat);

            // ÊòæÁ§∫È¢ÑËÆæÂ∫îÁî®ÊèêÁ§∫
            showPresetAppliedNotification(presetName, config);

            console.log('‚úÖ È¢ÑËÆæÈÖçÁΩÆÂ∑≤Â∫îÁî®:', config);
        }

        // Êõ¥Êñ∞Ë°®ÂçïÂ≠óÊÆµÔºà‰øùÊåÅÂèØÁºñËæëÔºâ
        function updateFormField(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field && value !== undefined && value !== '') {
                field.value = value;

                // Ê∑ªÂä†ËßÜËßâÊèêÁ§∫Ë°®Á§∫Â≠óÊÆµÂ∑≤Ë¢´È¢ÑËÆæÊõ¥Êñ∞
                field.classList.add('preset-updated');

                // 2ÁßíÂêéÁßªÈô§ÊèêÁ§∫Ê†∑Âºè
                setTimeout(() => {
                    field.classList.remove('preset-updated');
                }, 2000);

                // Ëß¶Âèëchange‰∫ã‰ª∂‰ª•Êõ¥Êñ∞ÂÖ∂‰ªñÁõ∏ÂÖ≥UI
                field.dispatchEvent(new Event('change'));
            }
        }

        // ÊòæÁ§∫È¢ÑËÆæÂ∫îÁî®ÈÄöÁü•
        function showPresetAppliedNotification(presetName, config) {
            const isGpuPreset = config.videoCodec.includes('nvenc') ||
                               config.videoCodec.includes('qsv') ||
                               config.videoCodec.includes('amf');

            const icon = isGpuPreset ? 'fas fa-rocket' : 'fas fa-cog';
            const type = isGpuPreset ? 'success' : 'info';
            const message = isGpuPreset ?
                `GPUÂä†ÈÄüÈ¢ÑËÆæ "${presetName}" Â∑≤Â∫îÁî®` :
                `È¢ÑËÆæ "${presetName}" Â∑≤Â∫îÁî®`;

            showAlert(type, `<i class="${icon}"></i> ${message}ÔºåÂèÇÊï∞ÂèØ‰ª•ÁªßÁª≠Ë∞ÉÊï¥„ÄÇ`);
        }

        // Âä†ËΩΩÊúÄËøë‰ªªÂä°
        async function loadRecentTasks() {
            try {
                lastRefreshTime = Date.now();
                console.log("üîÑ Âä†ËΩΩÊúÄËøë‰ªªÂä°...");
                const response = await fetch('/api/conversion/recent?count=5');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const tasks = await response.json();
                console.log("üìã Ëé∑ÂèñÂà∞‰ªªÂä°:", tasks);

                const container = document.getElementById('recentTasks');
                if (!tasks || tasks.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <div><small>ÊöÇÊó†‰ªªÂä°ËÆ∞ÂΩï</small></div>
                        </div>
                    `;
                    return;
                }

                let html = '';
                tasks.forEach(task => {
                    const statusClass = getStatusClass(task.status);
                    const createdTime = new Date(task.createdAt).toLocaleString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const isActive = task.status === 1 || task.status === 0; // 1=Converting, 0=Pending
                    const progressInfo = isActive && task.progress ? `${task.progress}%` : '';

                    html += `
                        <div class="card mb-2 task-card" data-task-id="${task.id}">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center mb-1">
                                            <i class="fas fa-${getStatusIcon(task.status)} status-icon text-${getStatusColor(task.status)}"></i>
                                            <div class="fw-bold text-truncate" style="max-width: 150px;" title="${task.taskName}">
                                                ${task.taskName}
                                            </div>
                                        </div>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-file"></i> ${task.originalFileName || 'Êú™Áü•Êñá‰ª∂'}
                                        </small>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-clock"></i> ${createdTime}
                                            </small>
                                            ${progressInfo ? `
                                                <div class="progress mt-1" style="height: 4px;">
                                                    <div class="progress-bar bg-primary" style="width: ${task.progress}%"></div>
                                                </div>
                                                <small class="task-progress text-primary">${progressInfo}</small>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge ${statusClass} task-status mb-2">${getStatusText(task.status)}</span>
                                        <div class="btn-group-vertical" role="group">
                                            ${task.status === 2 ? `
                                                <a href="/api/conversion/download/${task.id}"
                                                   class="btn btn-sm btn-outline-success"
                                                   title="‰∏ãËΩΩËΩ¨Êç¢ÂêéÁöÑÊñá‰ª∂">
                                                    <i class="fas fa-download"></i>
                                                </a>
                                            ` : ''}
                                            ${isActive ? `
                                                <button class="btn btn-sm btn-outline-info"
                                                        onclick="viewTaskDetails('${task.id}')"
                                                        title="Êü•ÁúãËØ¶ÊÉÖ">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
                console.log("‚úÖ ÊúÄËøë‰ªªÂä°Âä†ËΩΩÂÆåÊàê");
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊúÄËøë‰ªªÂä°Â§±Ë¥•:', error);
                const container = document.getElementById('recentTasks');
                container.innerHTML = `
                    <div class="text-center text-danger py-3">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <div><small>Âä†ËΩΩÂ§±Ë¥•: ${error.message}</small></div>
                        <button class="btn btn-sm btn-outline-primary mt-2" onclick="loadRecentTasks()">
                            <i class="fas fa-retry"></i> ÈáçËØï
                        </button>
                    </div>
                `;
            }
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÊ†∑ÂºèÁ±ª
        function getStatusClass(status) {
            // ÊîØÊåÅÊï∞Â≠óÂíåÂ≠óÁ¨¶‰∏≤Áä∂ÊÄÅ
            switch (status) {
                case 2:
                case 'Completed': return 'bg-success';
                case 3:
                case 'Failed': return 'bg-danger';
                case 1:
                case 'Converting': return 'bg-primary';
                case 0:
                case 'Pending': return 'bg-warning text-dark';
                case 4:
                case 'Cancelled': return 'bg-secondary';
                default: return 'bg-secondary';
            }
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨
        function getStatusText(status) {
            // ÊîØÊåÅÊï∞Â≠óÂíåÂ≠óÁ¨¶‰∏≤Áä∂ÊÄÅ
            switch (status) {
                case 2:
                case 'Completed': return 'Â∑≤ÂÆåÊàê';
                case 3:
                case 'Failed': return 'Â§±Ë¥•';
                case 1:
                case 'Converting': return 'ËΩ¨Êç¢‰∏≠';
                case 0:
                case 'Pending': return 'Á≠âÂæÖ‰∏≠';
                case 4:
                case 'Cancelled': return 'Â∑≤ÂèñÊ∂à';
                default: return 'Êú™Áü•';
            }
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÂõæÊ†á
        function getStatusIcon(status) {
            // ÊîØÊåÅÊï∞Â≠óÂíåÂ≠óÁ¨¶‰∏≤Áä∂ÊÄÅ
            switch (status) {
                case 2:
                case 'Completed': return 'check-circle';
                case 3:
                case 'Failed': return 'times-circle';
                case 1:
                case 'Converting': return 'spinner fa-spin';
                case 0:
                case 'Pending': return 'clock';
                case 4:
                case 'Cancelled': return 'ban';
                default: return 'question-circle';
            }
        }

        // Ëé∑ÂèñÁä∂ÊÄÅÈ¢úËâ≤
        function getStatusColor(status) {
            // ÊîØÊåÅÊï∞Â≠óÂíåÂ≠óÁ¨¶‰∏≤Áä∂ÊÄÅ
            switch (status) {
                case 2:
                case 'Completed': return 'success';
                case 3:
                case 'Failed': return 'danger';
                case 1:
                case 'Converting': return 'primary';
                case 0:
                case 'Pending': return 'warning';
                case 4:
                case 'Cancelled': return 'secondary';
                default: return 'muted';
            }
        }

        // Êü•Áúã‰ªªÂä°ËØ¶ÊÉÖ
        async function viewTaskDetails(taskId) {
            try {
                if (connection.state === signalR.HubConnectionState.Connected) {
                    await connection.invoke("GetTaskStatus", taskId);
                } else {
                    showAlert('warning', 'SignalRËøûÊé•Êú™Âª∫Á´ãÔºåÊó†Ê≥ïËé∑ÂèñÂÆûÊó∂Áä∂ÊÄÅ');
                }
            } catch (error) {
                console.error('Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•:', error);
                showAlert('danger', 'Ëé∑Âèñ‰ªªÂä°ËØ¶ÊÉÖÂ§±Ë¥•: ' + error.message);
            }
        }

        // Âà∑Êñ∞ÂΩìÂâç‰ªªÂä°Áä∂ÊÄÅ
        async function refreshCurrentTask() {
            if (currentTaskId && connection.state === signalR.HubConnectionState.Connected) {
                try {
                    await connection.invoke("GetTaskStatus", currentTaskId);
                    showAlert('info', 'Ê≠£Âú®Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅ...');
                } catch (error) {
                    console.error('Âà∑Êñ∞‰ªªÂä°Áä∂ÊÄÅÂ§±Ë¥•:', error);
                    showAlert('danger', 'Âà∑Êñ∞Â§±Ë¥•: ' + error.message);
                }
            }
        }

        // Êñá‰ª∂ÊãñÊãΩÂäüËÉΩ
        function initializeFileDragDrop() {
            const dropZone = document.getElementById('fileDropZone');
            const fileInput = document.getElementById('videoFile');
            const selectedFileInfo = document.getElementById('selectedFileInfo');
            const selectedFileName = document.getElementById('selectedFileName');
            const selectedFileSize = document.getElementById('selectedFileSize');

            // Èò≤Ê≠¢ÈªòËÆ§ÊãñÊãΩË°å‰∏∫
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            // È´ò‰∫ÆÊãñÊãΩÂå∫Âüü
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            // Â§ÑÁêÜÊñá‰ª∂ÊãñÊãΩ
            dropZone.addEventListener('drop', handleDrop, false);

            // ÁÇπÂáªÈÄâÊã©Êñá‰ª∂
            dropZone.addEventListener('click', (e) => {
                // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊñá‰ª∂ËæìÂÖ•Ê°ÜÊú¨Ë∫´Ôºå‰∏çË¶ÅÈáçÂ§çËß¶Âèë
                if (e.target !== fileInput) {
                    fileInput.click();
                }
            });

            // Êñá‰ª∂ÈÄâÊã©ÂèòÂåñ
            fileInput.addEventListener('change', handleFileSelect);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function highlight() {
                dropZone.classList.add('dragover');
            }

            function unhighlight() {
                dropZone.classList.remove('dragover');
            }

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;

                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileSelect();
                }
            }

            function handleFileSelect() {
                const file = fileInput.files[0];
                if (file) {
                    selectedFileName.textContent = file.name;
                    selectedFileSize.textContent = formatFileSize(file.size);
                    selectedFileInfo.style.display = 'block';

                    // È™åËØÅÊñá‰ª∂Á±ªÂûã
                    const allowedExtensions = [@Html.Raw(string.Join(",", Model.SupportedExtensions.Select(ext => $"'{ext}'")))];
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();

                    if (!allowedExtensions.includes(fileExtension)) {
                        showAlert('danger', `‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Ê†ºÂºè: ${fileExtension}`);
                        fileInput.value = '';
                        selectedFileInfo.style.display = 'none';
                        return;
                    }

                    // È™åËØÅÊñá‰ª∂Â§ßÂ∞è
                    const maxSize = @Model.MaxFileSize;
                    if (file.size > maxSize) {
                        showAlert('danger', `Êñá‰ª∂Â§ßÂ∞èË∂ÖËøáÈôêÂà∂: ${formatFileSize(file.size)} > ${formatFileSize(maxSize)}`);
                        fileInput.value = '';
                        selectedFileInfo.style.display = 'none';
                        return;
                    }

                    showAlert('success', `Êñá‰ª∂ÈÄâÊã©ÊàêÂäü: ${file.name}`);
                } else {
                    selectedFileInfo.style.display = 'none';
                }
            }
        }

        // ÂêØÂä®ÂÆöÊó∂Âà∑Êñ∞
        function startPeriodicRefresh() {
            // Ê∏ÖÈô§Áé∞ÊúâÁöÑÂÆöÊó∂Âô®
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }

            // ÊØè30ÁßíÂà∑Êñ∞‰∏ÄÊ¨°‰ªªÂä°ÂàóË°®
            refreshInterval = setInterval(() => {
                const now = Date.now();
                // ÈÅøÂÖçÈ¢ëÁπÅÂà∑Êñ∞ÔºåËá≥Â∞ëÈó¥Èöî10Áßí
                if (now - lastRefreshTime > 1000) {
                    console.log("üîÑ ÂÆöÊó∂Âà∑Êñ∞‰ªªÂä°ÂàóË°®");
                    loadRecentTasks();
                }
            }, 10000);
        }

        // ÂÅúÊ≠¢ÂÆöÊó∂Âà∑Êñ∞
        function stopPeriodicRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }

        // Êô∫ËÉΩÂà∑Êñ∞ÔºàÈÅøÂÖçÈáçÂ§çÂà∑Êñ∞Ôºâ
        function smartRefresh() {
            const now = Date.now();
            if (now - lastRefreshTime > 2000) { // Ëá≥Â∞ëÈó¥Èöî2Áßí
                loadRecentTasks();
            }
        }

        // È°µÈù¢ÂèØËßÅÊÄßÂèòÂåñÂ§ÑÁêÜ
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // È°µÈù¢ÈöêËóèÊó∂ÂÅúÊ≠¢ÂÆöÊó∂Âà∑Êñ∞
                stopPeriodicRefresh();
            } else {
                // È°µÈù¢ÊòæÁ§∫Êó∂ÊÅ¢Â§çÂÆöÊó∂Âà∑Êñ∞Âπ∂Á´ãÂç≥Âà∑Êñ∞‰∏ÄÊ¨°
                smartRefresh();
                startPeriodicRefresh();
            }
        });

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentTasks();
            initializeFileDragDrop();
            startPeriodicRefresh();
            loadGpuInfo(); // Âä†ËΩΩGPU‰ø°ÊÅØ

            // Âª∂ËøüÂàùÂßãÂåñÊô∫ËÉΩGPUÈ¢ÑËÆæÈÄâÊã©ÔºåÁ≠âÂæÖGPUÊ£ÄÊµãÂÆåÊàê
            setTimeout(() => {
                initializeSmartPresetSelection();
            }, 2000);
        });

        // È°µÈù¢Âç∏ËΩΩÊó∂Ê∏ÖÁêÜ
        window.addEventListener('beforeunload', function() {
            stopPeriodicRefresh();
        });

        // Âä†ËΩΩGPUÁ°¨‰ª∂Âä†ÈÄü‰ø°ÊÅØ
        async function loadGpuInfo() {
            try {
                const response = await fetch('/api/gpu/capabilities');
                const result = await response.json();

                if (result.success) {
                    displayGpuInfo(result.data);
                } else {
                    displayGpuError('Ëé∑ÂèñGPU‰ø°ÊÅØÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Âä†ËΩΩGPU‰ø°ÊÅØÂ§±Ë¥•:', error);
                displayGpuError('Êó†Ê≥ïËøûÊé•Âà∞GPUÊ£ÄÊµãÊúçÂä°');
            }
        }

        // ÊòæÁ§∫GPU‰ø°ÊÅØ
        function displayGpuInfo(gpuData) {
            const gpuInfoContainer = document.getElementById('gpuInfo');

            if (!gpuData.hasAnyGpuSupport) {
                gpuInfoContainer.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2 text-warning"></i>
                        <h6>Êú™Ê£ÄÊµãÂà∞GPUÁ°¨‰ª∂Âä†ÈÄüÊîØÊåÅ</h6>
                        <p class="small mb-0">Á≥ªÁªüÂ∞Ü‰ΩøÁî®CPUËøõË°åËßÜÈ¢ëËΩ¨Á†Å</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="alert alert-success d-flex align-items-center" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            <div>
                                <strong>GPUÂä†ÈÄüÂèØÁî®!</strong><br>
                                <small>ÊîØÊåÅ: ${gpuData.supportedTypes}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
            `;

            // NVIDIA NVENC
            if (gpuData.nvidia.supported) {
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card border-success">
                            <div class="card-body p-2">
                                <h6 class="card-title text-success mb-1">
                                    <i class="fab fa-nvidia"></i> NVIDIA NVENC
                                </h6>
                                <small class="text-muted">ÁºñÁ†ÅÂô®: ${gpuData.nvidia.encoders.join(', ')}</small>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Intel QSV
            if (gpuData.intel.supported) {
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card border-primary">
                            <div class="card-body p-2">
                                <h6 class="card-title text-primary mb-1">
                                    <i class="fab fa-intel"></i> Intel QSV
                                </h6>
                                <small class="text-muted">ÁºñÁ†ÅÂô®: ${gpuData.intel.encoders.join(', ')}</small>
                            </div>
                        </div>
                    </div>
                `;
            }

            // AMD VCE/AMF
            if (gpuData.amd.supported) {
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card border-danger">
                            <div class="card-body p-2">
                                <h6 class="card-title text-danger mb-1">
                                    <i class="fab fa-amd"></i> AMD VCE/AMF
                                </h6>
                                <small class="text-muted">ÁºñÁ†ÅÂô®: ${gpuData.amd.encoders.join(', ')}</small>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div>';

            // GPUËÆæÂ§á‰ø°ÊÅØ
            if (gpuData.gpuDevices && gpuData.gpuDevices.length > 0) {
                html += `
                    <div class="mt-2">
                        <h6 class="small text-muted mb-1">Ê£ÄÊµãÂà∞ÁöÑGPUËÆæÂ§á:</h6>
                        <ul class="list-unstyled small">
                `;
                gpuData.gpuDevices.forEach(device => {
                    html += `<li><i class="fas fa-microchip text-muted me-1"></i>${device}</li>`;
                });
                html += '</ul></div>';
            }

            gpuInfoContainer.innerHTML = html;
        }

        // ÊòæÁ§∫GPUÈîôËØØ‰ø°ÊÅØ
        function displayGpuError(message) {
            const gpuInfoContainer = document.getElementById('gpuInfo');
            gpuInfoContainer.innerHTML = `
                <div class="text-center text-muted">
                    <i class="fas fa-exclamation-circle fa-2x mb-2 text-danger"></i>
                    <h6>GPUÊ£ÄÊµãÂ§±Ë¥•</h6>
                    <p class="small mb-0">${message}</p>
                </div>
            `;
        }

        // Âà∑Êñ∞GPU‰ø°ÊÅØ
        document.getElementById('refreshGpuInfo').addEventListener('click', async function() {
            const button = this;
            const icon = button.querySelector('i');

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            icon.className = 'fas fa-spinner fa-spin';
            button.disabled = true;

            try {
                // Ë∞ÉÁî®Âà∑Êñ∞API
                await fetch('/api/gpu/refresh', { method: 'POST' });
                // ÈáçÊñ∞Âä†ËΩΩGPU‰ø°ÊÅØ
                await loadGpuInfo();
            } catch (error) {
                console.error('Âà∑Êñ∞GPU‰ø°ÊÅØÂ§±Ë¥•:', error);
                displayGpuError('Âà∑Êñ∞Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                icon.className = 'fas fa-sync-alt';
                button.disabled = false;
            }
        });

        // Ê£ÄÊü•ÁºñÁ†ÅÂô®ÊòØÂê¶‰∏∫GPUÂä†ÈÄü
        function isGpuEncoder(codec) {
            if (!codec) return false;
            const gpuEncoders = ['nvenc', 'qsv', 'amf', 'vaapi'];
            return gpuEncoders.some(gpu => codec.toLowerCase().includes(gpu));
        }

        // Êõ¥Êñ∞GPUÂä†ÈÄüÊ†áËØÜ
        function updateGpuAccelBadge(codec) {
            const badge = document.getElementById('gpuAccelBadge');
            if (isGpuEncoder(codec)) {
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        }); // ÁªìÊùü DOMContentLoaded ‰∫ã‰ª∂ÁõëÂê¨Âô®
    </script>
}
*@